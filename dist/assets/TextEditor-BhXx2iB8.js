var Ys=Object.defineProperty;var Qs=(s,t,e)=>t in s?Ys(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var h=(s,t,e)=>Qs(s,typeof t!="symbol"?t+"":t,e);import{r as Oe,j as ve}from"./index-CpFmk86o.js";import{b as er,a as tr,c as ir,d as nr,e as or,P as w,l as N,C as ge,f as Re,O as It,u as jt,g as R,D as di,h as U,L as Qn,i as mi,j as gi,k as _,B as I,M as D,T as lt,m as eo,n as y,o as to,E as sr,S as io,U as $,p as he,q,r as Be,s as At,t as hi,v as fi,w as Ve,x as Tt,y as rr,z as lr,A as ar,F as cr,G as ur,H as dr,I as no,J as pi,R as X,K as zi,N as mr,Q as gr,V as at,W as hr,X as fr,Y as pr,Z as br,_ as wr,$ as Cr,a0 as vr,a1 as oo,a2 as so,a3 as ro,a4 as _r,a5 as xe,a6 as $e,a7 as je,a8 as le,a9 as lo,aa as Q,ab as kr,ac as yr,ad as ct,ae,af as Rt,ag as ee,ah as ut,ai as bi,aj as te,ak as wi,al as qe,am as Ci,an as ao,ao as Wi,ap as Ir,aq as $i,ar as co,as as Ar,at as Vt,au as Tr,av as Fe,aw as Er,ax as L,ay as G,az as j,aA as ie,aB as ne,aC as Sr,aD as Le,aE as P,aF as z,aG as xr,aH as uo,aI as J,aJ as Rr,aK as vi,aL as Vr,aM as Pr,aN as Br,aO as Lr,aP as Or,aQ as _i,aR as mo,aS as go,aT as ho,aU as Pt,aV as Fr,aW as dt,aX as mt,aY as fo,aZ as Ur,a_ as po,a$ as Dr,b0 as Nr,b1 as Mr,b2 as Hr,b3 as bo,b4 as zr,b5 as wo,b6 as Y,b7 as Co,b8 as Wr,b9 as $r,ba as jr,bb as qr,bc as Gr,bd as Kr}from"./ckeditor5-FiHyv50m.js";import{d as ki,h as vo,i as Zr,a as Jr,f as Xr,e as Yr,j as yi}from"./toString-qof7_FyP.js";function Qr(s,t,e){var i=s.length;return e=e===void 0?i:e,!t&&e>=i?s:er(s,t,e)}var el="\\ud800-\\udfff",tl="\\u0300-\\u036f",il="\\ufe20-\\ufe2f",nl="\\u20d0-\\u20ff",ol=tl+il+nl,sl="\\ufe0e\\ufe0f",rl="\\u200d",ll=RegExp("["+rl+el+ol+sl+"]");function _o(s){return ll.test(s)}function al(s){return s.split("")}var ko="\\ud800-\\udfff",cl="\\u0300-\\u036f",ul="\\ufe20-\\ufe2f",dl="\\u20d0-\\u20ff",ml=cl+ul+dl,gl="\\ufe0e\\ufe0f",hl="["+ko+"]",qt="["+ml+"]",Gt="\\ud83c[\\udffb-\\udfff]",fl="(?:"+qt+"|"+Gt+")",yo="[^"+ko+"]",Io="(?:\\ud83c[\\udde6-\\uddff]){2}",Ao="[\\ud800-\\udbff][\\udc00-\\udfff]",pl="\\u200d",To=fl+"?",Eo="["+gl+"]?",bl="(?:"+pl+"(?:"+[yo,Io,Ao].join("|")+")"+Eo+To+")*",wl=Eo+To+bl,Cl="(?:"+[yo+qt+"?",qt,Io,Ao,hl].join("|")+")",vl=RegExp(Gt+"(?="+Gt+")|"+Cl+wl,"g");function _l(s){return s.match(vl)||[]}function kl(s){return _o(s)?_l(s):al(s)}function yl(s){return function(t){t=ki(t);var e=_o(t)?kl(t):void 0,i=e?e[0]:t.charAt(0),n=e?Qr(e,1).join(""):t.slice(1);return i[s]()+n}}var So=yl("toUpperCase");function Il(s,t,e,i){for(var n=-1,o=s==null?0:s.length;++n<o;)e=t(e,s[n],n,s);return e}function Al(s){return function(t){return s==null?void 0:s[t]}}var Tl={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},El=Al(Tl),Sl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,xl="\\u0300-\\u036f",Rl="\\ufe20-\\ufe2f",Vl="\\u20d0-\\u20ff",Pl=xl+Rl+Vl,Bl="["+Pl+"]",Ll=RegExp(Bl,"g");function Ol(s){return s=ki(s),s&&s.replace(Sl,El).replace(Ll,"")}var Fl=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function Ul(s){return s.match(Fl)||[]}var Dl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function Nl(s){return Dl.test(s)}var xo="\\ud800-\\udfff",Ml="\\u0300-\\u036f",Hl="\\ufe20-\\ufe2f",zl="\\u20d0-\\u20ff",Wl=Ml+Hl+zl,Ro="\\u2700-\\u27bf",Vo="a-z\\xdf-\\xf6\\xf8-\\xff",$l="\\xac\\xb1\\xd7\\xf7",jl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ql="\\u2000-\\u206f",Gl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Po="A-Z\\xc0-\\xd6\\xd8-\\xde",Kl="\\ufe0e\\ufe0f",Bo=$l+jl+ql+Gl,Lo="['’]",ji="["+Bo+"]",Zl="["+Wl+"]",Oo="\\d+",Jl="["+Ro+"]",Fo="["+Vo+"]",Uo="[^"+xo+Bo+Oo+Ro+Vo+Po+"]",Xl="\\ud83c[\\udffb-\\udfff]",Yl="(?:"+Zl+"|"+Xl+")",Ql="[^"+xo+"]",Do="(?:\\ud83c[\\udde6-\\uddff]){2}",No="[\\ud800-\\udbff][\\udc00-\\udfff]",Te="["+Po+"]",ea="\\u200d",qi="(?:"+Fo+"|"+Uo+")",ta="(?:"+Te+"|"+Uo+")",Gi="(?:"+Lo+"(?:d|ll|m|re|s|t|ve))?",Ki="(?:"+Lo+"(?:D|LL|M|RE|S|T|VE))?",Mo=Yl+"?",Ho="["+Kl+"]?",ia="(?:"+ea+"(?:"+[Ql,Do,No].join("|")+")"+Ho+Mo+")*",na="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",oa="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",sa=Ho+Mo+ia,ra="(?:"+[Jl,Do,No].join("|")+")"+sa,la=RegExp([Te+"?"+Fo+"+"+Gi+"(?="+[ji,Te,"$"].join("|")+")",ta+"+"+Ki+"(?="+[ji,Te+qi,"$"].join("|")+")",Te+"?"+qi+"+"+Gi,Te+"+"+Ki,oa,na,Oo,ra].join("|"),"g");function aa(s){return s.match(la)||[]}function ca(s,t,e){return s=ki(s),t=t,t===void 0?Nl(s)?aa(s):Ul(s):s.match(t)||[]}var ua="['’]",da=RegExp(ua,"g");function ma(s){return function(t){return Il(ca(Ol(t).replace(da,"")),s,"")}}function ga(s,t){return function(e,i){if(e==null)return e;if(!vo(e))return s(e,i);for(var n=e.length,o=-1,r=Object(e);++o<n&&i(r[o],o,r)!==!1;);return e}}var ha=ga(tr),fa=ir(function(s,t,e,i){nr(s,t,e,i)});function pa(s,t){var e=-1,i=vo(s)?Array(s.length):[];return ha(s,function(n,o,r){i[++e]=t(n,o,r)}),i}function ba(s,t){var e=Zr(s)?Jr:pa;return e(s,or(t))}var wa=ma(function(s,t,e){return s+(e?" ":"")+So(t)});/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ca extends It(){constructor(){super();h(this,"total");h(this,"_reader");h(this,"_data");const e=new window.FileReader;this._reader=e,this._data=void 0,this.set("loaded",0),e.onprogress=i=>{this.loaded=i.loaded}}get error(){return this._reader.error}get data(){return this._data}read(e){const i=this._reader;return this.total=e.size,new Promise((n,o)=>{i.onload=()=>{const r=i.result;this._data=r,n(r)},i.onerror=()=>{o("error")},i.onabort=()=>{o("aborted")},this._reader.readAsDataURL(e)})}abort(){this._reader.abort()}}class ce extends w{constructor(){super(...arguments);h(this,"loaders",new ge);h(this,"_loadersMap",new Map);h(this,"_pendingAction",null)}static get pluginName(){return"FileRepository"}static get isOfficialPlugin(){return!0}static get requires(){return[Re]}init(){this.loaders.on("change",()=>this._updatePendingAction()),this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(e,i)=>i?e/i*100:0)}getLoader(e){return this._loadersMap.get(e)||null}createLoader(e){if(!this.createUploadAdapter)return N("filerepository-no-upload-adapter"),null;const i=new Zi(Promise.resolve(e),this.createUploadAdapter);return this.loaders.add(i),this._loadersMap.set(e,i),e instanceof Promise&&i.file.then(n=>{this._loadersMap.set(n,i)}).catch(()=>{}),i.on("change:uploaded",()=>{let n=0;for(const o of this.loaders)n+=o.uploaded;this.uploaded=n}),i.on("change:uploadTotal",()=>{let n=0;for(const o of this.loaders)o.uploadTotal&&(n+=o.uploadTotal);this.uploadTotal=n}),i}destroyLoader(e){const i=e instanceof Zi?e:this.getLoader(e);i._destroy(),this.loaders.remove(i),this._loadersMap.forEach((n,o)=>{n===i&&this._loadersMap.delete(o)})}_updatePendingAction(){const e=this.editor.plugins.get(Re);if(this.loaders.length){if(!this._pendingAction){const i=this.editor.t,n=o=>`${i("Upload in progress")} ${parseInt(o)}%.`;this._pendingAction=e.add(n(this.uploadedPercent)),this._pendingAction.bind("message").to(this,"uploadedPercent",n)}}else e.remove(this._pendingAction),this._pendingAction=null}}class Zi extends It(){constructor(e,i){super();h(this,"id");h(this,"_filePromiseWrapper");h(this,"_adapter");h(this,"_reader");this.id=jt(),this._filePromiseWrapper=this._createFilePromiseWrapper(e),this._adapter=i(this),this._reader=new Ca,this.set("status","idle"),this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(n,o)=>o?n/o*100:0),this.set("uploadResponse",null)}get file(){return this._filePromiseWrapper?this._filePromiseWrapper.promise.then(e=>this._filePromiseWrapper?e:null):Promise.resolve(null)}get data(){return this._reader.data}read(){if(this.status!="idle")throw new R("filerepository-read-wrong-status",this);return this.status="reading",this.file.then(e=>this._reader.read(e)).then(e=>{if(this.status!=="reading")throw this.status;return this.status="idle",e}).catch(e=>{throw e==="aborted"?(this.status="aborted","aborted"):(this.status="error",this._reader.error?this._reader.error:e)})}upload(){if(this.status!="idle")throw new R("filerepository-upload-wrong-status",this);return this.status="uploading",this.file.then(()=>this._adapter.upload()).then(e=>(this.uploadResponse=e,this.status="idle",e)).catch(e=>{throw this.status==="aborted"?"aborted":(this.status="error",e)})}abort(){const e=this.status;this.status="aborted",this._filePromiseWrapper.isFulfilled?e=="reading"?this._reader.abort():e=="uploading"&&this._adapter.abort&&this._adapter.abort():(this._filePromiseWrapper.promise.catch(()=>{}),this._filePromiseWrapper.rejecter("aborted")),this._destroy()}_destroy(){this._filePromiseWrapper=void 0,this._reader=void 0,this._adapter=void 0,this.uploadResponse=void 0}_createFilePromiseWrapper(e){const i={};return i.promise=new Promise((n,o)=>{i.rejecter=o,i.isFulfilled=!1,e.then(r=>{i.isFulfilled=!0,n(r)}).catch(r=>{i.isFulfilled=!0,o(r)})}),i}}class va extends w{static get requires(){return[ce]}static get pluginName(){return"SimpleUploadAdapter"}static get isOfficialPlugin(){return!0}init(){const t=this.editor.config.get("simpleUpload");if(t){if(!t.uploadUrl){N("simple-upload-adapter-missing-uploadurl");return}this.editor.plugins.get(ce).createUploadAdapter=e=>new _a(e,t)}}}class _a{constructor(t,e){h(this,"loader");h(this,"options");h(this,"xhr");this.loader=t,this.options=e}upload(){return this.loader.file.then(t=>new Promise((e,i)=>{this._initRequest(),this._initListeners(e,i,t),this._sendRequest(t)}))}abort(){this.xhr&&this.xhr.abort()}_initRequest(){const t=this.xhr=new XMLHttpRequest;t.open("POST",this.options.uploadUrl,!0),t.responseType="json"}_initListeners(t,e,i){const n=this.xhr,o=this.loader,r=`Couldn't upload file: ${i.name}.`;n.addEventListener("error",()=>e(r)),n.addEventListener("abort",()=>e()),n.addEventListener("load",()=>{const l=n.response;if(!l||l.error)return e(l&&l.error&&l.error.message?l.error.message:r);const a=l.url?{default:l.url}:l.urls;t({...l,urls:a})});/* istanbul ignore else -- @preserve */n.upload&&n.upload.addEventListener("progress",l=>{l.lengthComputable&&(o.uploadTotal=l.total,o.uploaded=l.loaded)})}_sendRequest(t){const e=this.options.headers||{},i=this.options.withCredentials||!1;for(const o of Object.keys(e))this.xhr.setRequestHeader(o,e[o]);this.xhr.withCredentials=i;const n=new FormData;n.append("upload",t),this.xhr.send(n)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Z(s,t,e,i){let n,o=null;typeof i=="function"?n=i:(o=s.commands.get(i),n=()=>{s.execute(i)}),s.model.document.on("change:data",(r,l)=>{if(o&&!o.isEnabled||!t.isEnabled)return;const a=U(s.model.document.selection.getRanges());if(!a.isCollapsed||l.isUndo||!l.isLocal)return;const c=Array.from(s.model.document.differ.getChanges()),u=c[0];if(c.length!=1||u.type!=="insert"||u.name!="$text"||u.length!=1)return;const d=u.position.parent;if(d.is("element","codeBlock")||d.is("element","listItem")&&typeof i!="function"&&!["numberedList","bulletedList","todoList"].includes(i)||o&&o.value===!0)return;const m=d.getChild(0),g=s.model.createRangeOn(m);if(!g.containsRange(a)&&!a.end.isEqual(g.end))return;const f=e.exec(m.data.substr(0,a.end.offset));f&&s.model.enqueueChange(p=>{const b=p.createPositionAt(d,0),C=p.createPositionAt(d,f[0].length),v=new Qn(b,C);if(n({match:f})!==!1){p.remove(v);const T=s.model.document.selection.getFirstRange(),S=p.createRangeIn(d);d.isEmpty&&!S.isEqual(T)&&!S.containsRange(T,!0)&&p.remove(d)}v.detach(),s.model.enqueueChange(()=>{s.plugins.get("Delete").requestUndoOnBackspace()})})})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function _e(s,t,e,i){let n,o;e instanceof RegExp?n=e:o=e,o=o||(r=>{let l;const a=[],c=[];for(;(l=n.exec(r))!==null&&!(l&&l.length<4);){let{index:u,"1":d,"2":m,"3":g}=l;const f=d+m+g;u+=l[0].length-f.length;const p=[u,u+d.length],b=[u+d.length+m.length,u+d.length+m.length+g.length];a.push(p),a.push(b),c.push([u+d.length,u+d.length+m.length])}return{remove:a,format:c}}),s.model.document.on("change:data",(r,l)=>{if(l.isUndo||!l.isLocal||!t.isEnabled)return;const a=s.model,c=a.document.selection;if(!c.isCollapsed)return;const u=Array.from(a.document.differ.getChanges()),d=u[0];if(u.length!=1||d.type!=="insert"||d.name!="$text"||d.length!=1)return;const m=c.focus,g=m.parent,{text:f,range:p}=ka(a.createRange(a.createPositionAt(g,0),m),a),b=o(f),C=Ji(p.start,b.format,a),v=Ji(p.start,b.remove,a);C.length&&v.length&&a.enqueueChange(k=>{if(i(k,C)!==!1){for(const S of v.reverse())k.remove(S);a.enqueueChange(()=>{s.plugins.get("Delete").requestUndoOnBackspace()})}})})}function Ji(s,t,e){return t.filter(i=>i[0]!==void 0&&i[1]!==void 0).map(i=>e.createRange(s.getShiftedBy(i[0]),s.getShiftedBy(i[1])))}function ka(s,t){let e=s.start;return{text:Array.from(s.getItems()).reduce((n,o)=>!(o.is("$text")||o.is("$textProxy"))||o.getAttribute("code")?(e=t.createPositionAfter(o),""):n+o.data,""),range:t.createRange(e,s.end)}}class ya extends w{static get requires(){return[di]}static get pluginName(){return"Autoformat"}static get isOfficialPlugin(){return!0}afterInit(){const t=this.editor,e=this.editor.t;this._addListAutoformats(),this._addBasicStylesAutoformats(),this._addHeadingAutoformats(),this._addBlockQuoteAutoformats(),this._addCodeBlockAutoformats(),this._addHorizontalLineAutoformats(),t.accessibility.addKeystrokeInfos({keystrokes:[{label:e("Revert autoformatting action"),keystroke:"Backspace"}]})}_addListAutoformats(){const t=this.editor.commands;t.get("bulletedList")&&Z(this.editor,this,/^[*-]\s$/,"bulletedList"),t.get("numberedList")&&Z(this.editor,this,/^1[.|)]\s$/,"numberedList"),t.get("todoList")&&Z(this.editor,this,/^\[\s?\]\s$/,"todoList"),t.get("checkTodoList")&&Z(this.editor,this,/^\[\s?x\s?\]\s$/,()=>{this.editor.execute("todoList"),this.editor.execute("checkTodoList")})}_addBasicStylesAutoformats(){const t=this.editor.commands;if(t.get("bold")){const e=Xe(this.editor,"bold");_e(this.editor,this,/(?:^|\s)(\*\*)([^*]+)(\*\*)$/g,e),_e(this.editor,this,/(?:^|\s)(__)([^_]+)(__)$/g,e)}if(t.get("italic")){const e=Xe(this.editor,"italic");_e(this.editor,this,/(?:^|\s)(\*)([^*_]+)(\*)$/g,e),_e(this.editor,this,/(?:^|\s)(_)([^_]+)(_)$/g,e)}if(t.get("code")){const e=Xe(this.editor,"code");_e(this.editor,this,/(`)([^`]+)(`)$/g,e)}if(t.get("strikethrough")){const e=Xe(this.editor,"strikethrough");_e(this.editor,this,/(~~)([^~]+)(~~)$/g,e)}}_addHeadingAutoformats(){const t=this.editor.commands.get("heading");t&&t.modelElements.filter(e=>e.match(/^heading[1-6]$/)).forEach(e=>{const i=e[7],n=new RegExp(`^(#{${i}})\\s$`);Z(this.editor,this,n,()=>{if(!t.isEnabled||t.value===e)return!1;this.editor.execute("heading",{value:e})})})}_addBlockQuoteAutoformats(){this.editor.commands.get("blockQuote")&&Z(this.editor,this,/^>\s$/,"blockQuote")}_addCodeBlockAutoformats(){const t=this.editor,e=t.model.document.selection;t.commands.get("codeBlock")&&Z(t,this,/^```$/,()=>{if(e.getFirstPosition().parent.is("element","listItem"))return!1;this.editor.execute("codeBlock",{usePreviousLanguageChoice:!0})})}_addHorizontalLineAutoformats(){this.editor.commands.get("horizontalLine")&&Z(this.editor,this,/^---$/,"horizontalLine")}}function Xe(s,t){return(e,i)=>{if(!s.commands.get(t).isEnabled)return!1;const o=s.model.schema.getValidRanges(i,t);for(const r of o)e.setAttribute(t,!0,r);e.removeSelectionAttribute(t)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ia extends w{constructor(e){super(e);h(this,"adapter");h(this,"_debouncedSave");h(this,"_lastDocumentVersion");h(this,"_savePromise");h(this,"_domEmitter");h(this,"_config");h(this,"_pendingActions");h(this,"_makeImmediateSave");h(this,"_action",null);const i=e.config.get("autosave")||{},n=i.waitingTime||1e3;this.set("state","synchronized"),this._debouncedSave=mi(this._save.bind(this),n),this._lastDocumentVersion=e.model.document.version,this._savePromise=null,this._domEmitter=new(gi()),this._config=i,this._pendingActions=e.plugins.get(Re),this._makeImmediateSave=!1}static get pluginName(){return"Autosave"}static get isOfficialPlugin(){return!0}static get requires(){return[Re]}init(){const e=this.editor,i=e.model.document;this.listenTo(e,"ready",()=>{this.listenTo(i,"change:data",(n,o)=>{this._saveCallbacks.length&&o.isLocal&&(this.state==="synchronized"&&(this.state="waiting",this._setPendingAction()),this.state==="waiting"&&this._debouncedSave())})}),this.listenTo(e,"destroy",()=>this._flush(),{priority:"highest"});/* istanbul ignore next -- @preserve */this._domEmitter.listenTo(window,"beforeunload",(n,o)=>{this._pendingActions.hasAny&&(o.returnValue=this._pendingActions.first.message)})}destroy(){this._domEmitter.stopListening(),super.destroy()}save(){return this._debouncedSave.cancel(),this._save()}_flush(){this._debouncedSave.flush()}_save(){return this._savePromise?(this._makeImmediateSave=this.editor.model.document.version>this._lastDocumentVersion,this._savePromise):(this._setPendingAction(),this.state="saving",this._lastDocumentVersion=this.editor.model.document.version,this._savePromise=Promise.resolve().then(()=>Promise.all(this._saveCallbacks.map(e=>e(this.editor)))).finally(()=>{this._savePromise=null}).then(()=>{if(this._makeImmediateSave)return this._makeImmediateSave=!1,this._save();this.editor.model.document.version>this._lastDocumentVersion?(this.state="waiting",this._debouncedSave()):(this.state="synchronized",this._pendingActions.remove(this._action),this._action=null)}).catch(e=>{throw this.state="error",this.state="saving",this._debouncedSave(),e}),this._savePromise)}_setPendingAction(){const e=this.editor.t;this._action||(this._action=this._pendingActions.add(e("Saving changes")))}get _saveCallbacks(){const e=[];return this.adapter&&this.adapter.save&&e.push(this.adapter.save),this._config.save&&e.push(this._config.save),e}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ii extends y{constructor(e,i){super(e);h(this,"attributeKey");this.attributeKey=i}refresh(){const e=this.editor.model,i=e.document;this.value=this._getValueFromFirstAllowedNode(),this.isEnabled=e.schema.checkAttributeInSelection(i.selection,this.attributeKey)}execute(e={}){const i=this.editor.model,o=i.document.selection,r=e.forceValue===void 0?!this.value:e.forceValue;i.change(l=>{if(o.isCollapsed)r?l.setSelectionAttribute(this.attributeKey,!0):l.removeSelectionAttribute(this.attributeKey);else{const a=i.schema.getValidRanges(o.getRanges(),this.attributeKey);for(const c of a)r?l.setAttribute(this.attributeKey,r,c):l.removeAttribute(this.attributeKey,c)}})}_getValueFromFirstAllowedNode(){const e=this.editor.model,i=e.schema,n=e.document.selection;if(n.isCollapsed)return n.hasAttribute(this.attributeKey);for(const o of n.getRanges())for(const r of o.getItems())if(i.checkAttribute(r,this.attributeKey))return r.hasAttribute(this.attributeKey);return!1}}const ke="bold";class Aa extends w{static get pluginName(){return"BoldEditing"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=this.editor.t;t.model.schema.extend("$text",{allowAttributes:ke}),t.model.schema.setAttributeProperties(ke,{isFormatting:!0,copyOnEnter:!0}),t.conversion.attributeToElement({model:ke,view:"strong",upcastAlso:["b",i=>{const n=i.getStyle("font-weight");return n&&(n=="bold"||Number(n)>=600)?{name:!0,styles:["font-weight"]}:null}]}),t.commands.add(ke,new Ii(t,ke)),t.keystrokes.set("CTRL+B",ke),t.accessibility.addKeystrokeInfos({keystrokes:[{label:e("Bold text"),keystroke:"CTRL+B"}]})}}function Ai({editor:s,commandName:t,plugin:e,icon:i,label:n,keystroke:o}){return r=>{const l=s.commands.get(t),a=new r(s.locale);return a.set({label:n,icon:i,keystroke:o,isToggleable:!0}),a.bind("isEnabled").to(l,"isEnabled"),a.bind("isOn").to(l,"value"),a instanceof D?a.set({role:"menuitemcheckbox"}):a.set({tooltip:!0}),e.listenTo(a,"execute",()=>{s.execute(t),s.editing.view.focus()}),a}}const Bt="bold";class Ta extends w{static get pluginName(){return"BoldUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.locale.t,i=Ai({editor:t,commandName:Bt,plugin:this,icon:_.bold,label:e("Bold"),keystroke:"CTRL+B"});t.ui.componentFactory.add(Bt,()=>i(I)),t.ui.componentFactory.add("menuBar:"+Bt,()=>i(D))}}class Ea extends w{static get requires(){return[Aa,Ta]}static get pluginName(){return"Bold"}static get isOfficialPlugin(){return!0}}const se="code",Sa="ck-code_selected";class xa extends w{static get pluginName(){return"CodeEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[lt]}init(){const t=this.editor,e=this.editor.t;t.model.schema.extend("$text",{allowAttributes:se}),t.model.schema.setAttributeProperties(se,{isFormatting:!0,copyOnEnter:!1}),t.conversion.attributeToElement({model:se,view:"code",upcastAlso:{styles:{"word-wrap":"break-word"}}}),t.commands.add(se,new Ii(t,se)),t.plugins.get(lt).registerAttribute(se),eo(t,se,"code",Sa),t.accessibility.addKeystrokeInfos({keystrokes:[{label:e("Move out of an inline code style"),keystroke:[["arrowleft","arrowleft"],["arrowright","arrowright"]]}]})}}var Ra='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.5 5.7 5.2 3.9v1.3l-5.6 4c-.1.2-.3.2-.5.2-.3-.1-.6-.7-.6-1l.3-.4 4.7-3.5L11.5 7l-.2-.2c-.1-.3-.1-.6 0-.8.2-.2.5-.4.8-.4a.8.8 0 0 1 .4.1zm-5.2 0L2 9.6v1.3l5.6 4c.1.2.3.2.5.2.3-.1.7-.7.6-1 0-.1 0-.3-.2-.4l-5-3.5L8.2 7l.2-.2c.1-.3.1-.6 0-.8-.2-.2-.5-.4-.8-.4a.8.8 0 0 0-.3.1z"/></svg>';const Lt="code";class Va extends w{static get pluginName(){return"CodeUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.locale.t,i=Ai({editor:t,commandName:Lt,plugin:this,icon:Ra,label:e("Code")});t.ui.componentFactory.add(Lt,()=>i(I)),t.ui.componentFactory.add("menuBar:"+Lt,()=>i(D))}}class Pa extends w{static get requires(){return[xa,Va]}static get pluginName(){return"Code"}static get isOfficialPlugin(){return!0}}const ye="italic";class Ba extends w{static get pluginName(){return"ItalicEditing"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=this.editor.t;t.model.schema.extend("$text",{allowAttributes:ye}),t.model.schema.setAttributeProperties(ye,{isFormatting:!0,copyOnEnter:!0}),t.conversion.attributeToElement({model:ye,view:"i",upcastAlso:["em",{styles:{"font-style":"italic"}}]}),t.commands.add(ye,new Ii(t,ye)),t.keystrokes.set("CTRL+I",ye),t.accessibility.addKeystrokeInfos({keystrokes:[{label:e("Italic text"),keystroke:"CTRL+I"}]})}}var La='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.586 14.633.021.004c-.036.335.095.655.393.962.082.083.173.15.274.201h1.474a.6.6 0 1 1 0 1.2H5.304a.6.6 0 0 1 0-1.2h1.15c.474-.07.809-.182 1.005-.334.157-.122.291-.32.404-.597l2.416-9.55a1.053 1.053 0 0 0-.281-.823 1.12 1.12 0 0 0-.442-.296H8.15a.6.6 0 0 1 0-1.2h6.443a.6.6 0 1 1 0 1.2h-1.195c-.376.056-.65.155-.823.296-.215.175-.423.439-.623.79l-2.366 9.347z"/></svg>';const Ot="italic";class Oa extends w{static get pluginName(){return"ItalicUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.locale.t,i=Ai({editor:t,commandName:Ot,plugin:this,icon:La,keystroke:"CTRL+I",label:e("Italic")});t.ui.componentFactory.add(Ot,()=>i(I)),t.ui.componentFactory.add("menuBar:"+Ot,()=>i(D))}}class Fa extends w{static get requires(){return[Ba,Oa]}static get pluginName(){return"Italic"}static get isOfficialPlugin(){return!0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ua={autoRefresh:!0},Xi=36e5,Da=5e3;class Ti extends It(){constructor(e,i={}){super();h(this,"_refresh");h(this,"_options");h(this,"_tokenRefreshTimeout");if(!e)throw new R("token-missing-token-url",this);i.initValue&&this._validateTokenValue(i.initValue),this.set("value",i.initValue),typeof e=="function"?this._refresh=e:this._refresh=()=>Na(e),this._options={...Ua,...i}}init(){return new Promise((e,i)=>{if(!this.value){this.refreshToken().then(e).catch(i);return}this._options.autoRefresh&&this._registerRefreshTokenTimeout(),e(this)})}refreshToken(){const e=this._options.autoRefresh;return this._refresh().then(i=>(this._validateTokenValue(i),this.set("value",i),e&&this._registerRefreshTokenTimeout(),this)).catch(i=>{throw N("token-refresh-failed",{autoRefresh:e}),e&&this._registerRefreshTokenTimeout(Da),i})}destroy(){clearTimeout(this._tokenRefreshTimeout)}_validateTokenValue(e){const i=typeof e=="string",n=!/^".*"$/.test(e),o=i&&e.split(".").length===3;if(!(n&&o))throw new R("token-not-in-jwt-format",this)}_registerRefreshTokenTimeout(e){const i=e||this._getTokenRefreshTimeoutTime();clearTimeout(this._tokenRefreshTimeout),this._tokenRefreshTimeout=setTimeout(()=>{this.refreshToken()},i)}_getTokenRefreshTimeoutTime(){try{const[,e]=this.value.split("."),{exp:i}=JSON.parse(atob(e));return i?Math.floor((i*1e3-Date.now())/2):Xi}catch{return Xi}}static create(e,i={}){return new Ti(e,i).init()}}function Na(s){return new Promise((t,e)=>{const i=new XMLHttpRequest;i.open("GET",s),i.addEventListener("load",()=>{const n=i.status,o=i.response;return n<200||n>299?e(new R("token-cannot-download-new-token",null)):t(o)}),i.addEventListener("error",()=>e(new Error("Network Error"))),i.addEventListener("abort",()=>e(new Error("Abort"))),i.send()})}const Kt=/^data:(\S*?);base64,/;class Ma extends sr(){constructor(e,i,n){super();h(this,"file");h(this,"xhr");h(this,"_token");h(this,"_apiAddress");if(!e)throw new R("fileuploader-missing-file",null);if(!i)throw new R("fileuploader-missing-token",null);if(!n)throw new R("fileuploader-missing-api-address",null);this.file=za(e)?Ha(e):e,this._token=i,this._apiAddress=n}onProgress(e){return this.on("progress",(i,n)=>e(n)),this}onError(e){return this.once("error",(i,n)=>e(n)),this}abort(){this.xhr.abort()}send(){return this._prepareRequest(),this._attachXHRListeners(),this._sendRequest()}_prepareRequest(){const e=new XMLHttpRequest;e.open("POST",this._apiAddress),e.setRequestHeader("Authorization",this._token.value),e.responseType="json",this.xhr=e}_attachXHRListeners(){const e=this.xhr,i=n=>()=>this.fire("error",n);e.addEventListener("error",i("Network Error")),e.addEventListener("abort",i("Abort"));/* istanbul ignore else -- @preserve */e.upload&&e.upload.addEventListener("progress",n=>{n.lengthComputable&&this.fire("progress",{total:n.total,uploaded:n.loaded})}),e.addEventListener("load",()=>{const n=e.status,o=e.response;if(n<200||n>299)return this.fire("error",o.message||o.error)})}_sendRequest(){const e=new FormData,i=this.xhr;return e.append("file",this.file),new Promise((n,o)=>{i.addEventListener("load",()=>{const r=i.status,l=i.response;return r<200||r>299?l.message?o(new R("fileuploader-uploading-data-failed",this,{message:l.message})):o(l.error):n(l)}),i.addEventListener("error",()=>o(new Error("Network Error"))),i.addEventListener("abort",()=>o(new Error("Abort"))),i.send(e)})}}function Ha(s,t=512){try{const e=s.match(Kt)[1],i=atob(s.replace(Kt,"")),n=[];for(let o=0;o<i.length;o+=t){const r=i.slice(o,o+t),l=new Array(r.length);for(let a=0;a<r.length;a++)l[a]=r.charCodeAt(a);n.push(new Uint8Array(l))}return new Blob(n,{type:e})}catch{throw new R("fileuploader-decoding-image-data-error",null)}}function za(s){if(typeof s!="string")return!1;const t=s.match(Kt);return!!(t&&t.length)}class Wa{constructor(t,e){h(this,"_token");h(this,"_apiAddress");if(!t)throw new R("uploadgateway-missing-token",null);if(!e)throw new R("uploadgateway-missing-api-address",null);this._token=t,this._apiAddress=e}upload(t){return new Ma(t,this._token,this._apiAddress)}}class $a extends to{static get pluginName(){return"CloudServicesCore"}static get isOfficialPlugin(){return!0}createToken(t,e){return new Ti(t,e)}createUploadGateway(t,e){return new Wa(t,e)}}class ja extends to{constructor(){super(...arguments);h(this,"tokenUrl");h(this,"uploadUrl");h(this,"webSocketUrl");h(this,"bundleVersion");h(this,"token",null);h(this,"_tokens",new Map)}static get pluginName(){return"CloudServices"}static get isOfficialPlugin(){return!0}static get requires(){return[$a]}async init(){const i=this.context.config.get("cloudServices")||{};for(const[o,r]of Object.entries(i))this[o]=r;if(!this.tokenUrl){this.token=null;return}const n=this.context.plugins.get("CloudServicesCore");this.token=await n.createToken(this.tokenUrl).init(),this._tokens.set(this.tokenUrl,this.token)}async registerTokenUrl(e){if(this._tokens.has(e))return this.getTokenFor(e);const n=await this.context.plugins.get("CloudServicesCore").createToken(e).init();return this._tokens.set(e,n),n}getTokenFor(e){const i=this._tokens.get(e);if(!i)throw new R("cloudservices-token-not-registered",this);return i}destroy(){super.destroy();for(const e of this._tokens.values())e.destroy()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function gt(s){const t=s.t,e=s.config.get("codeBlock.languages");for(const i of e)i.label==="Plain text"&&(i.label=t("Plain text")),i.class===void 0&&(i.class=`language-${i.language}`);return e}function ht(s,t,e){const i={};for(const n of s)if(t==="class"){const o=n[t].split(" ").shift();i[o]=n[e]}else i[n[t]]=n[e];return i}function Ei(s){return s.data.match(/^(\s*)/)[0]}function qa(s,t){const e=s.createDocumentFragment(),i=t.split(`
`),n=i.reduce((o,r,l)=>(o.push(r),l<i.length-1&&o.push(s.createElement("br")),o),[]);return s.appendChild(n,e),e}function Zt(s){const t=s.document.selection,e=[];if(t.isCollapsed)return[t.anchor];const i=t.getFirstRange().getWalker({ignoreElementEnd:!0,direction:"backward"});for(const{item:n}of i){let o=n.is("$textProxy")?n.textNode:n;const r=o.parent;if(!r.is("element","codeBlock")||o.is("element","softBreak"))continue;for(;o.previousSibling&&!o.previousSibling.is("element","softBreak");)o=o.previousSibling;const l=o.is("$text")?o.startOffset+Ei(o).length:o.startOffset,a=s.createPositionAt(r,l);e.every(c=>!c.isEqual(a))&&e.push(a)}return e}function zo(s){const t=U(s.getSelectedBlocks());return!!t&&t.is("element","codeBlock")}function Yi(s,t){return t.is("rootElement")||s.isLimit(t)?!1:s.checkChild(t.parent,"codeBlock")}function Qi(s,t,e,i){const n=ht(t,"language","label"),o=e.getAttribute("language");if(o in n){const r=n[o];return s(i==="enter"?"Entering %0 code snippet":"Leaving %0 code snippet",r)}return s(i==="enter"?"Entering code snippet":"Leaving code snippet")}function Wo(s,t){for(s.textNode&&(s=t.createPositionBefore(s.textNode));s.nodeBefore&&!s.nodeBefore.is("element","softBreak");)s=t.createPositionBefore(s.nodeBefore);const e=s.nodeAfter;return e&&e.is("$text")?e:null}class Ga extends y{constructor(e){super(e);h(this,"_lastLanguage");this._lastLanguage=null}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const i=this.editor,n=i.model,o=n.document.selection,l=gt(i)[0],a=Array.from(o.getSelectedBlocks()),c=e.forceValue==null?!this.value:e.forceValue,u=Ka(e,this._lastLanguage,l.language);n.change(d=>{c?this._applyCodeBlock(d,a,u):this._removeCodeBlock(d,a)})}_getValue(){const e=this.editor.model.document.selection,i=U(e.getSelectedBlocks());return!!(i&&i.is("element","codeBlock"))?i.getAttribute("language"):!1}_checkEnabled(){if(this.value)return!0;const e=this.editor.model.document.selection,i=this.editor.model.schema,n=U(e.getSelectedBlocks());return n?Yi(i,n):!1}_applyCodeBlock(e,i,n){this._lastLanguage=n;const o=this.editor.model.schema,r=i.filter(l=>Yi(o,l));for(const l of r)e.rename(l,"codeBlock"),e.setAttribute("language",n,l),o.removeDisallowedAttributes([l],e),Array.from(l.getChildren()).filter(a=>!o.checkChild(l,a)).forEach(a=>e.remove(a));r.reverse().forEach((l,a)=>{const c=r[a+1];l.previousSibling===c&&(e.appendElement("softBreak",c),e.merge(e.createPositionBefore(l)))})}_removeCodeBlock(e,i){const n=i.filter(o=>o.is("element","codeBlock"));for(const o of n){const r=e.createRangeOn(o);for(const l of Array.from(r.getItems()).reverse())if(l.is("element","softBreak")&&l.parent.is("element","codeBlock")){const{position:a}=e.split(e.createPositionBefore(l)),c=a.nodeAfter;e.rename(c,"paragraph"),e.removeAttribute("language",c),e.remove(l)}e.rename(o,"paragraph"),e.removeAttribute("language",o)}}}function Ka(s,t,e){return s.language?s.language:s.usePreviousLanguageChoice&&t?t:e}class Za extends y{constructor(e){super(e);h(this,"_indentSequence");this._indentSequence=e.config.get("codeBlock.indentSequence")}refresh(){this.isEnabled=this._checkEnabled()}execute(){const i=this.editor.model;i.change(n=>{const o=Zt(i);for(const r of o){const l=n.createText(this._indentSequence);i.insertContent(l,r)}})}_checkEnabled(){return this._indentSequence?zo(this.editor.model.document.selection):!1}}class Ja extends y{constructor(e){super(e);h(this,"_indentSequence");this._indentSequence=e.config.get("codeBlock.indentSequence")}refresh(){this.isEnabled=this._checkEnabled()}execute(){const i=this.editor.model;i.change(()=>{const n=Zt(i);for(const o of n){const r=en(i,o,this._indentSequence);r&&i.deleteContent(i.createSelection(r))}})}_checkEnabled(){if(!this._indentSequence)return!1;const e=this.editor.model;return zo(e.document.selection)?Zt(e).some(i=>en(e,i,this._indentSequence)):!1}}function en(s,t,e){const i=Wo(t,s);if(!i)return null;const n=Ei(i),o=n.lastIndexOf(e);if(o+e.length!==n.length||o===-1)return null;const{parent:r,startOffset:l}=i;return s.createRange(s.createPositionAt(r,l+o),s.createPositionAt(r,l+o+e.length))}function tn(s,t,e=!1){const i=ht(t,"language","class"),n=ht(t,"language","label");return(o,r,l)=>{const{writer:a,mapper:c,consumable:u}=l;if(!u.consume(r.item,"insert"))return;const d=r.item.getAttribute("language"),m=c.toViewPosition(s.createPositionBefore(r.item)),g={};e&&(g["data-language"]=n[d],g.spellcheck="false");const f=i[d]?{class:i[d]}:void 0,p=a.createContainerElement("code",f),b=a.createContainerElement("pre",g,p);a.insert(m,b),c.bindElements(r.item,p)}}function Xa(s){return(t,e,i)=>{if(e.item.parent.name!=="codeBlock")return;const{writer:n,mapper:o,consumable:r}=i;if(!r.consume(e.item,"insert"))return;const l=o.toViewPosition(s.createPositionBefore(e.item));n.insert(l,n.createText(`
`))}}function Ya(s,t){const e=ht(t,"class","language"),i=t[0].language;return(n,o,r)=>{const l=o.viewItem,a=l.parent;if(!a||!a.is("element","pre")||o.modelCursor.findAncestor("codeBlock"))return;const{consumable:c,writer:u}=r;if(!c.test(l,{name:!0}))return;const d=u.createElement("codeBlock"),m=[...l.getClassNames()];m.length||m.push("");for(const g of m){const f=e[g];if(f){u.setAttribute("language",f,d);break}}d.hasAttribute("language")||u.setAttribute("language",i,d),r.convertChildren(l,d),r.safeInsert(d,o.modelCursor)&&(c.consume(l,{name:!0}),r.updateConversionResult(d,o))}}function Qa(){return(s,t,{consumable:e,writer:i})=>{let n=t.modelCursor;if(!e.test(t.viewItem)||!n.findAncestor("codeBlock"))return;e.consume(t.viewItem);const r=t.viewItem.data.split(`
`).map(a=>i.createText(a)),l=r[r.length-1];for(const a of r)if(i.insert(a,n),n=n.getShiftedBy(a.offsetSize),a!==l){const c=i.createElement("softBreak");i.insert(c,n),n=i.createPositionAfter(c)}t.modelRange=i.createRange(t.modelCursor,n),t.modelCursor=n}}function ec(){return(s,t,{consumable:e})=>{const i=t.viewItem;if(i.findAncestor("pre"))return;const n=Array.from(i.getChildren()),o=n.find(r=>r.is("element","code"));if(o)for(const r of n)r===o||!r.is("$text")||e.consume(r,{name:!0})}}const $o="paragraph";class tc extends w{static get pluginName(){return"CodeBlockEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[io]}constructor(t){super(t),t.config.define("codeBlock",{languages:[{language:"plaintext",label:"Plain text"},{language:"c",label:"C"},{language:"cs",label:"C#"},{language:"cpp",label:"C++"},{language:"css",label:"CSS"},{language:"diff",label:"Diff"},{language:"html",label:"HTML"},{language:"java",label:"Java"},{language:"javascript",label:"JavaScript"},{language:"php",label:"PHP"},{language:"python",label:"Python"},{language:"ruby",label:"Ruby"},{language:"typescript",label:"TypeScript"},{language:"xml",label:"XML"}],indentSequence:"	"})}init(){const t=this.editor,e=t.model.schema,i=t.model,n=t.editing.view,o=gt(t);t.commands.add("codeBlock",new Ga(t)),t.commands.add("indentCodeBlock",new Za(t)),t.commands.add("outdentCodeBlock",new Ja(t)),this.listenTo(n.document,"tab",(r,l)=>{const a=l.shiftKey?"outdentCodeBlock":"indentCodeBlock";t.commands.get(a).isEnabled&&(t.execute(a),l.stopPropagation(),l.preventDefault(),r.stop())},{context:"pre"}),e.register("codeBlock",{allowWhere:"$block",allowChildren:"$text",disallowChildren:"$inlineObject",allowAttributes:["language"],allowAttributesOf:"$listItem",isBlock:!0}),e.addAttributeCheck((r,l)=>{const a=r.getItem(r.length-2);if(e.getAttributeProperties(l).isFormatting&&a&&a.name=="codeBlock")return!1}),t.editing.downcastDispatcher.on("insert:codeBlock",tn(i,o,!0)),t.data.downcastDispatcher.on("insert:codeBlock",tn(i,o)),t.data.downcastDispatcher.on("insert:softBreak",Xa(i),{priority:"high"}),t.data.upcastDispatcher.on("element:code",Ya(n,o)),t.data.upcastDispatcher.on("text",Qa()),t.data.upcastDispatcher.on("element:pre",ec(),{priority:"high"}),this.listenTo(t.editing.view.document,"clipboardInput",(r,l)=>{let a=i.createRange(i.document.selection.anchor);if(l.targetRanges&&(a=t.editing.mapper.toModelRange(l.targetRanges[0])),!a.start.parent.is("element","codeBlock"))return;const c=l.dataTransfer.getData("text/plain"),u=new $(t.editing.view.document);l.content=qa(u,c)}),t.plugins.has("ClipboardPipeline")&&t.plugins.get(he).on("contentInsertion",(r,l)=>{const a=t.model,c=a.document.selection;c.anchor.parent.is("element","codeBlock")&&a.change(u=>{const d=u.createRangeIn(l.content);for(const m of[...d.getItems()])m.is("node")&&!e.checkChild(c.anchor,m)&&u.remove(m)})}),this.listenTo(i,"getSelectedContent",(r,[l])=>{const a=l.anchor;l.isCollapsed||!a.parent.is("element","codeBlock")||!a.hasSameParentAs(l.focus)||i.change(c=>{const u=r.return;if(a.parent.is("element")&&(u.childCount>1||l.containsEntireContent(a.parent))){const m=c.createElement("codeBlock",a.parent.getAttributes());c.append(u,m);const g=c.createDocumentFragment();c.append(m,g),r.return=g;return}const d=u.getChild(0);e.checkAttribute(d,"code")&&c.setAttribute("code",!0,d)})})}afterInit(){const t=this.editor,e=t.commands,i=e.get("indent"),n=e.get("outdent");i&&i.registerChildCommand(e.get("indentCodeBlock"),{priority:"highest"}),n&&n.registerChildCommand(e.get("outdentCodeBlock")),this.listenTo(t.editing.view.document,"enter",(o,r)=>{t.model.document.selection.getLastPosition().parent.is("element","codeBlock")&&(!nc(t,r.isSoft)&&!oc(t,r.isSoft)&&ic(t),r.preventDefault(),o.stop())},{context:"pre"}),this._initAriaAnnouncements()}_initAriaAnnouncements(){const{model:t,ui:e,t:i}=this.editor,n=gt(this.editor);let o=null;t.document.selection.on("change:range",()=>{const r=t.document.selection.focus.parent;!e||o===r||!r.is("element")||(o&&o.is("element","codeBlock")&&e.ariaLiveAnnouncer.announce(Qi(i,n,o,"leave")),r.is("element","codeBlock")&&e.ariaLiveAnnouncer.announce(Qi(i,n,r,"enter")),o=r)})}}function ic(s){const t=s.model,e=t.document,i=e.selection.getLastPosition();let n;const o=Wo(i,t);o&&o.is("$text")&&(n=Ei(o)),s.model.change(r=>{s.execute("shiftEnter"),n&&r.insertText(n,e.selection.anchor)})}function nc(s,t){const i=s.model.document,n=s.editing.view,o=i.selection.getLastPosition(),r=o.nodeAfter;return t||!i.selection.isCollapsed||!o.isAtStart||!re(r)?!1:(s.model.change(l=>{s.execute("enter");const a=i.selection.anchor.parent.previousSibling;l.rename(a,$o),l.setSelection(a,"in"),s.model.schema.removeDisallowedAttributes([a],l),l.remove(r)}),n.scrollToTheSelection(),!0)}function oc(s,t){const e=s.model,i=e.document,n=s.editing.view,o=i.selection.getLastPosition(),r=o.nodeBefore;let l;if(t||!i.selection.isCollapsed||!o.isAtEnd||!r||!r.previousSibling)return!1;if(re(r)&&re(r.previousSibling))l=e.createRange(e.createPositionBefore(r.previousSibling),e.createPositionAfter(r));else if(Ft(r)&&re(r.previousSibling)&&re(r.previousSibling.previousSibling))l=e.createRange(e.createPositionBefore(r.previousSibling.previousSibling),e.createPositionAfter(r));else if(Ft(r)&&re(r.previousSibling)&&Ft(r.previousSibling.previousSibling)&&r.previousSibling.previousSibling&&re(r.previousSibling.previousSibling.previousSibling))l=e.createRange(e.createPositionBefore(r.previousSibling.previousSibling.previousSibling),e.createPositionAfter(r));else return!1;return s.model.change(a=>{a.remove(l),s.execute("enter");const c=i.selection.anchor.parent;a.rename(c,$o),s.model.schema.removeDisallowedAttributes([c],a)}),n.scrollToTheSelection(),!0}function Ft(s){return s&&s.is("$text")&&!s.data.match(/\S/)}function re(s){return s&&s.is("element","softBreak")}class sc extends w{static get pluginName(){return"CodeBlockUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.t,i=t.ui.componentFactory,n=gt(t),o=this._getLanguageListItemDefinitions(n),r=t.commands.get("codeBlock");i.add("codeBlock",l=>{const a=q(l,Tt),c=a.buttonView,u=e("Insert code block");return c.set({label:u,tooltip:!0,icon:_.codeBlock,isToggleable:!0}),c.bind("isOn").to(r,"value",d=>!!d),c.on("execute",()=>{t.execute("codeBlock",{usePreviousLanguageChoice:!0}),t.editing.view.focus()}),a.on("execute",d=>{t.execute("codeBlock",{language:d.source._codeBlockLanguage,forceValue:!0}),t.editing.view.focus()}),a.class="ck-code-block-dropdown",a.bind("isEnabled").to(r),Be(a,o,{role:"menu",ariaLabel:u}),a}),i.add("menuBar:codeBlock",l=>{const a=new At(l);a.buttonView.set({role:"menuitem",label:e("Code block"),icon:_.codeBlock}),a.bind("isEnabled").to(r);const c=new hi(l);c.set({ariaLabel:e("Insert code block")});for(const u of o){const d=new fi(l,a),m=new D(l);m.bind(...Object.keys(u.model)).to(u.model),m.set({isToggleable:!0,role:"menuitemcheckbox"}),m.delegate("execute").to(a),m.on("execute",()=>{t.execute("codeBlock",{language:u.model._codeBlockLanguage,forceValue:r.value!=u.model._codeBlockLanguage}),t.editing.view.focus()}),d.children.add(m),c.items.add(d)}return a.panelView.children.add(c),a})}_getLanguageListItemDefinitions(t){const i=this.editor.commands.get("codeBlock"),n=new ge;for(const o of t){const r={type:"button",model:new Ve({_codeBlockLanguage:o.language,label:o.label,role:"menuitemradio",withText:!0})};r.model.bind("isOn").to(i,"value",l=>l===r.model._codeBlockLanguage),n.add(r)}return n}}class rc extends w{static get requires(){return[tc,sc]}static get pluginName(){return"CodeBlock"}static get isOfficialPlugin(){return!0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lc extends ur{constructor(e,i){super(e);h(this,"view");h(this,"_toolbarConfig");h(this,"_elementReplacer");this.view=i,this._toolbarConfig=dr(e.config.get("toolbar")),this._elementReplacer=new no,this.listenTo(e.editing.view,"scrollToTheSelection",this._handleScrollToTheSelectionWithStickyPanel.bind(this))}get element(){return this.view.element}init(e){const i=this.editor,n=this.view,o=i.editing.view,r=n.editable,l=o.document.getRoot();r.name=l.rootName,n.render();const a=r.element;this.setEditableElement(r.name,a),n.editable.bind("isFocused").to(this.focusTracker),o.attachDomRoot(a),e&&this._elementReplacer.replace(e,this.element),this._initPlaceholder(),this._initToolbar(),n.menuBarView&&this._initMenuBar(n.menuBarView),this._initDialogPluginIntegration(),this._initContextualBalloonIntegration(),this.fire("ready")}destroy(){super.destroy();const e=this.view,i=this.editor.editing.view;this._elementReplacer.restore(),i.getDomRoot(e.editable.name)&&i.detachDomRoot(e.editable.name),e.destroy()}_initToolbar(){const e=this.view;e.stickyPanel.bind("isActive").to(this.focusTracker,"isFocused"),e.stickyPanel.limiterElement=e.element,e.stickyPanel.bind("viewportTopOffset").to(this,"viewportOffset",({top:i})=>i||0),e.toolbar.fillFromConfig(this._toolbarConfig,this.componentFactory),this.addToolbar(e.toolbar)}_initPlaceholder(){const e=this.editor,i=e.editing.view,n=i.document.getRoot(),o=e.sourceElement;let r;const l=e.config.get("placeholder");l&&(r=typeof l=="string"?l:l[this.view.editable.name]),!r&&o&&o.tagName.toLowerCase()==="textarea"&&(r=o.getAttribute("placeholder")),r&&(n.placeholder=r),pi({view:i,element:n,isDirectHost:!1,keepOnFocus:!0})}_initContextualBalloonIntegration(){if(!this.editor.plugins.has("ContextualBalloon"))return;const{stickyPanel:e}=this.view,i=this.editor.plugins.get("ContextualBalloon");i.on("getPositionOptions",o=>{const r=o.return;if(!r||!e.isSticky||!e.element)return;const l=new X(e.element).height,a=typeof r.target=="function"?r.target():r.target,c=typeof r.limiter=="function"?r.limiter():r.limiter;if(a&&c&&new X(a).height>=new X(c).height-l)return;const u={...r.viewportOffsetConfig},d=(u.top||0)+l;o.return={...r,viewportOffsetConfig:{...u,top:d}}},{priority:"low"});const n=()=>{i.visibleView&&i.updatePosition()};this.listenTo(e,"change:isSticky",n),this.listenTo(this.editor.ui,"change:viewportOffset",n)}_handleScrollToTheSelectionWithStickyPanel(e,i,n){const o=this.view.stickyPanel;if(o.isSticky){const r=new X(o.element).height;i.viewportOffset.top+=r}else{const r=()=>{this.editor.editing.view.scrollToTheSelection(n)};this.listenTo(o,"change:isSticky",r),setTimeout(()=>{this.stopListening(o,"change:isSticky",r)},20)}}_initDialogPluginIntegration(){if(!this.editor.plugins.has("Dialog"))return;const e=this.view.stickyPanel,i=this.editor.plugins.get("Dialog");i.on("show",()=>{const n=i.view;n.on("moveTo",(o,r)=>{if(!e.isSticky||n.wasMoved)return;const l=new X(e.contentPanelElement);r[1]<l.bottom+zi.defaultOffset&&(r[1]=l.bottom+zi.defaultOffset)},{priority:"high"})},{priority:"low"})}}class ac extends mr{constructor(e,i,n={}){super(e);h(this,"stickyPanel");h(this,"toolbar");h(this,"editable");this.stickyPanel=new gr(e),this.toolbar=new at(e,{shouldGroupWhenFull:n.shouldToolbarGroupWhenFull}),n.useMenuBar&&(this.menuBarView=new hr(e)),this.editable=new fr(e,i,void 0,{label:n.label})}render(){super.render(),this.menuBarView?this.stickyPanel.content.addMany([this.menuBarView,this.toolbar]):this.stickyPanel.content.add(this.toolbar),this.top.add(this.stickyPanel),this.main.add(this.editable)}}class cc extends rr(pr){constructor(e,i={}){if(!it(e)&&i.initialData!==void 0)throw new R("editor-create-initial-data",null);super(i);h(this,"ui");this.config.define("menuBar.isVisible",!1),this.config.get("initialData")===void 0&&this.config.set("initialData",uc(e)),it(e)&&(this.sourceElement=e),this.model.document.createRoot();const n=!this.config.get("toolbar.shouldNotGroupWhenFull"),o=this.config.get("menuBar"),r=new ac(this.locale,this.editing.view,{shouldToolbarGroupWhenFull:n,useMenuBar:o.isVisible,label:this.config.get("label")});this.ui=new lc(this,r),lr(this)}destroy(){return this.sourceElement&&this.updateSourceElement(),this.ui.destroy(),super.destroy()}static create(e,i={}){return new Promise(n=>{const o=new this(e,i);n(o.initPlugins().then(()=>o.ui.init(it(e)?e:null)).then(()=>o.data.init(o.config.get("initialData"))).then(()=>o.fire("ready")).then(()=>o))})}}function uc(s){return it(s)?ar(s):s}function it(s){return cr(s)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class dc extends y{constructor(t){super(t),this.affectsData=!1}execute(){const t=this.editor.model,e=t.document.selection;let i=t.schema.getLimitElement(e);if(e.containsEntireContent(i)||!nn(t.schema,i))do if(i=i.parent,!i)return;while(!nn(t.schema,i));t.change(n=>{n.setSelection(i,"in")})}}function nn(s,t){return s.isLimit(t)&&(s.checkChild(t,"$text")||s.checkChild(t,"paragraph"))}const mc=wr("Ctrl+A");class gc extends w{static get pluginName(){return"SelectAllEditing"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.t,n=t.editing.view.document;t.commands.add("selectAll",new dc(t)),this.listenTo(n,"keydown",(o,r)=>{br(r)===mc&&(t.execute("selectAll"),r.preventDefault())}),t.accessibility.addKeystrokeInfos({keystrokes:[{label:e("Select all"),keystroke:"CTRL+A"}]})}}var hc='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M.75 15.5a.75.75 0 0 1 .75.75V18l.008.09A.5.5 0 0 0 2 18.5h1.75a.75.75 0 1 1 0 1.5H1.5l-.144-.007a1.5 1.5 0 0 1-1.35-1.349L0 18.5v-2.25a.75.75 0 0 1 .75-.75zm18.5 0a.75.75 0 0 1 .75.75v2.25l-.007.144a1.5 1.5 0 0 1-1.349 1.35L18.5 20h-2.25a.75.75 0 1 1 0-1.5H18a.5.5 0 0 0 .492-.41L18.5 18v-1.75a.75.75 0 0 1 .75-.75zm-10.45 3c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm.45-5.5a.75.75 0 1 1 0 1.5h-8.5a.75.75 0 1 1 0-1.5h8.5zM1.3 11c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5H4.75a.75.75 0 1 1 0-1.5h10.5zM1.3 7c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5h-2.5a.75.75 0 1 1 0-1.5h2.5zm-5 0a.75.75 0 1 1 0 1.5h-5.5a.75.75 0 0 1 0-1.5h5.5zm-6.5-5a.75.75 0 0 1 0 1.5H2a.5.5 0 0 0-.492.41L1.5 2v1.75a.75.75 0 0 1-1.5 0V1.5l.007-.144A1.5 1.5 0 0 1 1.356.006L1.5 0h2.25zM18.5 0l.144.007a1.5 1.5 0 0 1 1.35 1.349L20 1.5v2.25a.75.75 0 1 1-1.5 0V2l-.008-.09A.5.5 0 0 0 18 1.5h-1.75a.75.75 0 1 1 0-1.5h2.25zM8.8 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6z"/></svg>';class fc extends w{static get pluginName(){return"SelectAllUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor;t.ui.componentFactory.add("selectAll",()=>{const e=this._createButton(I);return e.set({tooltip:!0}),e}),t.ui.componentFactory.add("menuBar:selectAll",()=>this._createButton(D))}_createButton(t){const e=this.editor,i=e.locale,n=e.commands.get("selectAll"),o=new t(e.locale),r=i.t;return o.set({label:r("Select all"),icon:hc,keystroke:"Ctrl+A"}),o.bind("isEnabled").to(n,"isEnabled"),this.listenTo(o,"execute",()=>{e.execute("selectAll"),e.editing.view.focus()}),o}}class jo extends w{static get requires(){return[gc,fc]}static get pluginName(){return"SelectAll"}static get isOfficialPlugin(){return!0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qo extends y{constructor(e){super(e);h(this,"_stack",[]);h(this,"_createdBatches",new WeakSet);this.refresh(),this._isEnabledBasedOnSelection=!1,this.listenTo(e.data,"set",(i,n)=>{n[1]={...n[1]};const o=n[1];o.batchType||(o.batchType={isUndoable:!1})},{priority:"high"}),this.listenTo(e.data,"set",(i,n)=>{n[1].batchType.isUndoable||this.clearStack()})}refresh(){this.isEnabled=this._stack.length>0}get createdBatches(){return this._createdBatches}addBatch(e){const i=this.editor.model.document.selection,n={ranges:i.hasOwnRange?Array.from(i.getRanges()):[],isBackward:i.isBackward};this._stack.push({batch:e,selection:n}),this.refresh()}clearStack(){this._stack=[],this.refresh()}_restoreSelection(e,i,n){const o=this.editor.model,r=o.document,l=[],a=e.map(u=>u.getTransformedByOperations(n)),c=a.flat();for(const u of a){const d=u.filter(m=>m.root!=r.graveyard).filter(m=>!bc(m,c));d.length&&(pc(d),l.push(d[0]))}l.length&&o.change(u=>{u.setSelection(l,{backward:i})})}_undo(e,i){const n=this.editor.model,o=n.document;this._createdBatches.add(i);const r=e.operations.slice().filter(l=>l.isDocumentOperation);r.reverse();for(const l of r){const a=l.baseVersion+1,c=Array.from(o.history.getOperations(a)),d=Cr([l.getReversed()],c,{useRelations:!0,document:this.editor.model.document,padWithNoOps:!1,forceWeakRemove:!0}).operationsA;for(let m of d){const g=m.affectedSelectable;g&&!n.canEditAt(g)&&(m=new vr(m.baseVersion)),i.addOperation(m),n.applyOperation(m),o.history.setOperationAsUndone(l,m)}}}}function pc(s){s.sort((t,e)=>t.start.isBefore(e.start)?-1:1);for(let t=1;t<s.length;t++){const i=s[t-1].getJoined(s[t],!0);i&&(t--,s.splice(t,2,i))}}function bc(s,t){return t.some(e=>e!==s&&e.containsRange(s,!0))}class wc extends qo{execute(t=null){const e=t?this._stack.findIndex(o=>o.batch==t):this._stack.length-1,i=this._stack.splice(e,1)[0],n=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(n,()=>{this._undo(i.batch,n);const o=this.editor.model.document.history.getOperations(i.batch.baseVersion);this._restoreSelection(i.selection.ranges,i.selection.isBackward,o)}),this.fire("revert",i.batch,n),this.refresh()}}class Cc extends qo{execute(){const t=this._stack.pop(),e=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(e,()=>{const n=t.batch.operations[t.batch.operations.length-1].baseVersion+1,o=this.editor.model.document.history.getOperations(n);this._restoreSelection(t.selection.ranges,t.selection.isBackward,o),this._undo(t.batch,e)}),this.refresh()}}class vc extends w{constructor(){super(...arguments);h(this,"_undoCommand");h(this,"_redoCommand");h(this,"_batchRegistry",new WeakSet)}static get pluginName(){return"UndoEditing"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,i=e.t;this._undoCommand=new wc(e),this._redoCommand=new Cc(e),e.commands.add("undo",this._undoCommand),e.commands.add("redo",this._redoCommand),this.listenTo(e.model,"applyOperation",(n,o)=>{const r=o[0];if(!r.isDocumentOperation)return;const l=r.batch,a=this._redoCommand.createdBatches.has(l),c=this._undoCommand.createdBatches.has(l);this._batchRegistry.has(l)||(this._batchRegistry.add(l),l.isUndoable&&(a?this._undoCommand.addBatch(l):c||(this._undoCommand.addBatch(l),this._redoCommand.clearStack())))},{priority:"highest"}),this.listenTo(this._undoCommand,"revert",(n,o,r)=>{this._redoCommand.addBatch(r)}),e.keystrokes.set("CTRL+Z","undo"),e.keystrokes.set("CTRL+Y","redo"),e.keystrokes.set("CTRL+SHIFT+Z","redo"),e.accessibility.addKeystrokeInfos({keystrokes:[{label:i("Undo"),keystroke:"CTRL+Z"},{label:i("Redo"),keystroke:[["CTRL+Y"],["CTRL+SHIFT+Z"]]}]})}}class _c extends w{static get pluginName(){return"UndoUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.locale,i=t.t,n=e.uiLanguageDirection=="ltr"?_.undo:_.redo,o=e.uiLanguageDirection=="ltr"?_.redo:_.undo;this._addButtonsToFactory("undo",i("Undo"),"CTRL+Z",n),this._addButtonsToFactory("redo",i("Redo"),"CTRL+Y",o)}_addButtonsToFactory(t,e,i,n){const o=this.editor;o.ui.componentFactory.add(t,()=>{const r=this._createButton(I,t,e,i,n);return r.set({tooltip:!0}),r}),o.ui.componentFactory.add("menuBar:"+t,()=>this._createButton(D,t,e,i,n))}_createButton(t,e,i,n,o){const r=this.editor,l=r.locale,a=r.commands.get(e),c=new t(l);return c.set({label:i,icon:o,keystroke:n}),c.bind("isEnabled").to(a,"isEnabled"),this.listenTo(c,"execute",()=>{r.execute(e),r.editing.view.focus()}),c}}class Si extends w{static get requires(){return[vc,_c]}static get pluginName(){return"Undo"}static get isOfficialPlugin(){return!0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kc extends w{static get requires(){return[oo,so,ro,jo,io,_r,Si]}static get pluginName(){return"Essentials"}static get isOfficialPlugin(){return!0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yc extends y{constructor(t){super(t),this._isEnabledBasedOnSelection=!1}refresh(){const t=this.editor.model,e=t.document,i=U(e.selection.getSelectedBlocks());this.value=!!i&&i.is("element","paragraph"),this.isEnabled=!!i&&on(i,t.schema)}execute(t={}){const e=this.editor.model,i=e.document,n=t.selection||i.selection;e.canEditAt(n)&&e.change(o=>{const r=n.getSelectedBlocks();for(const l of r)!l.is("element","paragraph")&&on(l,e.schema)&&o.rename(l,"paragraph")})}}function on(s,t){return t.checkChild(s.parent,"paragraph")&&!t.isObject(s)}class Ic extends y{constructor(t){super(t),this._isEnabledBasedOnSelection=!1}execute(t){const e=this.editor.model,i=t.attributes;let n=t.position;e.canEditAt(n)&&e.change(o=>{if(n=this._findPositionToInsertParagraph(n,o),!n)return;const r=o.createElement("paragraph");i&&e.schema.setAllowedAttributes(r,i,o),e.insertContent(r,n),o.setSelection(r,"in")})}_findPositionToInsertParagraph(t,e){const i=this.editor.model;if(i.schema.checkChild(t,"paragraph"))return t;const n=i.schema.findAllowedParent(t,"paragraph");if(!n)return null;const o=t.parent,r=i.schema.checkChild(o,"$text");return o.isEmpty||r&&t.isAtEnd?i.createPositionAfter(o):!o.isEmpty&&r&&t.isAtStart?i.createPositionBefore(o):e.split(t,n).position}}const yt=class yt extends w{static get pluginName(){return"Paragraph"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.model;t.commands.add("paragraph",new yc(t)),t.commands.add("insertParagraph",new Ic(t)),e.schema.register("paragraph",{inheritAllFrom:"$block"}),t.conversion.elementToElement({model:"paragraph",view:"p"}),t.conversion.for("upcast").elementToElement({model:(i,{writer:n})=>!yt.paragraphLikeElements.has(i.name)||i.isEmpty?null:n.createElement("paragraph"),view:/.+/,converterPriority:"low"})}};h(yt,"paragraphLikeElements",new Set(["blockquote","dd","div","dt","h1","h2","h3","h4","h5","h6","li","p","td","th"]));let ft=yt;/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ac extends y{constructor(e,i){super(e);h(this,"modelElements");this.modelElements=i}refresh(){const e=U(this.editor.model.document.selection.getSelectedBlocks());this.value=!!e&&this.modelElements.includes(e.name)&&e.name,this.isEnabled=!!e&&this.modelElements.some(i=>sn(e,i,this.editor.model.schema))}execute(e){const i=this.editor.model,n=i.document,o=e.value;i.change(r=>{const l=Array.from(n.selection.getSelectedBlocks()).filter(a=>sn(a,o,i.schema));for(const a of l)a.is("element",o)||r.rename(a,o)})}}function sn(s,t,e){return e.checkChild(s.parent,t)&&!e.isObject(s)}const rn="paragraph";class Tc extends w{static get pluginName(){return"HeadingEditing"}static get isOfficialPlugin(){return!0}constructor(t){super(t),t.config.define("heading",{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h4",title:"Heading 3",class:"ck-heading_heading3"}]})}static get requires(){return[ft]}init(){const t=this.editor,e=t.config.get("heading.options"),i=[];for(const n of e)n.model!=="paragraph"&&(t.model.schema.register(n.model,{inheritAllFrom:"$block"}),t.conversion.elementToElement(n),i.push(n.model));this._addDefaultH1Conversion(t),t.commands.add("heading",new Ac(t,i))}afterInit(){const t=this.editor,e=t.commands.get("enter"),i=t.config.get("heading.options");e&&this.listenTo(e,"afterExecute",(n,o)=>{const r=t.model.document.selection.getFirstPosition().parent;i.some(a=>r.is("element",a.model))&&!r.is("element",rn)&&r.childCount===0&&o.writer.rename(r,rn)})}_addDefaultH1Conversion(t){t.conversion.for("upcast").elementToElement({model:"heading1",view:"h1",converterPriority:xe.low+1})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ec(s){const t=s.t,e={Paragraph:t("Paragraph"),"Heading 1":t("Heading 1"),"Heading 2":t("Heading 2"),"Heading 3":t("Heading 3"),"Heading 4":t("Heading 4"),"Heading 5":t("Heading 5"),"Heading 6":t("Heading 6")};return s.config.get("heading.options").map(i=>{const n=e[i.title];return n&&n!=i.title&&(i.title=n),i})}class Sc extends w{static get pluginName(){return"HeadingUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.t,i=Ec(t),n=e("Choose heading"),o=e("Heading");t.ui.componentFactory.add("heading",r=>{const l={},a=new ge,c=t.commands.get("heading"),u=t.commands.get("paragraph"),d=[c];for(const g of i){const f={type:"button",model:new Ve({label:g.title,class:g.class,role:"menuitemradio",withText:!0})};g.model==="paragraph"?(f.model.bind("isOn").to(u,"value"),f.model.set("commandName","paragraph"),d.push(u)):(f.model.bind("isOn").to(c,"value",p=>p===g.model),f.model.set({commandName:"heading",commandValue:g.model})),a.add(f),l[g.model]=g.title}const m=q(r);return Be(m,a,{ariaLabel:o,role:"menu"}),m.buttonView.set({ariaLabel:o,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:o}),m.extendTemplate({attributes:{class:["ck-heading-dropdown"]}}),m.bind("isEnabled").toMany(d,"isEnabled",(...g)=>g.some(f=>f)),m.buttonView.bind("label").to(c,"value",u,"value",(g,f)=>{const p=f?"paragraph":g;return typeof p=="boolean"||!l[p]?n:l[p]}),m.buttonView.bind("ariaLabel").to(c,"value",u,"value",(g,f)=>{const p=f?"paragraph":g;return typeof p=="boolean"||!l[p]?o:`${l[p]}, ${o}`}),this.listenTo(m,"execute",g=>{const{commandName:f,commandValue:p}=g.source;t.execute(f,p?{value:p}:void 0),t.editing.view.focus()}),m}),t.ui.componentFactory.add("menuBar:heading",r=>{const l=new At(r),a=t.commands.get("heading"),c=t.commands.get("paragraph"),u=[a],d=new hi(r);l.set({class:"ck-heading-dropdown"}),d.set({ariaLabel:e("Heading"),role:"menu"}),l.buttonView.set({label:e("Heading")}),l.panelView.children.add(d);for(const m of i){const g=new fi(r,l),f=new D(r);g.children.add(f),d.items.add(g),f.set({isToggleable:!0,label:m.title,role:"menuitemradio",class:m.class}),f.delegate("execute").to(l),f.on("execute",()=>{const p=m.model==="paragraph"?"paragraph":"heading";t.execute(p,{value:m.model}),t.editing.view.focus()}),m.model==="paragraph"?(f.bind("isOn").to(c,"value"),u.push(c)):f.bind("isOn").to(a,"value",p=>p===m.model)}return l.bind("isEnabled").toMany(u,"isEnabled",(...m)=>m.some(g=>g)),l})}}class xc extends w{static get requires(){return[Tc,Sc]}static get pluginName(){return"Heading"}static get isOfficialPlugin(){return!0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Rc extends y{refresh(){const t=this.editor.model,e=t.schema,i=t.document.selection,n=ln(i);this.isEnabled=Vc(i,e,t),this.value=n?n.getAttribute("value")||"":null}execute(t){const e=this.editor.model,i=e.document.selection;e.change(n=>{let o;this.value!==null?o=ln(i):(o=n.createElement("rawHtml"),e.insertObject(o,null,null,{setSelection:"on"})),n.setAttribute("value",t,o)})}}function Vc(s,t,e){const i=Pc(s,e);return t.checkChild(i,"rawHtml")}function Pc(s,t){const i=lo(s,t).start.parent;return i.isEmpty&&!i.is("rootElement")?i.parent:i}function ln(s){const t=s.getSelectedElement();return t&&t.is("element","rawHtml")?t:null}class Bc extends w{constructor(e){super(e);h(this,"_widgetButtonViewReferences",new Set);e.config.define("htmlEmbed",{showPreviews:!1,sanitizeHtml:i=>(N("html-embed-provide-sanitize-function"),{html:i,hasChanged:!1})})}static get pluginName(){return"HtmlEmbedEditing"}static get isOfficialPlugin(){return!0}init(){const e=this.editor;e.model.schema.register("rawHtml",{inheritAllFrom:"$blockObject",allowAttributes:["value"]}),e.commands.add("htmlEmbed",new Rc(e)),this._setupConversion()}_setupConversion(){const e=this.editor,i=e.t,n=e.editing.view,o=this._widgetButtonViewReferences,r=e.config.get("htmlEmbed");this.editor.editing.view.on("render",()=>{for(const d of o){if(d.element&&d.element.isConnected)return;d.destroy(),o.delete(d)}},{priority:"lowest"}),e.data.registerRawContentMatcher({name:"div",classes:"raw-html-embed"}),e.conversion.for("upcast").elementToElement({view:{name:"div",classes:"raw-html-embed"},model:(d,{writer:m})=>m.createElement("rawHtml",{value:d.getCustomProperty("$rawContent")})}),e.conversion.for("dataDowncast").elementToElement({model:"rawHtml",view:(d,{writer:m})=>m.createRawElement("div",{class:"raw-html-embed"},function(g){g.innerHTML=d.getAttribute("value")||""})}),e.conversion.for("editingDowncast").elementToStructure({model:{name:"rawHtml",attributes:["value"]},view:(d,{writer:m})=>{let g,f,p;const b=m.createRawElement("div",{class:"raw-html-embed__content-wrapper"},function(k){g=k,l({editor:e,domElement:k,state:f,props:p}),g.addEventListener("mousedown",()=>{if(f.isEditable){const T=e.model;T.document.selection.getSelectedElement()!==d&&T.change(oe=>oe.setSelection(d,"on"))}},!0)}),C={makeEditable(){f=Object.assign({},f,{isEditable:!0}),l({domElement:g,editor:e,state:f,props:p}),n.change(k=>{k.setAttribute("data-cke-ignore-events","true",b)}),g.querySelector("textarea").focus()},save(k){k!==f.getRawHtmlValue()?(e.execute("htmlEmbed",k),e.editing.view.focus()):this.cancel()},cancel(){f=Object.assign({},f,{isEditable:!1}),l({domElement:g,editor:e,state:f,props:p}),e.editing.view.focus(),n.change(k=>{k.removeAttribute("data-cke-ignore-events",b)})}};f={showPreviews:r.showPreviews,isEditable:!1,getRawHtmlValue:()=>d.getAttribute("value")||""},p={sanitizeHtml:r.sanitizeHtml,textareaPlaceholder:i("Paste raw HTML here..."),onEditClick(){C.makeEditable()},onSaveClick(k){C.save(k)},onCancelClick(){C.cancel()}};const v=m.createContainerElement("div",{class:"raw-html-embed","data-html-embed-label":i("HTML snippet"),dir:e.locale.uiLanguageDirection},b);return m.setCustomProperty("rawHtmlApi",C,v),m.setCustomProperty("rawHtml",!0,v),je(v,m,{label:i("HTML snippet"),hasSelectionHandle:!0})}});function l({editor:d,domElement:m,state:g,props:f}){m.textContent="";const p=m.ownerDocument;let b;if(g.isEditable){const v={isDisabled:!1,placeholder:f.textareaPlaceholder};b=c({domDocument:p,state:g,props:v}),m.append(b)}else if(g.showPreviews){const v={sanitizeHtml:f.sanitizeHtml};m.append(u({domDocument:p,state:g,props:v,editor:d}))}else{const v={isDisabled:!0,placeholder:f.textareaPlaceholder};m.append(c({domDocument:p,state:g,props:v}))}const C={onEditClick:f.onEditClick,onSaveClick:()=>{f.onSaveClick(b.value)},onCancelClick:f.onCancelClick};m.prepend(a({editor:d,domDocument:p,state:g,props:C}))}function a({editor:d,domDocument:m,state:g,props:f}){const p=le(m,"div",{class:"raw-html-embed__buttons-wrapper"});if(g.isEditable){const b=Ut(d,"save",f.onSaveClick),C=Ut(d,"cancel",f.onCancelClick);p.append(b.element,C.element),o.add(b).add(C)}else{const b=Ut(d,"edit",f.onEditClick);p.append(b.element),o.add(b)}return p}function c({domDocument:d,state:m,props:g}){const f=le(d,"textarea",{placeholder:g.placeholder,class:"ck ck-reset ck-input ck-input-text raw-html-embed__source"});return f.disabled=g.isDisabled,f.value=m.getRawHtmlValue(),f}function u({editor:d,domDocument:m,state:g,props:f}){const p=f.sanitizeHtml(g.getRawHtmlValue()),b=g.getRawHtmlValue().length>0?i("No preview available"):i("Empty snippet content"),C=le(m,"div",{class:"ck ck-reset_all raw-html-embed__preview-placeholder"},b),v=le(m,"div",{class:"raw-html-embed__preview-content",dir:d.locale.contentLanguageDirection}),T=m.createRange().createContextualFragment(p.html);return v.appendChild(T),le(m,"div",{class:"raw-html-embed__preview"},[C,v])}}}function Ut(s,t,e){const{t:i}=s.locale,n=new I(s.locale),o=s.commands.get("htmlEmbed");return n.set({class:`raw-html-embed__${t}-button`,icon:_.pencil,tooltip:!0,tooltipPosition:s.locale.uiLanguageDirection==="rtl"?"e":"w"}),n.render(),t==="edit"?(n.set({icon:_.pencil,label:i("Edit source")}),n.bind("isEnabled").to(o)):t==="save"?(n.set({icon:_.check,label:i("Save changes")}),n.bind("isEnabled").to(o)):n.set({icon:_.cancel,label:i("Cancel")}),n.on("execute",e),n}class Lc extends w{static get pluginName(){return"HtmlEmbedUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,i=t.locale.t;t.ui.componentFactory.add("htmlEmbed",()=>{const n=this._createButton(I);return n.set({tooltip:!0,label:i("Insert HTML")}),n}),t.ui.componentFactory.add("menuBar:htmlEmbed",()=>{const n=this._createButton(D);return n.set({label:i("HTML snippet")}),n})}_createButton(t){const e=this.editor,i=e.commands.get("htmlEmbed"),n=new t(e.locale);return n.set({icon:_.html}),n.bind("isEnabled").to(i,"isEnabled"),this.listenTo(n,"execute",()=>{e.execute("htmlEmbed"),e.editing.view.focus(),e.editing.view.document.selection.getSelectedElement().getCustomProperty("rawHtmlApi").makeEditable()}),n}}class Oc extends w{static get requires(){return[Bc,Lc,$e]}static get pluginName(){return"HtmlEmbed"}static get isOfficialPlugin(){return!0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function me(s,t,e,i){t&&Fc(s,t,i),e&&W(s,e,i)}function W(s,t,e){if(t.attributes)for(const[i,n]of Object.entries(t.attributes))s.setAttribute(i,n,e);t.styles&&s.setStyle(t.styles,e),t.classes&&s.addClass(t.classes,e)}function Fc(s,t,e){if(t.attributes)for(const[i]of Object.entries(t.attributes))s.removeAttribute(i,e);if(t.styles)for(const i of Object.keys(t.styles))s.removeStyle(i,e);t.classes&&s.removeClass(t.classes,e)}function Uc(s,t){const e=Yr(s);let i="attributes";for(i in t)i=="classes"?e[i]=Array.from(new Set([...s[i]||[],...t[i]])):e[i]={...s[i],...t[i]};return e}function Ie(s,t,e,i,n){const o=t.getAttribute(e),r={};for(const l of["attributes","styles","classes"]){if(l!=i){o&&o[l]&&(r[l]=o[l]);continue}if(i=="classes"){const c=new Set(o&&o.classes||[]);n(c),c.size&&(r[l]=Array.from(c));continue}const a=new Map(Object.entries(o&&o[l]||{}));n(a),a.size&&(r[l]=Object.fromEntries(a))}Object.keys(r).length?t.is("documentSelection")?s.setSelectionAttribute(e,r):s.setAttribute(e,r,t):o&&(t.is("documentSelection")?s.removeSelectionAttribute(e):s.removeAttribute(e,t))}function Dc(s){return wa(s).replace(/ /g,"")}function M(s){return`html${Dc(s)}Attributes`}function xi({model:s}){return(t,e)=>e.writer.createElement(s,{htmlContent:t.getCustomProperty("$rawContent")})}function Nc(s,{view:t,isInline:e}){const i=s.t;return(n,{writer:o})=>{const r=i("HTML object"),l=Et(t,n,o),a=n.getAttribute(M(t));o.addClass("html-object-embed__content",l),a&&W(o,a,l);const c=o.createContainerElement(e?"span":"div",{class:"html-object-embed","data-html-object-embed-label":r},l);return je(c,o,{label:r})}}function Et(s,t,e){return e.createRawElement(s,null,(i,n)=>{n.setContentOf(i,t.getAttribute("htmlContent"))})}function Mc({view:s,model:t,allowEmpty:e},i){return o=>{o.on(`element:${s}`,(r,l,a)=>{let c=i.processViewAttributes(l.viewItem,a);if(!(!c&&!a.consumable.test(l.viewItem,{name:!0}))){if(c=c||{},a.consumable.consume(l.viewItem,{name:!0}),l.modelRange||(l=Object.assign(l,a.convertChildren(l.viewItem,l.modelCursor))),e&&l.modelRange.isCollapsed&&Object.keys(c).length){const u=a.writer.createElement("htmlEmptyElement");if(!a.safeInsert(u,l.modelCursor))return;const d=a.getSplitParts(u);l.modelRange=a.writer.createRange(l.modelRange.start,a.writer.createPositionAfter(d[d.length-1])),a.updateConversionResult(u,l),n(u,c,a);return}for(const u of l.modelRange.getItems())n(u,c,a)}},{priority:"low"})};function n(o,r,l){if(l.schema.checkAttribute(o,t)){const a=o.getAttribute(t),c=Uc(r,a||{});l.writer.setAttribute(t,c,o)}}}function an({model:s,view:t},e){return(i,{writer:n,consumable:o})=>{if(!i.hasAttribute(s))return null;const r=n.createContainerElement(t),l=i.getAttribute(s);return o.consume(i,`attribute:${s}`),W(n,l,r),r.getFillerOffset=()=>null,e?je(r,n):r}}function Hc({priority:s,view:t}){return(e,i)=>{if(!e)return;const{writer:n}=i,o=n.createAttributeElement(t,null,{priority:s});return W(n,e,o),o}}function He({view:s},t){return e=>{e.on(`element:${s}`,(i,n,o)=>{if(!n.modelRange||n.modelRange.isCollapsed)return;const r=t.processViewAttributes(n.viewItem,o);r&&o.writer.setAttribute(M(n.viewItem.name),r,n.modelRange)},{priority:"low"})}}function ze({view:s,model:t}){return e=>{e.on(`attribute:${M(s)}:${t}`,(i,n,o)=>{if(!o.consumable.consume(n.item,i.name))return;const{attributeOldValue:r,attributeNewValue:l}=n,a=o.writer,c=o.mapper.toViewElement(n.item);me(a,r,l,c)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */var cn={block:[{model:"codeBlock",view:"pre"},{model:"paragraph",view:"p"},{model:"blockQuote",view:"blockquote"},{model:"listItem",view:"li"},{model:"pageBreak",view:"div"},{model:"rawHtml",view:"div"},{model:"table",view:"table"},{model:"tableRow",view:"tr"},{model:"tableCell",view:"td"},{model:"tableCell",view:"th"},{model:"tableColumnGroup",view:"colgroup"},{model:"tableColumn",view:"col"},{model:"caption",view:"caption"},{model:"caption",view:"figcaption"},{model:"imageBlock",view:"img"},{model:"imageInline",view:"img"},{model:"htmlP",view:"p",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlBlockquote",view:"blockquote",modelSchema:{inheritAllFrom:"$container"}},{model:"htmlTable",view:"table",modelSchema:{allowWhere:"$block",isBlock:!0}},{model:"htmlTbody",view:"tbody",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlThead",view:"thead",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlTfoot",view:"tfoot",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlCaption",view:"caption",modelSchema:{allowIn:"htmlTable",allowChildren:"$text",isBlock:!1}},{model:"htmlColgroup",view:"colgroup",modelSchema:{allowIn:"htmlTable",allowChildren:"col",isBlock:!1}},{model:"htmlCol",view:"col",modelSchema:{allowIn:"htmlColgroup",isBlock:!1}},{model:"htmlTr",view:"tr",modelSchema:{allowIn:["htmlTable","htmlThead","htmlTbody"],isLimit:!0}},{model:"htmlTd",view:"td",modelSchema:{allowIn:"htmlTr",allowContentOf:"$container",isLimit:!0,isBlock:!1}},{model:"htmlTh",view:"th",modelSchema:{allowIn:"htmlTr",allowContentOf:"$container",isLimit:!0,isBlock:!1}},{model:"htmlFigure",view:"figure",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlFigcaption",view:"figcaption",modelSchema:{allowIn:"htmlFigure",allowChildren:"$text",isBlock:!1}},{model:"htmlAddress",view:"address",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlAside",view:"aside",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlMain",view:"main",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlDetails",view:"details",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlSummary",view:"summary",modelSchema:{allowChildren:["htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6","$text"],allowIn:"htmlDetails",isBlock:!1}},{model:"htmlDiv",view:"div",paragraphLikeModel:"htmlDivParagraph",modelSchema:{inheritAllFrom:"$container"}},{model:"htmlFieldset",view:"fieldset",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlLegend",view:"legend",modelSchema:{allowIn:"htmlFieldset",allowChildren:"$text"}},{model:"htmlHeader",view:"header",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlFooter",view:"footer",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlForm",view:"form",modelSchema:{inheritAllFrom:"$container",isBlock:!0}},{model:"htmlHgroup",view:"hgroup",modelSchema:{allowIn:["$root","$container"],allowChildren:["paragraph","htmlP","htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6"],isBlock:!1}},{model:"htmlH1",view:"h1",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH2",view:"h2",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH3",view:"h3",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH4",view:"h4",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH5",view:"h5",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH6",view:"h6",modelSchema:{inheritAllFrom:"$block"}},{model:"$htmlList",modelSchema:{allowWhere:"$container",allowChildren:["$htmlList","htmlLi"],isBlock:!1}},{model:"htmlDir",view:"dir",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlMenu",view:"menu",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlUl",view:"ul",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlOl",view:"ol",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlLi",view:"li",modelSchema:{allowIn:"$htmlList",allowChildren:"$text",isBlock:!1}},{model:"htmlPre",view:"pre",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlArticle",view:"article",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlSection",view:"section",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlNav",view:"nav",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlDivDl",view:"div",modelSchema:{allowChildren:["htmlDt","htmlDd"],allowIn:"htmlDl"}},{model:"htmlDl",view:"dl",modelSchema:{allowWhere:"$container",allowChildren:["htmlDt","htmlDd","htmlDivDl"],isBlock:!1}},{model:"htmlDt",view:"dt",modelSchema:{allowChildren:"$block",isBlock:!1}},{model:"htmlDd",view:"dd",modelSchema:{allowChildren:"$block",isBlock:!1}},{model:"htmlCenter",view:"center",modelSchema:{inheritAllFrom:"$container",isBlock:!1}}],inline:[{model:"htmlLiAttributes",view:"li",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlOlAttributes",view:"ol",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlUlAttributes",view:"ul",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlFigureAttributes",view:"figure",appliesToBlock:"table"},{model:"htmlTheadAttributes",view:"thead",appliesToBlock:"table"},{model:"htmlTbodyAttributes",view:"tbody",appliesToBlock:"table"},{model:"htmlFigureAttributes",view:"figure",appliesToBlock:"imageBlock"},{model:"htmlAcronym",view:"acronym",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlTt",view:"tt",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlFont",view:"font",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlTime",view:"time",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlVar",view:"var",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBig",view:"big",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSmall",view:"small",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSamp",view:"samp",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlQ",view:"q",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlOutput",view:"output",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlKbd",view:"kbd",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBdi",view:"bdi",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBdo",view:"bdo",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlAbbr",view:"abbr",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlA",view:"a",priority:5,coupledAttribute:"linkHref"},{model:"htmlStrong",view:"strong",coupledAttribute:"bold",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlB",view:"b",coupledAttribute:"bold",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlI",view:"i",coupledAttribute:"italic",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlEm",view:"em",coupledAttribute:"italic",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlS",view:"s",coupledAttribute:"strikethrough",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlDel",view:"del",coupledAttribute:"strikethrough",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlIns",view:"ins",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlU",view:"u",coupledAttribute:"underline",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSub",view:"sub",coupledAttribute:"subscript",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSup",view:"sup",coupledAttribute:"superscript",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlCode",view:"code",coupledAttribute:"code",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlMark",view:"mark",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSpan",view:"span",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlCite",view:"cite",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlLabel",view:"label",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlDfn",view:"dfn",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlObject",view:"object",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlIframe",view:"iframe",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlInput",view:"input",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlButton",view:"button",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlTextarea",view:"textarea",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlSelect",view:"select",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlVideo",view:"video",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlEmbed",view:"embed",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlOembed",view:"oembed",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlAudio",view:"audio",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlImg",view:"img",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlCanvas",view:"canvas",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlMeter",view:"meter",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlProgress",view:"progress",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlScript",view:"script",modelSchema:{allowWhere:["$text","$block"],isInline:!0}},{model:"htmlStyle",view:"style",modelSchema:{allowWhere:["$text","$block"],isInline:!0}},{model:"htmlCustomElement",view:"$customElement",modelSchema:{allowWhere:["$text","$block"],allowAttributesOf:"$inlineObject",isInline:!0}}]};class Pe extends w{constructor(){super(...arguments);h(this,"_definitions",[])}static get pluginName(){return"DataSchema"}static get isOfficialPlugin(){return!0}init(){for(const e of cn.block)this.registerBlockElement(e);for(const e of cn.inline)this.registerInlineElement(e)}registerBlockElement(e){this._definitions.push({...e,isBlock:!0})}registerInlineElement(e){this._definitions.push({...e,isInline:!0})}extendBlockElement(e){this._extendDefinition({...e,isBlock:!0})}extendInlineElement(e){this._extendDefinition({...e,isInline:!0})}getDefinitionsForView(e,i=!1){const n=new Set;for(const o of this._getMatchingViewDefinitions(e)){if(i)for(const r of this._getReferences(o.model))n.add(r);n.add(o)}return n}getDefinitionsForModel(e){return this._definitions.filter(i=>i.model==e)}_getMatchingViewDefinitions(e){return this._definitions.filter(i=>i.view&&zc(e,i.view))}*_getReferences(e){const i=["inheritAllFrom","inheritTypesFrom","allowWhere","allowContentOf","allowAttributesOf"],n=this._definitions.filter(o=>o.model==e);for(const{modelSchema:o}of n)if(o)for(const r of i)for(const l of ae(o[r]||[])){const a=this._definitions.filter(c=>c.model==l);for(const c of a)l!==e&&(yield*this._getReferences(c.model),yield c)}}_extendDefinition(e){const i=Array.from(this._definitions.entries()).filter(([,n])=>n.model==e.model);if(i.length==0){this._definitions.push(e);return}for(const[n,o]of i)this._definitions[n]=fa({},o,e,(r,l)=>Array.isArray(r)?r.concat(l):void 0)}}function zc(s,t){return typeof s=="string"?s===t:s instanceof RegExp?s.test(t):!1}class x extends w{constructor(e){super(e);h(this,"_dataSchema");h(this,"_allowedAttributes");h(this,"_disallowedAttributes");h(this,"_allowedElements");h(this,"_disallowedElements");h(this,"_dataInitialized");h(this,"_coupledAttributes");this._dataSchema=e.plugins.get("DataSchema"),this._allowedAttributes=new Q,this._disallowedAttributes=new Q,this._allowedElements=new Set,this._disallowedElements=new Set,this._dataInitialized=!1,this._coupledAttributes=null,this._registerElementsAfterInit(),this._registerElementHandlers(),this._registerCoupledAttributesPostFixer(),this._registerAssociatedHtmlAttributesPostFixer()}static get pluginName(){return"DataFilter"}static get isOfficialPlugin(){return!0}static get requires(){return[Pe,$e]}loadAllowedConfig(e){for(const i of e){const n=i.name||/[\s\S]+/,o=dn(i);this.allowElement(n),o.forEach(r=>this.allowAttributes(r))}}loadDisallowedConfig(e){for(const i of e){const n=i.name||/[\s\S]+/,o=dn(i);o.length==0?this.disallowElement(n):o.forEach(r=>this.disallowAttributes(r))}}loadAllowedEmptyElementsConfig(e){for(const i of e)this.allowEmptyElement(i)}allowElement(e){for(const i of this._dataSchema.getDefinitionsForView(e,!0))this._addAllowedElement(i),this._coupledAttributes=null}disallowElement(e){for(const i of this._dataSchema.getDefinitionsForView(e,!1))this._disallowedElements.add(i.view)}allowEmptyElement(e){for(const i of this._dataSchema.getDefinitionsForView(e,!0))i.isInline&&this._dataSchema.extendInlineElement({...i,allowEmpty:!0})}allowAttributes(e){this._allowedAttributes.add(e)}disallowAttributes(e){this._disallowedAttributes.add(e)}processViewAttributes(e,i){const{consumable:n}=i;return un(e,this._disallowedAttributes,n),Wc(e,un(e,this._allowedAttributes,n))}_addAllowedElement(e){if(!this._allowedElements.has(e)){if(this._allowedElements.add(e),"appliesToBlock"in e&&typeof e.appliesToBlock=="string")for(const i of this._dataSchema.getDefinitionsForModel(e.appliesToBlock))i.isBlock&&this._addAllowedElement(i);this._dataInitialized&&this.editor.data.once("set",()=>{this._fireRegisterEvent(e)},{priority:xe.highest+1})}}_registerElementsAfterInit(){this.editor.data.on("init",()=>{this._dataInitialized=!0;for(const e of this._allowedElements)this._fireRegisterEvent(e)},{priority:xe.highest+1})}_registerElementHandlers(){this.on("register",(e,i)=>{const n=this.editor.model.schema;if(i.isObject&&!n.isRegistered(i.model))this._registerObjectElement(i);else if(i.isBlock)this._registerBlockElement(i);else if(i.isInline)this._registerInlineElement(i);else throw new R("data-filter-invalid-definition",null,i);e.stop()},{priority:"lowest"})}_registerCoupledAttributesPostFixer(){const e=this.editor.model,i=e.document.selection;e.document.registerPostFixer(n=>{const o=e.document.differ.getChanges();let r=!1;const l=this._getCoupledAttributesMap();for(const a of o){if(a.type!="attribute"||a.attributeNewValue!==null)continue;const c=l.get(a.attributeKey);if(c)for(const{item:u}of a.range.getWalker())for(const d of c)u.hasAttribute(d)&&(n.removeAttribute(d,u),r=!0)}return r}),this.listenTo(i,"change:attribute",(n,{attributeKeys:o})=>{const r=new Set,l=this._getCoupledAttributesMap();for(const a of o){if(i.hasAttribute(a))continue;const c=l.get(a);if(c)for(const u of c)i.hasAttribute(u)&&r.add(u)}r.size!=0&&e.change(a=>{for(const c of r)a.removeSelectionAttribute(c)})})}_registerAssociatedHtmlAttributesPostFixer(){const e=this.editor.model;e.document.registerPostFixer(i=>{const n=e.document.differ.getChanges();let o=!1;for(const r of n)if(!(r.type!=="insert"||r.name==="$text"))for(const l of r.attributes.keys())!l.startsWith("html")||!l.endsWith("Attributes")||e.schema.checkAttribute(r.name,l)||(i.removeAttribute(l,r.position.nodeAfter),o=!0);return o})}_getCoupledAttributesMap(){if(this._coupledAttributes)return this._coupledAttributes;this._coupledAttributes=new Map;for(const e of this._allowedElements)if(e.coupledAttribute&&e.model){const i=this._coupledAttributes.get(e.coupledAttribute);i?i.push(e.model):this._coupledAttributes.set(e.coupledAttribute,[e.model])}return this._coupledAttributes}_fireRegisterEvent(e){e.view&&this._disallowedElements.has(e.view)||this.fire(e.view?`register:${e.view}`:"register",e)}_registerObjectElement(e){const i=this.editor,n=i.model.schema,o=i.conversion,{view:r,model:l}=e;n.register(l,e.modelSchema);/* istanbul ignore next: paranoid check -- @preserve */r&&(n.extend(e.model,{allowAttributes:[M(r),"htmlContent"]}),i.data.registerRawContentMatcher({name:r}),o.for("upcast").elementToElement({view:r,model:xi(e),converterPriority:xe.low+2}),o.for("upcast").add(He(e,this)),o.for("editingDowncast").elementToStructure({model:{name:l,attributes:[M(r)]},view:Nc(i,e)}),o.for("dataDowncast").elementToElement({model:l,view:(a,{writer:c})=>Et(r,a,c)}),o.for("dataDowncast").add(ze(e)))}_registerBlockElement(e){const i=this.editor,n=i.model.schema,o=i.conversion,{view:r,model:l}=e;if(!n.isRegistered(e.model)){if(n.register(e.model,e.modelSchema),!r)return;o.for("upcast").elementToElement({model:l,view:r,converterPriority:xe.low+2}),o.for("downcast").elementToElement({model:l,view:r})}r&&(n.extend(e.model,{allowAttributes:M(r)}),o.for("upcast").add(He(e,this)),o.for("downcast").add(ze(e)))}_registerInlineElement(e){const i=this.editor,n=i.model.schema,o=i.conversion,r=e.model;e.appliesToBlock||(n.extend("$text",{allowAttributes:r}),e.attributeProperties&&n.setAttributeProperties(r,e.attributeProperties),o.for("upcast").add(Mc(e,this)),o.for("downcast").attributeToElement({model:r,view:Hc(e)}),e.allowEmpty&&(n.setAttributeProperties(r,{copyFromObject:!1}),n.isRegistered("htmlEmptyElement")||n.register("htmlEmptyElement",{inheritAllFrom:"$inlineObject"}),i.data.htmlProcessor.domConverter.registerInlineObjectMatcher(l=>l.name==e.view&&l.isEmpty&&Array.from(l.getAttributeKeys()).length?{name:!0}:null),o.for("editingDowncast").elementToElement({model:"htmlEmptyElement",view:an(e,!0)}),o.for("dataDowncast").elementToElement({model:"htmlEmptyElement",view:an(e)})))}}function un(s,t,e){const i=t.matchAll(s)||[],n=s.document.stylesProcessor;return i.reduce((o,{match:r})=>{for(const l of r.styles||[]){const a=n.getRelatedStyles(l).filter(c=>c.split("-").length>l.split("-").length).sort((c,u)=>u.split("-").length-c.split("-").length);for(const c of a)e.consume(s,{styles:[c]})&&o.styles.push(c);e.consume(s,{styles:[l]})&&o.styles.push(l)}for(const l of r.classes||[])e.consume(s,{classes:[l]})&&o.classes.push(l);for(const l of r.attributes||[])e.consume(s,{attributes:[l]})&&o.attributes.push(l);return o},{attributes:[],classes:[],styles:[]})}function Wc(s,{attributes:t,classes:e,styles:i}){return!t.length&&!e.length&&!i.length?null:{...t.length&&{attributes:$c(s,t)},...i.length&&{styles:jc(s,i)},...e.length&&{classes:e}}}function $c(s,t){const e={};for(const i of t){const n=s.getAttribute(i);n!==void 0&&kr(i)&&(e[i]=n)}return e}function jc(s,t){const e=new yr(s.document.stylesProcessor);for(const i of t){const n=s.getStyle(i);n!==void 0&&e.set(i,n)}return Object.fromEntries(e.getStylesEntries())}function Dt(s,t){const{name:e}=s,i=s[t];return Xr(i)?Object.entries(i).map(([n,o])=>({name:e,[t]:{[n]:o}})):Array.isArray(i)?i.map(n=>({name:e,[t]:[n]})):[s]}function dn(s){const{name:t,attributes:e,classes:i,styles:n}=s,o=[];return e&&o.push(...Dt({name:t,attributes:e},"attributes")),i&&o.push(...Dt({name:t,classes:i},"classes")),n&&o.push(...Dt({name:t,styles:n},"styles")),o}class qc extends w{static get requires(){return[x]}static get pluginName(){return"CodeBlockElementSupport"}static get isOfficialPlugin(){return!0}init(){if(!this.editor.plugins.has("CodeBlockEditing"))return;const t=this.editor.plugins.get(x);t.on("register:pre",(e,i)=>{if(i.model!=="codeBlock")return;const n=this.editor,o=n.model.schema,r=n.conversion;o.extend("codeBlock",{allowAttributes:["htmlPreAttributes","htmlContentAttributes"]}),r.for("upcast").add(Gc(t)),r.for("downcast").add(Kc()),e.stop()})}}function Gc(s){return t=>{t.on("element:code",(e,i,n)=>{const o=i.viewItem,r=o.parent;if(!r||!r.is("element","pre"))return;l(r,"htmlPreAttributes"),l(o,"htmlContentAttributes");function l(a,c){const u=s.processViewAttributes(a,n);u&&n.writer.setAttribute(c,u,i.modelRange)}},{priority:"low"})}}function Kc(){return s=>{s.on("attribute:htmlPreAttributes:codeBlock",(t,e,i)=>{if(!i.consumable.consume(e.item,t.name))return;const{attributeOldValue:n,attributeNewValue:o}=e,l=i.mapper.toViewElement(e.item).parent;me(i.writer,n,o,l)}),s.on("attribute:htmlContentAttributes:codeBlock",(t,e,i)=>{if(!i.consumable.consume(e.item,t.name))return;const{attributeOldValue:n,attributeNewValue:o}=e,r=i.mapper.toViewElement(e.item);me(i.writer,n,o,r)})}}class Zc extends w{static get requires(){return[x]}static get pluginName(){return"DualContentModelElementSupport"}static get isOfficialPlugin(){return!0}init(){this.editor.plugins.get(x).on("register",(e,i)=>{const n=i,o=this.editor,r=o.model.schema,l=o.conversion;if(!n.paragraphLikeModel||r.isRegistered(n.model)||r.isRegistered(n.paragraphLikeModel))return;const a={model:n.paragraphLikeModel,view:n.view};r.register(n.model,n.modelSchema),r.register(a.model,{inheritAllFrom:"$block"}),l.for("upcast").elementToElement({view:n.view,model:(c,{writer:u})=>this._hasBlockContent(c)?u.createElement(n.model):u.createElement(a.model),converterPriority:xe.low+.5}),l.for("downcast").elementToElement({view:n.view,model:n.model}),this._addAttributeConversion(n),l.for("downcast").elementToElement({view:a.view,model:a.model}),this._addAttributeConversion(a),e.stop()})}_hasBlockContent(t){const e=this.editor.editing.view,i=e.domConverter.blockElements;for(const n of e.createRangeIn(t).getItems())if(n.is("element")&&i.includes(n.name))return!0;return!1}_addAttributeConversion(t){const e=this.editor,i=e.conversion,n=e.plugins.get(x);e.model.schema.extend(t.model,{allowAttributes:M(t.view)}),i.for("upcast").add(He(t,n)),i.for("downcast").add(ze(t))}}class Jc extends w{static get requires(){return[Pe,ro]}static get pluginName(){return"HeadingElementSupport"}static get isOfficialPlugin(){return!0}init(){const t=this.editor;if(!t.plugins.has("HeadingEditing"))return;const e=t.config.get("heading.options");this.registerHeadingElements(t,e)}registerHeadingElements(t,e){const i=t.plugins.get(Pe),n=[];for(const o of e)"model"in o&&"view"in o&&(i.registerBlockElement({view:o.view,model:o.model}),n.push(o.model));i.extendBlockElement({model:"htmlHgroup",modelSchema:{allowChildren:n}}),i.extendBlockElement({model:"htmlSummary",modelSchema:{allowChildren:n}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function pt(s,t,e){const i=s.createRangeOn(t);for(const{item:n}of i.getWalker())if(n.is("element",e))return n}class Xc extends w{static get requires(){return[x]}static get pluginName(){return"ImageElementSupport"}static get isOfficialPlugin(){return!0}init(){const t=this.editor;if(!t.plugins.has("ImageInlineEditing")&&!t.plugins.has("ImageBlockEditing"))return;const e=t.model.schema,i=t.conversion,n=t.plugins.get(x);n.on("register:figure",()=>{i.for("upcast").add(eu(n))}),n.on("register:img",(o,r)=>{r.model!=="imageBlock"&&r.model!=="imageInline"||(e.isRegistered("imageBlock")&&e.extend("imageBlock",{allowAttributes:["htmlImgAttributes","htmlFigureAttributes","htmlLinkAttributes"]}),e.isRegistered("imageInline")&&e.extend("imageInline",{allowAttributes:["htmlA","htmlImgAttributes"]}),i.for("upcast").add(Yc(n)),i.for("downcast").add(tu()),t.plugins.has("LinkImage")&&i.for("upcast").add(Qc(n,t)),o.stop())})}}function Yc(s){return t=>{t.on("element:img",(e,i,n)=>{if(!i.modelRange)return;const o=i.viewItem,r=s.processViewAttributes(o,n);r&&n.writer.setAttribute("htmlImgAttributes",r,i.modelRange)},{priority:"low"})}}function Qc(s,t){const e=t.plugins.get("ImageUtils");return i=>{i.on("element:a",(n,o,r)=>{const l=o.viewItem;if(!e.findViewImgElement(l))return;const c=o.modelCursor.parent;if(!c.is("element","imageBlock"))return;const u=s.processViewAttributes(l,r);u&&r.writer.setAttribute("htmlLinkAttributes",u,c)},{priority:"low"})}}function eu(s){return t=>{t.on("element:figure",(e,i,n)=>{const o=i.viewItem;if(!i.modelRange||!o.hasClass("image"))return;const r=s.processViewAttributes(o,n);r&&n.writer.setAttribute("htmlFigureAttributes",r,i.modelRange)},{priority:"low"})}}function tu(){return s=>{t("htmlImgAttributes"),e("img","htmlImgAttributes"),e("figure","htmlFigureAttributes"),e("a","htmlLinkAttributes");function t(i){s.on(`attribute:${i}:imageInline`,(n,o,r)=>{if(!r.consumable.consume(o.item,n.name))return;const{attributeOldValue:l,attributeNewValue:a}=o,c=r.mapper.toViewElement(o.item);me(r.writer,l,a,c)},{priority:"low"})}function e(i,n){s.on(`attribute:${n}:imageBlock`,(o,r,l)=>{if(!l.consumable.test(r.item,o.name))return;const{attributeOldValue:a,attributeNewValue:c}=r,u=l.mapper.toViewElement(r.item),d=pt(l.writer,u,i);d&&(me(l.writer,a,c,d),l.consumable.consume(r.item,o.name))},{priority:"low"}),i==="a"&&s.on("attribute:linkHref:imageBlock",(o,r,l)=>{if(!l.consumable.consume(r.item,"attribute:htmlLinkAttributes:imageBlock"))return;const a=l.mapper.toViewElement(r.item),c=pt(l.writer,a,"a");W(l.writer,r.item.getAttribute("htmlLinkAttributes"),c)},{priority:"low"})}}}class iu extends w{static get requires(){return[x]}static get pluginName(){return"MediaEmbedElementSupport"}static get isOfficialPlugin(){return!0}init(){const t=this.editor;if(!t.plugins.has("MediaEmbed")||t.config.get("mediaEmbed.previewsInData"))return;const e=t.model.schema,i=t.conversion,n=this.editor.plugins.get(x),o=this.editor.plugins.get(Pe),r=t.config.get("mediaEmbed.elementName");o.registerBlockElement({model:"media",view:r}),n.on("register:figure",()=>{i.for("upcast").add(ou(n))}),n.on(`register:${r}`,(l,a)=>{a.model==="media"&&(e.extend("media",{allowAttributes:[M(r),"htmlFigureAttributes"]}),i.for("upcast").add(nu(n,r)),i.for("dataDowncast").add(su(r)),l.stop())})}}function nu(s,t){const e=(i,n,o)=>{const r=n.viewItem;l(r,M(t));function l(a,c){const u=s.processViewAttributes(a,o);u&&o.writer.setAttribute(c,u,n.modelRange)}};return i=>{i.on(`element:${t}`,e,{priority:"low"})}}function ou(s){return t=>{t.on("element:figure",(e,i,n)=>{const o=i.viewItem;if(!i.modelRange||!o.hasClass("media"))return;const r=s.processViewAttributes(o,n);r&&n.writer.setAttribute("htmlFigureAttributes",r,i.modelRange)},{priority:"low"})}}function su(s){return t=>{e(s,M(s)),e("figure","htmlFigureAttributes");function e(i,n){t.on(`attribute:${n}:media`,(o,r,l)=>{if(!l.consumable.consume(r.item,o.name))return;const{attributeOldValue:a,attributeNewValue:c}=r,u=l.mapper.toViewElement(r.item),d=pt(l.writer,u,i);me(l.writer,a,c,d)})}}}class ru extends w{static get requires(){return[x]}static get pluginName(){return"ScriptElementSupport"}static get isOfficialPlugin(){return!0}init(){const t=this.editor.plugins.get(x);t.on("register:script",(e,i)=>{const n=this.editor,o=n.model.schema,r=n.conversion;o.register("htmlScript",i.modelSchema),o.extend("htmlScript",{allowAttributes:["htmlScriptAttributes","htmlContent"],isContent:!0}),n.data.registerRawContentMatcher({name:"script"}),r.for("upcast").elementToElement({view:"script",model:xi(i)}),r.for("upcast").add(He(i,t)),r.for("downcast").elementToElement({model:"htmlScript",view:(l,{writer:a})=>Et("script",l,a)}),r.for("downcast").add(ze(i)),e.stop()})}}class lu extends w{static get requires(){return[x]}static get pluginName(){return"TableElementSupport"}static get isOfficialPlugin(){return!0}init(){const t=this.editor;if(!t.plugins.has("TableEditing"))return;const e=t.model.schema,i=t.conversion,n=t.plugins.get(x),o=t.plugins.get("TableUtils");n.on("register:figure",()=>{i.for("upcast").add(uu(n))}),n.on("register:table",(r,l)=>{l.model==="table"&&(e.extend("table",{allowAttributes:["htmlTableAttributes","htmlFigureAttributes","htmlTheadAttributes","htmlTbodyAttributes"]}),i.for("upcast").add(cu(n)),i.for("downcast").add(du()),t.model.document.registerPostFixer(au(t.model,o)),r.stop())})}}function au(s,t){return e=>{const i=s.document.differ.getChanges();let n=!1;for(const o of i){if(o.type!="attribute"||o.attributeKey!="headingRows")continue;const r=o.range.start.nodeAfter,l=r.getAttribute("htmlTheadAttributes"),a=r.getAttribute("htmlTbodyAttributes");l&&!o.attributeNewValue?(e.removeAttribute("htmlTheadAttributes",r),n=!0):a&&o.attributeNewValue==t.getRows(r)&&(e.removeAttribute("htmlTbodyAttributes",r),n=!0)}return n}}function cu(s){return t=>{t.on("element:table",(e,i,n)=>{if(!i.modelRange)return;const o=i.viewItem;r(o,"htmlTableAttributes");for(const l of o.getChildren())l.is("element","thead")&&r(l,"htmlTheadAttributes"),l.is("element","tbody")&&r(l,"htmlTbodyAttributes");function r(l,a){const c=s.processViewAttributes(l,n);c&&n.writer.setAttribute(a,c,i.modelRange)}},{priority:"low"})}}function uu(s){return t=>{t.on("element:figure",(e,i,n)=>{const o=i.viewItem;if(!i.modelRange||!o.hasClass("table"))return;const r=s.processViewAttributes(o,n);r&&n.writer.setAttribute("htmlFigureAttributes",r,i.modelRange)},{priority:"low"})}}function du(){return s=>{t("table","htmlTableAttributes"),t("figure","htmlFigureAttributes"),t("thead","htmlTheadAttributes"),t("tbody","htmlTbodyAttributes");function t(e,i){s.on(`attribute:${i}:table`,(n,o,r)=>{if(!r.consumable.test(o.item,n.name))return;const l=r.mapper.toViewElement(o.item),a=pt(r.writer,l,e);a&&(r.consumable.consume(o.item,n.name),me(r.writer,o.attributeOldValue,o.attributeNewValue,a))})}}}class mu extends w{static get requires(){return[x]}static get pluginName(){return"StyleElementSupport"}static get isOfficialPlugin(){return!0}init(){const t=this.editor.plugins.get(x);t.on("register:style",(e,i)=>{const n=this.editor,o=n.model.schema,r=n.conversion;o.register("htmlStyle",i.modelSchema),o.extend("htmlStyle",{allowAttributes:["htmlStyleAttributes","htmlContent"],isContent:!0}),n.data.registerRawContentMatcher({name:"style"}),r.for("upcast").elementToElement({view:"style",model:xi(i)}),r.for("upcast").add(He(i,t)),r.for("downcast").elementToElement({model:"htmlStyle",view:(l,{writer:a})=>Et("style",l,a)}),r.for("downcast").add(ze(i)),e.stop()})}}class gu extends w{static get requires(){return[x]}static get pluginName(){return"ListElementSupport"}static get isOfficialPlugin(){return!0}init(){const t=this.editor;if(!t.plugins.has("ListEditing"))return;const e=t.model.schema,i=t.conversion,n=t.plugins.get(x),o=t.plugins.get("ListEditing"),r=t.plugins.get("ListUtils"),l=["ul","ol","li"];o.registerDowncastStrategy({scope:"item",attributeName:"htmlLiAttributes",setAttributeOnDowncast:W}),o.registerDowncastStrategy({scope:"list",attributeName:"htmlUlAttributes",setAttributeOnDowncast:W}),o.registerDowncastStrategy({scope:"list",attributeName:"htmlOlAttributes",setAttributeOnDowncast:W}),n.on("register",(a,c)=>{if(!l.includes(c.view)||(a.stop(),e.checkAttribute("$block","htmlLiAttributes")))return;const u=l.map(d=>M(d));e.extend("$listItem",{allowAttributes:u}),i.for("upcast").add(d=>{d.on("element:ul",Nt("htmlUlAttributes",n),{priority:"low"}),d.on("element:ol",Nt("htmlOlAttributes",n),{priority:"low"}),d.on("element:li",Nt("htmlLiAttributes",n),{priority:"low"})})}),o.on("postFixer",(a,{listNodes:c,writer:u})=>{for(const{node:d,previousNodeInList:m}of c)if(m){if(m.getAttribute("listType")==d.getAttribute("listType")){const g=mn(m.getAttribute("listType")),f=m.getAttribute(g);!ct(d.getAttribute(g),f)&&u.model.schema.checkAttribute(d,g)&&(u.setAttribute(g,f,d),a.return=!0)}if(m.getAttribute("listItemId")==d.getAttribute("listItemId")){const g=m.getAttribute("htmlLiAttributes");!ct(d.getAttribute("htmlLiAttributes"),g)&&u.model.schema.checkAttribute(d,"htmlLiAttributes")&&(u.setAttribute("htmlLiAttributes",g,d),a.return=!0)}}}),o.on("postFixer",(a,{listNodes:c,writer:u})=>{for(const{node:d}of c){const m=d.getAttribute("listType");!r.isNumberedListType(m)&&d.getAttribute("htmlOlAttributes")&&(u.removeAttribute("htmlOlAttributes",d),a.return=!0),r.isNumberedListType(m)&&d.getAttribute("htmlUlAttributes")&&(u.removeAttribute("htmlUlAttributes",d),a.return=!0)}})}afterInit(){const t=this.editor;if(!t.commands.get("indentList"))return;const e=t.commands.get("indentList");this.listenTo(e,"afterExecute",(i,n)=>{t.model.change(o=>{for(const r of n){const l=mn(r.getAttribute("listType"));t.model.schema.checkAttribute(r,l)&&o.setAttribute(l,{},r)}})})}}function Nt(s,t){return(e,i,n)=>{const o=i.viewItem;i.modelRange||Object.assign(i,n.convertChildren(i.viewItem,i.modelCursor));const r=t.processViewAttributes(o,n);for(const l of i.modelRange.getItems({shallow:!0}))l.hasAttribute("listItemId")&&(l.hasAttribute("htmlUlAttributes")||l.hasAttribute("htmlOlAttributes")||n.writer.model.schema.checkAttribute(l,s)&&n.writer.setAttribute(s,r||{},l))}}function mn(s){return s==="numbered"||s=="customNumbered"?"htmlOlAttributes":"htmlUlAttributes"}class hu extends w{static get requires(){return[x,Pe]}static get pluginName(){return"CustomElementSupport"}static get isOfficialPlugin(){return!0}init(){const t=this.editor.plugins.get(x),e=this.editor.plugins.get(Pe);t.on("register:$customElement",(i,n)=>{i.stop();const o=this.editor,r=o.model.schema,l=o.conversion,a=o.editing.view.domConverter.unsafeElements,c=o.data.htmlProcessor.domConverter.preElements;r.register(n.model,n.modelSchema),r.extend(n.model,{allowAttributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"],isContent:!0}),o.data.htmlProcessor.domConverter.registerRawContentMatcher({name:"template"}),l.for("upcast").elementToElement({view:/.*/,model:(u,d)=>{if(u.name=="$comment"||!fu(u.name)||e.getDefinitionsForView(u.name).size)return null;a.includes(u.name)||a.push(u.name),c.includes(u.name)||c.push(u.name);const m=d.writer.createElement(n.model,{htmlElementName:u.name}),g=t.processViewAttributes(u,d);g&&d.writer.setAttribute("htmlCustomElementAttributes",g,m);let f;if(u.is("element","template")&&u.getCustomProperty("$rawContent"))f=u.getCustomProperty("$rawContent");else{const b=new $(u.document).createDocumentFragment(u),C=o.data.htmlProcessor.domConverter.viewToDom(b),v=C.firstChild;for(;v.firstChild;)C.appendChild(v.firstChild);v.remove(),f=o.data.htmlProcessor.htmlWriter.getHtml(C)}d.writer.setAttribute("htmlContent",f,m);for(const{item:p}of o.editing.view.createRangeIn(u))d.consumable.consume(p,{name:!0});return m},converterPriority:"low"}),l.for("editingDowncast").elementToElement({model:{name:n.model,attributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"]},view:(u,{writer:d})=>{const m=u.getAttribute("htmlElementName"),g=d.createRawElement(m);return u.hasAttribute("htmlCustomElementAttributes")&&W(d,u.getAttribute("htmlCustomElementAttributes"),g),g}}),l.for("dataDowncast").elementToElement({model:{name:n.model,attributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"]},view:(u,{writer:d})=>{const m=u.getAttribute("htmlElementName"),g=u.getAttribute("htmlContent"),f=d.createRawElement(m,null,(p,b)=>{b.setContentOf(p,g)});return u.hasAttribute("htmlCustomElementAttributes")&&W(d,u.getAttribute("htmlCustomElementAttributes"),f),f}})})}}function fu(s){try{document.createElement(s)}catch{return!1}return!0}class pu extends w{static get pluginName(){return"GeneralHtmlSupport"}static get isOfficialPlugin(){return!0}static get requires(){return[x,qc,Zc,Jc,Xc,iu,ru,lu,mu,gu,hu]}init(){const t=this.editor,e=t.plugins.get(x);e.loadAllowedEmptyElementsConfig(t.config.get("htmlSupport.allowEmpty")||[]),e.loadAllowedConfig(t.config.get("htmlSupport.allow")||[]),e.loadDisallowedConfig(t.config.get("htmlSupport.disallow")||[])}getGhsAttributeNameForElement(t){const e=this.editor.plugins.get("DataSchema"),i=Array.from(e.getDefinitionsForView(t,!1)),n=i.find(o=>o.isInline&&!i[0].isObject);return n?n.model:M(t)}addModelHtmlClass(t,e,i){const n=this.editor.model,o=this.getGhsAttributeNameForElement(t);n.change(r=>{for(const l of Ae(n,i,o))Ie(r,l,o,"classes",a=>{for(const c of ae(e))a.add(c)})})}removeModelHtmlClass(t,e,i){const n=this.editor.model,o=this.getGhsAttributeNameForElement(t);n.change(r=>{for(const l of Ae(n,i,o))Ie(r,l,o,"classes",a=>{for(const c of ae(e))a.delete(c)})})}setModelHtmlAttributes(t,e,i){const n=this.editor.model,o=this.getGhsAttributeNameForElement(t);n.change(r=>{for(const l of Ae(n,i,o))Ie(r,l,o,"attributes",a=>{for(const[c,u]of Object.entries(e))a.set(c,u)})})}removeModelHtmlAttributes(t,e,i){const n=this.editor.model,o=this.getGhsAttributeNameForElement(t);n.change(r=>{for(const l of Ae(n,i,o))Ie(r,l,o,"attributes",a=>{for(const c of ae(e))a.delete(c)})})}setModelHtmlStyles(t,e,i){const n=this.editor.model,o=this.getGhsAttributeNameForElement(t);n.change(r=>{for(const l of Ae(n,i,o))Ie(r,l,o,"styles",a=>{for(const[c,u]of Object.entries(e))a.set(c,u)})})}removeModelHtmlStyles(t,e,i){const n=this.editor.model,o=this.getGhsAttributeNameForElement(t);n.change(r=>{for(const l of Ae(n,i,o))Ie(r,l,o,"styles",a=>{for(const c of ae(e))a.delete(c)})})}}function*Ae(s,t,e){if(t)if(!(Symbol.iterator in t)&&t.is("documentSelection")&&t.isCollapsed)s.schema.checkAttributeInSelection(t,e)&&(yield t);else for(const i of bu(s,t,e))yield*i.getItems({shallow:!0})}function bu(s,t,e){return!(Symbol.iterator in t)&&(t.is("node")||t.is("$text")||t.is("$textProxy"))?s.schema.checkAttribute(t,e)?[s.createRangeOn(t)]:[]:s.schema.getValidRanges(s.createSelection(t).getRanges(),e)}class wu extends w{static get pluginName(){return"HtmlComment"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=new Map;t.data.processor.skipComments=!1,t.model.schema.addAttributeCheck((i,n)=>{if(i.endsWith("$root")&&n.startsWith("$comment"))return!0}),t.conversion.for("upcast").elementToMarker({view:"$comment",model:i=>{const o=`$comment:${jt()}`,r=i.getCustomProperty("$rawContent");return e.set(o,r),o}}),t.conversion.for("dataDowncast").markerToElement({model:"$comment",view:(i,{writer:n})=>{let o;for(const c of this.editor.model.document.getRootNames())if(o=this.editor.model.document.getRoot(c),o.hasAttribute(i.markerName))break;const r=i.markerName,l=o.getAttribute(r),a=n.createUIElement("$comment");return n.setCustomProperty("$rawContent",l,a),a}}),t.model.document.registerPostFixer(i=>{let n=!1;const o=t.model.document.differ.getChangedMarkers().filter(r=>r.name.startsWith("$comment:"));for(const r of o){const{oldRange:l,newRange:a}=r.data;if(!(l&&a&&l.root==a.root)){if(l){const c=l.root;c.hasAttribute(r.name)&&(i.removeAttribute(r.name,c),n=!0)}if(a){const c=a.root;c.rootName=="$graveyard"?(i.removeMarker(r.name),n=!0):c.hasAttribute(r.name)||(i.setAttribute(r.name,e.get(r.name)||"",c),n=!0)}}}return n}),t.data.on("set",()=>{for(const i of t.model.markers.getMarkersGroup("$comment"))this.removeHtmlComment(i.name)},{priority:"high"}),t.model.on("deleteContent",(i,[n])=>{for(const o of n.getRanges()){const r=t.model.schema.getLimitElement(o),l=t.model.createPositionAt(r,0),a=t.model.createPositionAt(r,"end");let c;l.isTouching(o.start)&&a.isTouching(o.end)?c=this.getHtmlCommentsInRange(t.model.createRange(l,a)):c=this.getHtmlCommentsInRange(o,{skipBoundaries:!0});for(const u of c)this.removeHtmlComment(u)}},{priority:"high"})}createHtmlComment(t,e){const i=jt(),o=this.editor.model,r=o.document.getRoot(t.root.rootName),l=`$comment:${i}`;return o.change(a=>{const c=a.createRange(t);return a.addMarker(l,{usingOperation:!0,affectsData:!0,range:c}),a.setAttribute(l,e,r),l})}removeHtmlComment(t){const e=this.editor,i=e.model.markers.get(t);return i?(e.model.change(n=>{n.removeMarker(i)}),!0):!1}getHtmlCommentData(t){const i=this.editor.model.markers.get(t);if(!i)return null;let n="";for(const o of this.editor.model.document.getRoots())if(o.hasAttribute(t)){n=o.getAttribute(t);break}return{content:n,position:i.getStart()}}getHtmlCommentsInRange(t,{skipBoundaries:e=!1}={}){const i=!e;return Array.from(this.editor.model.markers.getMarkersGroup("$comment")).filter(o=>n(o,t)).map(o=>o.name);function n(o,r){const l=o.getRange().start;return(l.isAfter(r.start)||i&&l.isEqual(r.start))&&(l.isBefore(r.end)||i&&l.isEqual(r.end))}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Cu(s){return s.createContainerElement("span",{class:"image-inline"},s.createEmptyElement("img"))}function gn(s){return s.createContainerElement("figure",{class:"image"},[s.createEmptyElement("img"),s.createSlot("children")])}function Go(s,t){const e=s.plugins.get("ImageUtils"),i=s.plugins.has("ImageInlineEditing")&&s.plugins.has("ImageBlockEditing");return o=>e.isInlineImageView(o)?i&&(o.getStyle("display")=="block"||o.findAncestor(e.isBlockImageView)?"imageBlock":"imageInline")!==t?null:n(o):null;function n(o){const r={name:!0};return o.hasAttribute("src")&&(r.attributes=["src"]),r}}function Ri(s,t){const e=U(t.getSelectedBlocks());return!e||s.isObject(e)||e.isEmpty&&e.name!="listItem"?"imageBlock":"imageInline"}function bt(s){return s&&s.endsWith("px")?parseInt(s):null}function wt(s){const t=bt(s.getStyle("width")),e=bt(s.getStyle("height"));return!!(t&&e)}const vu=/^(image|image-inline)$/;class B extends w{constructor(){super(...arguments);h(this,"_domEmitter",new(gi()))}static get pluginName(){return"ImageUtils"}static get isOfficialPlugin(){return!0}isImage(e){return this.isInlineImage(e)||this.isBlockImage(e)}isInlineImageView(e){return!!e&&e.is("element","img")}isBlockImageView(e){return!!e&&e.is("element","figure")&&e.hasClass("image")}insertImage(e={},i=null,n=null,o={}){const r=this.editor,l=r.model,a=l.document.selection,c=Ko(r,i||a,n);e={...Object.fromEntries(a.getAttributes()),...e};for(const u in e)l.schema.checkAttribute(c,u)||delete e[u];return l.change(u=>{const{setImageSizes:d=!0}=o,m=u.createElement(c,e);return l.insertObject(m,i,null,{setSelection:"on",findOptimalPosition:!i&&c!="imageInline"?"auto":void 0}),m.parent?(d&&this.setImageNaturalSizeAttributes(m),m):null})}setImageNaturalSizeAttributes(e){const i=e.getAttribute("src");i&&(e.getAttribute("width")||e.getAttribute("height")||this.editor.model.change(n=>{const o=new ee.window.Image;this._domEmitter.listenTo(o,"load",()=>{!e.getAttribute("width")&&!e.getAttribute("height")&&this.editor.model.enqueueChange(n.batch,r=>{r.setAttribute("width",o.naturalWidth,e),r.setAttribute("height",o.naturalHeight,e)}),this._domEmitter.stopListening(o,"load")}),o.src=i}))}getClosestSelectedImageWidget(e){const i=e.getFirstPosition();if(!i)return null;const n=e.getSelectedElement();if(n&&this.isImageWidget(n))return n;let o=i.parent;for(;o;){if(o.is("element")&&this.isImageWidget(o))return o;o=o.parent}return null}getClosestSelectedImageElement(e){const i=e.getSelectedElement();return this.isImage(i)?i:e.getFirstPosition().findAncestor("imageBlock")}getImageWidgetFromImageView(e){return e.findAncestor({classes:vu})}isImageAllowed(){const i=this.editor.model.document.selection;return _u(this.editor,i)&&ku(i)}toImageWidget(e,i,n){return i.setCustomProperty("image",!0,e),je(e,i,{label:()=>{const l=this.findViewImgElement(e).getAttribute("alt");return l?`${l} ${n}`:n}})}isImageWidget(e){return!!e.getCustomProperty("image")&&bi(e)}isBlockImage(e){return!!e&&e.is("element","imageBlock")}isInlineImage(e){return!!e&&e.is("element","imageInline")}findViewImgElement(e){if(this.isInlineImageView(e))return e;const i=this.editor.editing.view;for(const{item:n}of i.createRangeIn(e))if(this.isInlineImageView(n))return n}destroy(){return this._domEmitter.stopListening(),super.destroy()}}function _u(s,t){if(Ko(s,t,null)=="imageBlock"){const i=yu(t,s.model);if(s.model.schema.checkChild(i,"imageBlock"))return!0}else if(s.model.schema.checkChild(t.focus,"imageInline"))return!0;return!1}function ku(s){return[...s.focus.getAncestors()].every(t=>!t.is("element","imageBlock"))}function yu(s,t){const i=lo(s,t).start.parent;return i.isEmpty&&!i.is("element","$root")?i.parent:i}function Ko(s,t,e){const i=s.model.schema,n=s.config.get("image.insert.type");return s.plugins.has("ImageBlockEditing")?s.plugins.has("ImageInlineEditing")?e||(n==="inline"?"imageInline":n!=="auto"?"imageBlock":t.is("selection")?Ri(i,t):i.checkChild(t,"imageInline")?"imageInline":"imageBlock"):"imageBlock":"imageInline"}const Iu=new RegExp(String(/^(http(s)?:\/\/)?[\w-]+\.[\w.~:/[\]@!$&'()*+,;=%-]+/.source+/\.(jpg|jpeg|png|gif|ico|webp|JPG|JPEG|PNG|GIF|ICO|WEBP)/.source+/(\?[\w.~:/[\]@!$&'()*+,;=%-]*)?/.source+/(#[\w.~:/[\]@!$&'()*+,;=%-]*)?$/.source));class Au extends w{constructor(e){super(e);h(this,"_timeoutId");h(this,"_positionToInsert");this._timeoutId=null,this._positionToInsert=null}static get requires(){return[so,B,Si,di]}static get pluginName(){return"AutoImage"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,i=e.model.document,n=e.plugins.get("ClipboardPipeline");this.listenTo(n,"inputTransformation",()=>{const o=i.selection.getFirstRange(),r=Rt.fromPosition(o.start);r.stickiness="toPrevious";const l=Rt.fromPosition(o.end);l.stickiness="toNext",i.once("change:data",()=>{this._embedImageBetweenPositions(r,l),r.detach(),l.detach()},{priority:"high"})}),e.commands.get("undo").on("execute",()=>{this._timeoutId&&(ee.window.clearTimeout(this._timeoutId),this._positionToInsert.detach(),this._timeoutId=null,this._positionToInsert=null)},{priority:"high"})}_embedImageBetweenPositions(e,i){const n=this.editor,o=new Qn(e,i),r=o.getWalker({ignoreElementEnd:!0}),l=Object.fromEntries(n.model.document.selection.getAttributes()),a=this.editor.plugins.get("ImageUtils");let c="";for(const u of r)u.item.is("$textProxy")&&(c+=u.item.data);if(c=c.trim(),!c.match(Iu)){o.detach();return}this._positionToInsert=Rt.fromPosition(e),this._timeoutId=setTimeout(()=>{if(!n.commands.get("insertImage").isEnabled){o.detach();return}n.model.change(m=>{this._timeoutId=null,m.remove(o),o.detach();let g;this._positionToInsert.root.rootName!=="$graveyard"&&(g=this._positionToInsert.toPosition()),a.insertImage({...l,src:c},g),this._positionToInsert.detach(),this._positionToInsert=null}),n.plugins.get("Delete").requestUndoOnBackspace()},100)}}class Tu extends y{refresh(){const i=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!i,this.isEnabled&&i.hasAttribute("alt")?this.value=i.getAttribute("alt"):this.value=!1}execute(t){const e=this.editor,i=e.plugins.get("ImageUtils"),n=e.model,o=i.getClosestSelectedImageElement(n.document.selection);n.change(r=>{r.setAttribute("alt",t.newValue,o)})}}class Eu extends w{static get requires(){return[B]}static get pluginName(){return"ImageTextAlternativeEditing"}static get isOfficialPlugin(){return!0}init(){this.editor.commands.add("imageTextAlternative",new Tu(this.editor))}}class Su extends L{constructor(e){super(e);h(this,"focusTracker");h(this,"keystrokes");h(this,"labeledInput");h(this,"saveButtonView");h(this,"cancelButtonView");h(this,"_focusables");h(this,"_focusCycler");const i=this.locale.t;this.focusTracker=new G,this.keystrokes=new j,this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(i("Save"),_.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(i("Cancel"),_.cancel,"ck-button-cancel","cancel"),this._focusables=new ie,this._focusCycler=new ne({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-text-alternative-form","ck-responsive-form"],tabindex:"-1"},children:[this.labeledInput,this.saveButtonView,this.cancelButtonView]})}render(){super.render(),this.keystrokes.listenTo(this.element),Le({view:this}),[this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(e,i,n,o){const r=new I(this.locale);return r.set({label:e,icon:i,tooltip:!0}),r.extendTemplate({attributes:{class:n}}),o&&r.delegate("execute").to(this,o),r}_createLabeledInputView(){const e=this.locale.t,i=new P(this.locale,z);return i.label=e("Text alternative"),i}}function xu(s){const t=s.plugins.get("ContextualBalloon");if(s.plugins.get("ImageUtils").getClosestSelectedImageWidget(s.editing.view.document.selection)){const i=Vi(s);t.updatePosition(i)}}function Vi(s){const t=s.editing.view,e=J.defaultPositions,i=s.plugins.get("ImageUtils");return{target:t.domConverter.mapViewToDom(i.getClosestSelectedImageWidget(t.document.selection)),positions:[e.northArrowSouth,e.northArrowSouthWest,e.northArrowSouthEast,e.southArrowNorth,e.southArrowNorthWest,e.southArrowNorthEast,e.viewportStickyNorth]}}class Ru extends w{constructor(){super(...arguments);h(this,"_balloon");h(this,"_form")}static get requires(){return[te]}static get pluginName(){return"ImageTextAlternativeUI"}static get isOfficialPlugin(){return!0}init(){this._createButton()}destroy(){super.destroy(),this._form&&this._form.destroy()}_createButton(){const e=this.editor,i=e.t;e.ui.componentFactory.add("imageTextAlternative",n=>{const o=e.commands.get("imageTextAlternative"),r=new I(n);return r.set({label:i("Change image text alternative"),icon:_.textAlternative,tooltip:!0}),r.bind("isEnabled").to(o,"isEnabled"),r.bind("isOn").to(o,"value",l=>!!l),this.listenTo(r,"execute",()=>{this._showForm()}),r})}_createForm(){const e=this.editor,n=e.editing.view.document,o=e.plugins.get("ImageUtils");this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new(wi(Su))(e.locale),this._form.render(),this.listenTo(this._form,"submit",()=>{e.execute("imageTextAlternative",{newValue:this._form.labeledInput.fieldView.element.value}),this._hideForm(!0)}),this.listenTo(this._form,"cancel",()=>{this._hideForm(!0)}),this._form.keystrokes.set("Esc",(r,l)=>{this._hideForm(!0),l()}),this.listenTo(e.ui,"update",()=>{o.getClosestSelectedImageWidget(n.selection)?this._isVisible&&xu(e):this._hideForm(!0)}),qe({emitter:this._form,activator:()=>this._isVisible,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(){if(this._isVisible)return;this._form||this._createForm();const e=this.editor,i=e.commands.get("imageTextAlternative"),n=this._form.labeledInput;this._form.disableCssTransitions(),this._isInBalloon||this._balloon.add({view:this._form,position:Vi(e)}),n.fieldView.value=n.fieldView.element.value=i.value||"",this._form.labeledInput.fieldView.select(),this._form.enableCssTransitions()}_hideForm(e=!1){this._isInBalloon&&(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),e&&this.editor.editing.view.focus())}get _isVisible(){return!!this._balloon&&this._balloon.visibleView===this._form}get _isInBalloon(){return!!this._balloon&&this._balloon.hasView(this._form)}}class Pi extends w{static get requires(){return[Eu,Ru]}static get pluginName(){return"ImageTextAlternative"}static get isOfficialPlugin(){return!0}}function Vu(s){const t=(e,i,n)=>{if(!n.consumable.test(i.viewItem,{name:!0,classes:"image"}))return;const o=s.findViewImgElement(i.viewItem);if(!o||!n.consumable.test(o,{name:!0}))return;n.consumable.consume(i.viewItem,{name:!0,classes:"image"});const r=n.convertItem(o,i.modelCursor),l=U(r.modelRange.getItems());if(!l){n.consumable.revert(i.viewItem,{name:!0,classes:"image"});return}n.convertChildren(i.viewItem,l),n.updateConversionResult(l,i)};return e=>{e.on("element:figure",t)}}function Pu(s){const t=["srcset","media","type","sizes"],e=(i,n,o)=>{const r=n.viewItem;if(!o.consumable.test(r,{name:!0}))return;const l=new Map;for(const u of r.getChildren())if(u.is("element","source")){const d={};for(const m of t)u.hasAttribute(m)&&o.consumable.test(u,{attributes:m})&&(d[m]=u.getAttribute(m));Object.keys(d).length&&l.set(u,d)}const a=s.findViewImgElement(r);if(!a)return;let c=n.modelCursor.parent;if(!c.is("element","imageBlock")){const u=o.convertItem(a,n.modelCursor);n.modelRange=u.modelRange,n.modelCursor=u.modelCursor,c=U(u.modelRange.getItems())}o.consumable.consume(r,{name:!0});for(const[u,d]of l)o.consumable.consume(u,{attributes:Object.keys(d)});l.size&&o.writer.setAttribute("sources",Array.from(l.values()),c),o.convertChildren(r,c)};return i=>{i.on("element:picture",e)}}function Zo(s,t){const e=(i,n,o)=>{if(!o.consumable.consume(n.item,i.name))return;const r=o.writer,l=o.mapper.toViewElement(n.item),a=s.findViewImgElement(l);n.attributeNewValue===null?(r.removeAttribute("srcset",a),r.removeAttribute("sizes",a)):n.attributeNewValue&&(r.setAttribute("srcset",n.attributeNewValue,a),r.setAttribute("sizes","100vw",a))};return i=>{i.on(`attribute:srcset:${t}`,e)}}function Bu(s){const t=(e,i,n)=>{if(!n.consumable.consume(i.item,e.name))return;const o=n.writer,r=n.mapper.toViewElement(i.item),l=s.findViewImgElement(r),a=i.attributeNewValue;if(a&&a.length){const c=[];let u=l.parent;for(;u&&u.is("attributeElement");){const g=u.parent;o.unwrap(o.createRangeOn(l),u),c.unshift(u),u=g}const d=l.parent.is("element","picture"),m=d?l.parent:o.createContainerElement("picture",null);d||o.insert(o.createPositionBefore(l),m),o.remove(o.createRangeIn(m)),o.insert(o.createPositionAt(m,"end"),a.map(g=>o.createEmptyElement("source",g))),o.move(o.createRangeOn(l),o.createPositionAt(m,"end"));for(const g of c)o.wrap(o.createRangeOn(m),g)}else if(l.parent.is("element","picture")){const c=l.parent;o.move(o.createRangeOn(l),o.createPositionBefore(c)),o.remove(c)}};return e=>{e.on("attribute:sources:imageBlock",t),e.on("attribute:sources:imageInline",t)}}function Ct(s,t,e){const i=(n,o,r)=>{if(!r.consumable.consume(o.item,n.name))return;const l=r.writer,a=r.mapper.toViewElement(o.item),c=s.findViewImgElement(a);l.setAttribute(o.attributeKey,o.attributeNewValue||"",c)};return n=>{n.on(`attribute:${e}:${t}`,i)}}class Bi extends Er{observe(t){this.listenTo(t,"load",(e,i)=>{const n=i.target;this.checkShouldIgnoreEventFromTarget(n)||n.tagName=="IMG"&&this._fireEvents(i)},{useCapture:!0})}stopObserving(t){this.stopListening(t)}_fireEvents(t){this.isEnabled&&(this.document.fire("layoutChanged"),this.document.fire("imageLoaded",t))}}class Lu extends y{constructor(t){super(t);const e=t.config.get("image.insert.type");t.plugins.has("ImageBlockEditing")||e==="block"&&N("image-block-plugin-required"),t.plugins.has("ImageInlineEditing")||e==="inline"&&N("image-inline-plugin-required")}refresh(){const t=this.editor.plugins.get("ImageUtils");this.isEnabled=t.isImageAllowed()}execute(t){const e=ae(t.source),i=this.editor.model.document.selection,n=this.editor.plugins.get("ImageUtils"),o=Object.fromEntries(i.getAttributes());e.forEach((r,l)=>{const a=i.getSelectedElement();if(typeof r=="string"&&(r={src:r}),l&&a&&n.isImage(a)){const c=this.editor.model.createPositionAfter(a);n.insertImage({...r,...o},c,t.imageType)}else n.insertImage({...r,...o},null,t.imageType)})}}class Ou extends y{constructor(t){super(t),this.decorate("cleanupImage")}refresh(){const e=this.editor.plugins.get("ImageUtils"),i=this.editor.model.document.selection.getSelectedElement();this.isEnabled=e.isImage(i),this.value=this.isEnabled?i.getAttribute("src"):null}execute(t){const e=this.editor.model.document.selection.getSelectedElement(),i=this.editor.plugins.get("ImageUtils");this.editor.model.change(n=>{n.setAttribute("src",t.source,e),this.cleanupImage(n,e),i.setImageNaturalSizeAttributes(e)})}cleanupImage(t,e){t.removeAttribute("srcset",e),t.removeAttribute("sizes",e),t.removeAttribute("sources",e),t.removeAttribute("width",e),t.removeAttribute("height",e),t.removeAttribute("alt",e)}}class Li extends w{static get requires(){return[B]}static get pluginName(){return"ImageEditing"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.conversion;t.editing.view.addObserver(Bi),e.for("upcast").attributeToAttribute({view:{name:"img",key:"alt"},model:"alt"}).attributeToAttribute({view:{name:"img",key:"srcset"},model:"srcset"});const i=new Lu(t),n=new Ou(t);t.commands.add("insertImage",i),t.commands.add("replaceImageSource",n),t.commands.add("imageInsert",i)}}class Jo extends w{static get requires(){return[B]}static get pluginName(){return"ImageSizeAttributes"}static get isOfficialPlugin(){return!0}afterInit(){this._registerSchema(),this._registerConverters("imageBlock"),this._registerConverters("imageInline")}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:["width","height"]}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:["width","height"]})}_registerConverters(t){const e=this.editor,i=e.plugins.get("ImageUtils"),n=t==="imageBlock"?"figure":"img";e.conversion.for("upcast").attributeToAttribute({view:{name:n,styles:{width:/.+/}},model:{key:"width",value:r=>wt(r)?bt(r.getStyle("width")):null}}).attributeToAttribute({view:{name:n,key:"width"},model:"width"}).attributeToAttribute({view:{name:n,styles:{height:/.+/}},model:{key:"height",value:r=>wt(r)?bt(r.getStyle("height")):null}}).attributeToAttribute({view:{name:n,key:"height"},model:"height"}),e.conversion.for("editingDowncast").add(r=>{o(r,"width","width",!0),o(r,"height","height",!0)}),e.conversion.for("dataDowncast").add(r=>{o(r,"width","width",!1),o(r,"height","height",!1)});function o(r,l,a,c){r.on(`attribute:${l}:${t}`,(u,d,m)=>{if(!m.consumable.consume(d.item,u.name))return;const g=m.writer,f=m.mapper.toViewElement(d.item),p=i.findViewImgElement(f);if(d.attributeNewValue!==null?g.setAttribute(a,d.attributeNewValue,p):g.removeAttribute(a,p),d.item.hasAttribute("sources"))return;const b=d.item.hasAttribute("resizedWidth");if(t==="imageInline"&&!b&&!c)return;const C=d.item.getAttribute("width"),v=d.item.getAttribute("height");C&&v&&g.setStyle("aspect-ratio",`${C}/${v}`,p)})}}}class Xo extends y{constructor(e,i){super(e);h(this,"_modelElementName");this._modelElementName=i}refresh(){const i=this.editor.plugins.get("ImageUtils"),n=i.getClosestSelectedImageElement(this.editor.model.document.selection);this._modelElementName==="imageBlock"?this.isEnabled=i.isInlineImage(n):this.isEnabled=i.isBlockImage(n)}execute(e={}){const i=this.editor,n=this.editor.model,o=i.plugins.get("ImageUtils"),r=o.getClosestSelectedImageElement(n.document.selection),l=Object.fromEntries(r.getAttributes());return!l.src&&!l.uploadId?null:n.change(a=>{const{setImageSizes:c=!0}=e,u=Array.from(n.markers).filter(g=>g.getRange().containsItem(r)),d=o.insertImage(l,n.createSelection(r,"on"),this._modelElementName,{setImageSizes:c});if(!d)return null;const m=a.createRangeOn(d);for(const g of u){const f=g.getRange(),p=f.root.rootName!="$graveyard"?f.getJoined(m,!0):m;a.updateMarker(g,{range:p})}return{oldElement:r,newElement:d}})}}class Yo extends w{static get requires(){return[B]}static get pluginName(){return"ImagePlaceholder"}static get isOfficialPlugin(){return!0}afterInit(){this._setupSchema(),this._setupConversion(),this._setupLoadListener()}_setupSchema(){const t=this.editor.model.schema;t.isRegistered("imageBlock")&&t.extend("imageBlock",{allowAttributes:["placeholder"]}),t.isRegistered("imageInline")&&t.extend("imageInline",{allowAttributes:["placeholder"]})}_setupConversion(){const t=this.editor,e=t.conversion,i=t.plugins.get("ImageUtils");e.for("editingDowncast").add(n=>{n.on("attribute:placeholder",(o,r,l)=>{if(!l.consumable.test(r.item,o.name)||!r.item.is("element","imageBlock")&&!r.item.is("element","imageInline"))return;l.consumable.consume(r.item,o.name);const a=l.writer,c=l.mapper.toViewElement(r.item),u=i.findViewImgElement(c);r.attributeNewValue?(a.addClass("image_placeholder",u),a.setStyle("background-image",`url(${r.attributeNewValue})`,u),a.setCustomProperty("editingPipeline:doNotReuseOnce",!0,u)):(a.removeClass("image_placeholder",u),a.removeStyle("background-image",u))})})}_setupLoadListener(){const t=this.editor,e=t.model,i=t.editing,n=i.view,o=t.plugins.get("ImageUtils");n.addObserver(Bi),this.listenTo(n.document,"imageLoaded",(r,l)=>{const a=n.domConverter.mapDomToView(l.target);if(!a)return;const c=o.getImageWidgetFromImageView(a);if(!c)return;const u=i.mapper.toModelElement(c);!u||!u.hasAttribute("placeholder")||e.enqueueChange({isUndoable:!1},d=>{d.removeAttribute("placeholder",u)})})}}class Qo extends w{static get requires(){return[Li,Jo,B,Yo,he]}static get pluginName(){return"ImageBlockEditing"}static get isOfficialPlugin(){return!0}init(){const t=this.editor;t.model.schema.register("imageBlock",{inheritAllFrom:"$blockObject",allowAttributes:["alt","src","srcset"]}),this._setupConversion(),t.plugins.has("ImageInlineEditing")&&(t.commands.add("imageTypeBlock",new Xo(this.editor,"imageBlock")),this._setupClipboardIntegration())}_setupConversion(){const t=this.editor,e=t.t,i=t.conversion,n=t.plugins.get("ImageUtils");i.for("dataDowncast").elementToStructure({model:"imageBlock",view:(o,{writer:r})=>gn(r)}),i.for("editingDowncast").elementToStructure({model:"imageBlock",view:(o,{writer:r})=>n.toImageWidget(gn(r),r,e("image widget"))}),i.for("downcast").add(Ct(n,"imageBlock","src")).add(Ct(n,"imageBlock","alt")).add(Zo(n,"imageBlock")),i.for("upcast").elementToElement({view:Go(t,"imageBlock"),model:(o,{writer:r})=>r.createElement("imageBlock",o.hasAttribute("src")?{src:o.getAttribute("src")}:void 0)}).add(Vu(n))}_setupClipboardIntegration(){const t=this.editor,e=t.model,i=t.editing.view,n=t.plugins.get("ImageUtils"),o=t.plugins.get("ClipboardPipeline");this.listenTo(o,"inputTransformation",(r,l)=>{const a=Array.from(l.content.getChildren());let c;if(!a.every(n.isInlineImageView))return;l.targetRanges?c=t.editing.mapper.toModelRange(l.targetRanges[0]):c=e.document.selection.getFirstRange();const u=e.createSelection(c);if(Ri(e.schema,u)==="imageBlock"){const d=new $(i.document),m=a.map(g=>d.createElement("figure",{class:"image"},g));l.content=d.createDocumentFragment(m)}}),this.listenTo(o,"contentInsertion",(r,l)=>{l.method==="paste"&&e.change(a=>{const c=a.createRangeIn(l.content);for(const u of c.getItems())u.is("element","imageBlock")&&n.setImageNaturalSizeAttributes(u)})})}}class Fu extends L{constructor(e,i=[]){super(e);h(this,"focusTracker");h(this,"keystrokes");h(this,"_focusables");h(this,"_focusCycler");h(this,"children");this.focusTracker=new G,this.keystrokes=new j,this._focusables=new ie,this.children=this.createCollection(),this._focusCycler=new ne({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});for(const n of i)this.children.add(n),this._focusables.add(n),n instanceof Sr&&this._focusables.addMany(n.children);this.setTemplate({tag:"form",attributes:{class:["ck","ck-image-insert-form"],tabindex:-1},children:this.children})}render(){super.render(),Le({view:this});for(const i of this._focusables)this.focusTracker.add(i.element);this.keystrokes.listenTo(this.element);const e=i=>i.stopPropagation();this.keystrokes.set("arrowright",e),this.keystrokes.set("arrowleft",e),this.keystrokes.set("arrowup",e),this.keystrokes.set("arrowdown",e)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}}class Ge extends w{constructor(e){super(e);h(this,"dropdownView");h(this,"_integrations",new Map);e.config.define("image.insert.integrations",["upload","assetManager","url"])}static get pluginName(){return"ImageInsertUI"}static get isOfficialPlugin(){return!0}static get requires(){return[B]}init(){const e=this.editor,i=e.model.document.selection,n=e.plugins.get("ImageUtils");this.set("isImageSelected",!1),this.listenTo(e.model.document,"change",()=>{this.isImageSelected=n.isImage(i.getSelectedElement())});const o=l=>this._createToolbarComponent(l),r=l=>this._createMenuBarComponent(l);e.ui.componentFactory.add("insertImage",o),e.ui.componentFactory.add("imageInsert",o),e.ui.componentFactory.add("menuBar:insertImage",r)}registerIntegration({name:e,observable:i,buttonViewCreator:n,formViewCreator:o,menuBarButtonViewCreator:r,requiresForm:l=!1}){this._integrations.has(e)&&N("image-insert-integration-exists",{name:e}),this._integrations.set(e,{observable:i,buttonViewCreator:n,menuBarButtonViewCreator:r,formViewCreator:o,requiresForm:l})}_createToolbarComponent(e){const i=this.editor,n=e.t,o=this._prepareIntegrations();if(!o.length)return null;let r;const l=o[0];if(o.length==1){if(!l.requiresForm)return l.buttonViewCreator(!0);r=l.buttonViewCreator(!0)}else{const u=l.buttonViewCreator(!1);r=new Tt(e,u),r.tooltip=!0,r.bind("label").to(this,"isImageSelected",d=>n(d?"Replace image":"Insert image"))}const a=this.dropdownView=q(e,r),c=o.map(({observable:u})=>typeof u=="function"?u():u);return a.bind("isEnabled").toMany(c,"isEnabled",(...u)=>u.some(d=>d)),a.once("change:isOpen",()=>{const u=o.map(({formViewCreator:m})=>m(o.length==1)),d=new Fu(i.locale,u);a.panelView.children.add(d)}),a}_createMenuBarComponent(e){const i=e.t,n=this._prepareIntegrations();if(!n.length)return null;let o;const r=n[0];if(n.length==1)o=r.menuBarButtonViewCreator(!0);else{o=new At(e);const l=new hi(e);o.panelView.children.add(l),o.buttonView.set({icon:_.image,label:i("Image")});for(const a of n){const c=new fi(e,o),u=a.menuBarButtonViewCreator(!1);c.children.add(u),l.items.add(c)}}return o}_prepareIntegrations(){const i=this.editor.config.get("image.insert.integrations"),n=[];if(!i.length)return N("image-insert-integrations-not-specified"),n;for(const o of i){if(!this._integrations.has(o)){["upload","assetManager","url"].includes(o)||N("image-insert-unknown-integration",{item:o});continue}n.push(this._integrations.get(o))}return n.length||N("image-insert-integrations-not-registered"),n}}class Uu extends w{static get requires(){return[Qo,$e,Pi,Ge]}static get pluginName(){return"ImageBlock"}static get isOfficialPlugin(){return!0}}class Du extends w{static get requires(){return[Li,Jo,B,Yo,he]}static get pluginName(){return"ImageInlineEditing"}static get isOfficialPlugin(){return!0}init(){const t=this.editor;t.model.schema.register("imageInline",{inheritAllFrom:"$inlineObject",allowAttributes:["alt","src","srcset"],disallowIn:["caption"]}),this._setupConversion(),t.plugins.has("ImageBlockEditing")&&(t.commands.add("imageTypeInline",new Xo(this.editor,"imageInline")),this._setupClipboardIntegration())}_setupConversion(){const t=this.editor,e=t.t,i=t.conversion,n=t.plugins.get("ImageUtils");i.for("dataDowncast").elementToElement({model:"imageInline",view:(o,{writer:r})=>r.createEmptyElement("img")}),i.for("editingDowncast").elementToStructure({model:"imageInline",view:(o,{writer:r})=>n.toImageWidget(Cu(r),r,e("image widget"))}),i.for("downcast").add(Ct(n,"imageInline","src")).add(Ct(n,"imageInline","alt")).add(Zo(n,"imageInline")),i.for("upcast").elementToElement({view:Go(t,"imageInline"),model:(o,{writer:r})=>r.createElement("imageInline",o.hasAttribute("src")?{src:o.getAttribute("src")}:void 0)})}_setupClipboardIntegration(){const t=this.editor,e=t.model,i=t.editing.view,n=t.plugins.get("ImageUtils"),o=t.plugins.get("ClipboardPipeline");this.listenTo(o,"inputTransformation",(r,l)=>{const a=Array.from(l.content.getChildren());let c;if(!a.every(n.isBlockImageView))return;l.targetRanges?c=t.editing.mapper.toModelRange(l.targetRanges[0]):c=e.document.selection.getFirstRange();const u=e.createSelection(c);if(Ri(e.schema,u)==="imageInline"){const d=new $(i.document),m=a.map(g=>g.childCount===1?(Array.from(g.getAttributes()).forEach(f=>d.setAttribute(...f,n.findViewImgElement(g))),g.getChild(0)):g);l.content=d.createDocumentFragment(m)}}),this.listenTo(o,"contentInsertion",(r,l)=>{l.method==="paste"&&e.change(a=>{const c=a.createRangeIn(l.content);for(const u of c.getItems())u.is("element","imageInline")&&n.setImageNaturalSizeAttributes(u)})})}}class Nu extends w{static get requires(){return[Du,$e,Pi,Ge]}static get pluginName(){return"ImageInline"}static get isOfficialPlugin(){return!0}}class es extends w{static get pluginName(){return"ImageCaptionUtils"}static get isOfficialPlugin(){return!0}static get requires(){return[B]}getCaptionFromImageModelElement(t){for(const e of t.getChildren())if(e&&e.is("element","caption"))return e;return null}getCaptionFromModelSelection(t){const e=this.editor.plugins.get("ImageUtils"),i=t.getFirstPosition().findAncestor("caption");return i&&e.isBlockImage(i.parent)?i:null}matchImageCaptionViewElement(t){const e=this.editor.plugins.get("ImageUtils");return t.name=="figcaption"&&e.isBlockImageView(t.parent)?{name:!0}:null}}class Mu extends y{refresh(){const t=this.editor,e=t.plugins.get("ImageCaptionUtils"),i=t.plugins.get("ImageUtils");if(!t.plugins.has(Qo)){this.isEnabled=!1,this.value=!1;return}const n=t.model.document.selection,o=n.getSelectedElement();if(!o){const r=e.getCaptionFromModelSelection(n);this.isEnabled=!!r,this.value=!!r;return}this.isEnabled=i.isImage(o),this.isEnabled?this.value=!!e.getCaptionFromImageModelElement(o):this.value=!1}execute(t={}){const{focusCaptionOnShow:e}=t;this.editor.model.change(i=>{this.value?this._hideImageCaption(i):this._showImageCaption(i,e)})}_showImageCaption(t,e){const n=this.editor.model.document.selection,o=this.editor.plugins.get("ImageCaptionEditing"),r=this.editor.plugins.get("ImageUtils");let l=n.getSelectedElement();const a=o._getSavedCaption(l);r.isInlineImage(l)&&(this.editor.execute("imageTypeBlock"),l=n.getSelectedElement());const c=a||t.createElement("caption");t.append(c,l),e&&t.setSelection(c,"in")}_hideImageCaption(t){const e=this.editor,i=e.model.document.selection,n=e.plugins.get("ImageCaptionEditing"),o=e.plugins.get("ImageCaptionUtils");let r=i.getSelectedElement(),l;r?l=o.getCaptionFromImageModelElement(r):(l=o.getCaptionFromModelSelection(i),r=l.parent),n._saveCaption(r,l),t.setSelection(r,"on"),t.remove(l)}}class Hu extends w{constructor(e){super(e);h(this,"_savedCaptionsMap");this._savedCaptionsMap=new WeakMap}static get requires(){return[B,es]}static get pluginName(){return"ImageCaptionEditing"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,i=e.model.schema;i.isRegistered("caption")?i.extend("caption",{allowIn:"imageBlock"}):i.register("caption",{allowIn:"imageBlock",allowContentOf:"$block",isLimit:!0}),e.commands.add("toggleImageCaption",new Mu(this.editor)),this._setupConversion(),this._setupImageTypeCommandsIntegration(),this._registerCaptionReconversion()}_setupConversion(){const e=this.editor,i=e.editing.view,n=e.plugins.get("ImageUtils"),o=e.plugins.get("ImageCaptionUtils"),r=e.t;e.conversion.for("upcast").elementToElement({view:l=>o.matchImageCaptionViewElement(l),model:"caption"}),e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(l,{writer:a})=>n.isBlockImage(l.parent)?a.createContainerElement("figcaption"):null}),e.conversion.for("editingDowncast").elementToElement({model:"caption",view:(l,{writer:a})=>{if(!n.isBlockImage(l.parent))return null;const c=a.createEditableElement("figcaption");a.setCustomProperty("imageCaption",!0,c),c.placeholder=r("Enter image caption"),pi({view:i,element:c,keepOnFocus:!0});const u=l.parent.getAttribute("alt"),d=u?r("Caption for image: %0",[u]):r("Caption for the image");return Ci(c,a,{label:d})}})}_setupImageTypeCommandsIntegration(){const e=this.editor,i=e.plugins.get("ImageUtils"),n=e.plugins.get("ImageCaptionUtils"),o=e.commands.get("imageTypeInline"),r=e.commands.get("imageTypeBlock"),l=a=>{if(!a.return)return;const{oldElement:c,newElement:u}=a.return;/* istanbul ignore if: paranoid check -- @preserve */if(!c)return;if(i.isBlockImage(c)){const m=n.getCaptionFromImageModelElement(c);if(m){this._saveCaption(u,m);return}}const d=this._getSavedCaption(c);d&&this._saveCaption(u,d)};o&&this.listenTo(o,"execute",l,{priority:"low"}),r&&this.listenTo(r,"execute",l,{priority:"low"})}_getSavedCaption(e){const i=this._savedCaptionsMap.get(e);return i?ao.fromJSON(i):null}_saveCaption(e,i){this._savedCaptionsMap.set(e,i.toJSON())}_registerCaptionReconversion(){const e=this.editor,i=e.model,n=e.plugins.get("ImageUtils"),o=e.plugins.get("ImageCaptionUtils");i.document.on("change:data",()=>{const r=i.document.differ.getChanges();for(const l of r){if(l.attributeKey!=="alt")continue;const a=l.range.start.nodeAfter;if(n.isBlockImage(a)){const c=o.getCaptionFromImageModelElement(a);if(!c)return;e.editing.reconvertItem(c)}}})}}class zu extends w{static get requires(){return[es]}static get pluginName(){return"ImageCaptionUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.editing.view,i=t.plugins.get("ImageCaptionUtils"),n=t.t;t.ui.componentFactory.add("toggleImageCaption",o=>{const r=t.commands.get("toggleImageCaption"),l=new I(o);return l.set({icon:_.caption,tooltip:!0,isToggleable:!0}),l.bind("isOn","isEnabled").to(r,"value","isEnabled"),l.bind("label").to(r,"value",a=>n(a?"Toggle caption off":"Toggle caption on")),this.listenTo(l,"execute",()=>{t.execute("toggleImageCaption",{focusCaptionOnShow:!0});const a=i.getCaptionFromModelSelection(t.model.document.selection);if(a){const c=t.editing.mapper.toViewElement(a);e.scrollToTheSelection(),e.change(u=>{u.addClass("image__caption_highlighted",c)})}t.editing.view.focus()}),l})}}class Wu extends w{static get requires(){return[Hu,zu]}static get pluginName(){return"ImageCaption"}static get isOfficialPlugin(){return!0}}function ts(s){const t=s.map(e=>e.replace("+","\\+"));return new RegExp(`^image\\/(${t.join("|")})$`)}function $u(s){return new Promise((t,e)=>{const i=s.getAttribute("src");fetch(i).then(n=>n.blob()).then(n=>{const o=is(n,i),l=`image.${o.replace("image/","")}`,a=new File([n],l,{type:o});t(a)}).catch(n=>n&&n.name==="TypeError"?qu(i).then(t).catch(e):e(n))})}function ju(s,t){return!s.isInlineImageView(t)||!t.getAttribute("src")?!1:!!t.getAttribute("src").match(/^data:image\/\w+;base64,/g)||!!t.getAttribute("src").match(/^blob:/g)}function is(s,t){return s.type?s.type:t.match(/data:(image\/\w+);base64/)?t.match(/data:(image\/\w+);base64/)[1].toLowerCase():"image/jpeg"}function qu(s){return Gu(s).then(t=>{const e=is(t,s),n=`image.${e.replace("image/","")}`;return new File([t],n,{type:e})})}function Gu(s){return new Promise((t,e)=>{const i=ee.document.createElement("img");i.addEventListener("load",()=>{const n=ee.document.createElement("canvas");n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(i,0,0),n.toBlob(r=>r?t(r):e())}),i.addEventListener("error",()=>e()),i.src=s})}class Ku extends w{static get pluginName(){return"ImageUploadUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor;t.ui.componentFactory.add("uploadImage",()=>this._createToolbarButton()),t.ui.componentFactory.add("imageUpload",()=>this._createToolbarButton()),t.ui.componentFactory.add("menuBar:uploadImage",()=>this._createMenuBarButton("standalone")),t.plugins.has("ImageInsertUI")&&t.plugins.get("ImageInsertUI").registerIntegration({name:"upload",observable:()=>t.commands.get("uploadImage"),buttonViewCreator:()=>this._createToolbarButton(),formViewCreator:()=>this._createDropdownButton(),menuBarButtonViewCreator:e=>this._createMenuBarButton(e?"insertOnly":"insertNested")})}_createButton(t){const e=this.editor,i=e.locale,n=e.commands.get("uploadImage"),o=e.config.get("image.upload.types"),r=ts(o),l=new t(e.locale),a=i.t;return l.set({acceptedType:o.map(c=>`image/${c}`).join(","),allowMultipleFiles:!0,label:a("Upload from computer"),icon:_.imageUpload}),l.bind("isEnabled").to(n),l.on("done",(c,u)=>{const d=Array.from(u).filter(m=>r.test(m.type));d.length&&(e.execute("uploadImage",{file:d}),e.editing.view.focus())}),l}_createToolbarButton(){const t=this.editor.locale.t,e=this.editor.plugins.get("ImageInsertUI"),i=this.editor.commands.get("uploadImage"),n=this._createButton(Wi);return n.tooltip=!0,n.bind("label").to(e,"isImageSelected",i,"isAccessAllowed",(o,r)=>t(r?o?"Replace image from computer":"Upload image from computer":"You have no image upload permissions.")),n}_createDropdownButton(){const t=this.editor.locale.t,e=this.editor.plugins.get("ImageInsertUI"),i=this._createButton(Wi);return i.withText=!0,i.bind("label").to(e,"isImageSelected",n=>t(n?"Replace from computer":"Upload from computer")),i.on("execute",()=>{e.dropdownView.isOpen=!1}),i}_createMenuBarButton(t){const e=this.editor.locale.t,i=this._createButton(Ir);switch(i.withText=!0,t){case"standalone":i.label=e("Image from computer");break;case"insertOnly":i.label=e("Image");break;case"insertNested":i.label=e("From computer");break}return i}}class Zu extends w{constructor(e){super(e);h(this,"placeholder");h(this,"uploadStatusChange",(e,i,n)=>{const o=this.editor,r=i.item,l=r.getAttribute("uploadId");if(!n.consumable.consume(i.item,e.name))return;const a=o.plugins.get("ImageUtils"),c=o.plugins.get(ce),u=l?i.attributeNewValue:null,d=this.placeholder,m=o.editing.mapper.toViewElement(r),g=n.writer;if(u=="reading"){hn(m,g),fn(a,d,m,g);return}if(u=="uploading"){const f=c.loaders.get(l);hn(m,g),f?(pn(m,g),Xu(m,g,f,o.editing.view),id(a,m,g,f)):fn(a,d,m,g);return}u=="complete"&&c.loaders.get(l)&&Qu(m,g,o.editing.view),Yu(m,g),pn(m,g),Ju(m,g)});this.placeholder="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}static get pluginName(){return"ImageUploadProgress"}static get isOfficialPlugin(){return!0}init(){const e=this.editor;e.plugins.has("ImageBlockEditing")&&e.editing.downcastDispatcher.on("attribute:uploadStatus:imageBlock",this.uploadStatusChange),e.plugins.has("ImageInlineEditing")&&e.editing.downcastDispatcher.on("attribute:uploadStatus:imageInline",this.uploadStatusChange)}}function hn(s,t){s.hasClass("ck-appear")||t.addClass("ck-appear",s)}function Ju(s,t){t.removeClass("ck-appear",s)}function fn(s,t,e,i){e.hasClass("ck-image-upload-placeholder")||i.addClass("ck-image-upload-placeholder",e);const n=s.findViewImgElement(e);n.getAttribute("src")!==t&&i.setAttribute("src",t,n),ns(e,"placeholder")||i.insert(i.createPositionAfter(n),td(i))}function pn(s,t){s.hasClass("ck-image-upload-placeholder")&&t.removeClass("ck-image-upload-placeholder",s),os(s,t,"placeholder")}function Xu(s,t,e,i){const n=ed(t);t.insert(t.createPositionAt(s,"end"),n),e.on("change:uploadedPercent",(o,r,l)=>{i.change(a=>{a.setStyle("width",l+"%",n)})})}function Yu(s,t){os(s,t,"progressBar")}function Qu(s,t,e){const i=t.createUIElement("div",{class:"ck-image-upload-complete-icon"});t.insert(t.createPositionAt(s,"end"),i),setTimeout(()=>{e.change(n=>n.remove(n.createRangeOn(i)))},3e3)}function ed(s){const t=s.createUIElement("div",{class:"ck-progress-bar"});return s.setCustomProperty("progressBar",!0,t),t}function td(s){const t=s.createUIElement("div",{class:"ck-upload-placeholder-loader"});return s.setCustomProperty("placeholder",!0,t),t}function ns(s,t){for(const e of s.getChildren())if(e.getCustomProperty(t))return e}function os(s,t,e){const i=ns(s,e);i&&t.remove(t.createRangeOn(i))}function id(s,t,e,i){if(i.data){const n=s.findViewImgElement(t);e.setAttribute("src",i.data,n)}}class nd extends y{constructor(t){super(t),this.set("isAccessAllowed",!0)}refresh(){const t=this.editor,e=t.plugins.get("ImageUtils"),i=t.model.document.selection.getSelectedElement();this.isEnabled=e.isImageAllowed()||e.isImage(i)}execute(t){const e=ae(t.file),i=this.editor.model.document.selection,n=this.editor.plugins.get("ImageUtils"),o=Object.fromEntries(i.getAttributes());e.forEach((r,l)=>{const a=i.getSelectedElement();if(l&&a&&n.isImage(a)){const c=this.editor.model.createPositionAfter(a);this._uploadImage(r,o,c)}else this._uploadImage(r,o)})}_uploadImage(t,e,i){const n=this.editor,r=n.plugins.get(ce).createLoader(t),l=n.plugins.get("ImageUtils");r&&l.insertImage({...e,uploadId:r.id},i)}}class od extends w{constructor(e){super(e);h(this,"_uploadImageElements");e.config.define("image",{upload:{types:["jpeg","png","gif","bmp","webp","tiff"]}}),this._uploadImageElements=new Map}static get requires(){return[ce,$i,he,B]}static get pluginName(){return"ImageUploadEditing"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,i=e.model.document,n=e.conversion,o=e.plugins.get(ce),r=e.plugins.get("ImageUtils"),l=e.plugins.get("ClipboardPipeline"),a=ts(e.config.get("image.upload.types")),c=new nd(e);e.commands.add("uploadImage",c),e.commands.add("imageUpload",c),n.for("upcast").attributeToAttribute({view:{name:"img",key:"uploadId"},model:"uploadId"}),this.listenTo(e.editing.view.document,"clipboardInput",(u,d)=>{if(sd(d.dataTransfer))return;const m=Array.from(d.dataTransfer.files).filter(f=>f?a.test(f.type):!1);if(!m.length)return;if(u.stop(),e.model.change(f=>{d.targetRanges&&f.setSelection(d.targetRanges.map(p=>e.editing.mapper.toModelRange(p))),e.execute("uploadImage",{file:m})}),!e.commands.get("uploadImage").isAccessAllowed){const f=e.plugins.get("Notification"),p=e.locale.t;f.showWarning(p("You have no image upload permissions."),{namespace:"image"})}}),this.listenTo(l,"inputTransformation",(u,d)=>{const m=Array.from(e.editing.view.createRangeIn(d.content)).map(f=>f.item).filter(f=>ju(r,f)&&!f.getAttribute("uploadProcessed")).map(f=>({promise:$u(f),imageElement:f}));if(!m.length)return;const g=new $(e.editing.view.document);for(const f of m){g.setAttribute("uploadProcessed",!0,f.imageElement);const p=o.createLoader(f.promise);p&&(g.setAttribute("src","",f.imageElement),g.setAttribute("uploadId",p.id,f.imageElement))}}),e.editing.view.document.on("dragover",(u,d)=>{d.preventDefault()}),i.on("change",()=>{const u=i.differ.getChanges({includeChangesInGraveyard:!0}).reverse(),d=new Set;for(const m of u)if(m.type=="insert"&&m.name!="$text"){const g=m.position.nodeAfter,f=m.position.root.rootName=="$graveyard";for(const p of rd(e,g)){const b=p.getAttribute("uploadId");if(!b)continue;const C=o.loaders.get(b);C&&(f?d.has(b)||C.abort():(d.add(b),this._uploadImageElements.set(b,p),C.status=="idle"&&this._readAndUpload(C)))}}}),this.on("uploadComplete",(u,{imageElement:d,data:m})=>{const g=m.urls?m.urls:m;this.editor.model.change(f=>{f.setAttribute("src",g.default,d),this._parseAndSetSrcsetAttributeOnImage(g,d,f),r.setImageNaturalSizeAttributes(d)})},{priority:"low"})}afterInit(){const e=this.editor.model.schema;this.editor.plugins.has("ImageBlockEditing")&&e.extend("imageBlock",{allowAttributes:["uploadId","uploadStatus"]}),this.editor.plugins.has("ImageInlineEditing")&&e.extend("imageInline",{allowAttributes:["uploadId","uploadStatus"]})}_readAndUpload(e){const i=this.editor,n=i.model,o=i.locale.t,r=i.plugins.get(ce),l=i.plugins.get($i),a=i.plugins.get("ImageUtils"),c=this._uploadImageElements;return n.enqueueChange({isUndoable:!1},d=>{d.setAttribute("uploadStatus","reading",c.get(e.id))}),e.read().then(()=>{const d=e.upload(),m=c.get(e.id);/* istanbul ignore next -- @preserve */if(co.isSafari){const g=i.editing.mapper.toViewElement(m),f=a.findViewImgElement(g);i.editing.view.once("render",()=>{if(!f.parent)return;const p=i.editing.view.domConverter.mapViewToDom(f.parent);if(!p)return;const b=p.style.display;p.style.display="none",p._ckHack=p.offsetHeight,p.style.display=b})}return i.ui&&i.ui.ariaLiveAnnouncer.announce(o("Uploading image")),n.enqueueChange({isUndoable:!1},g=>{g.setAttribute("uploadStatus","uploading",m)}),d}).then(d=>{n.enqueueChange({isUndoable:!1},m=>{const g=c.get(e.id);m.setAttribute("uploadStatus","complete",g),i.ui&&i.ui.ariaLiveAnnouncer.announce(o("Image upload complete")),this.fire("uploadComplete",{data:d,imageElement:g})}),u()}).catch(d=>{if(i.ui&&i.ui.ariaLiveAnnouncer.announce(o("Error during image upload")),e.status!=="error"&&e.status!=="aborted")throw d;e.status=="error"&&d&&l.showWarning(d,{title:o("Upload failed"),namespace:"upload"}),n.enqueueChange({isUndoable:!1},m=>{m.remove(c.get(e.id))}),u()});function u(){n.enqueueChange({isUndoable:!1},d=>{const m=c.get(e.id);d.removeAttribute("uploadId",m),d.removeAttribute("uploadStatus",m),c.delete(e.id)}),r.destroyLoader(e)}}_parseAndSetSrcsetAttributeOnImage(e,i,n){let o=0;const r=Object.keys(e).filter(l=>{const a=parseInt(l,10);if(!isNaN(a))return o=Math.max(o,a),!0}).map(l=>`${e[l]} ${l}w`).join(", ");if(r!=""){const l={srcset:r};!i.hasAttribute("width")&&!i.hasAttribute("height")&&(l.width=o),n.setAttributes(l,i)}}}function sd(s){return Array.from(s.types).includes("text/html")&&s.getData("text/html")!==""}function rd(s,t){const e=s.plugins.get("ImageUtils");return Array.from(s.model.createRangeOn(t)).filter(i=>e.isImage(i.item)).map(i=>i.item)}class ss extends w{static get pluginName(){return"ImageUpload"}static get isOfficialPlugin(){return!0}static get requires(){return[od,Ku,Zu]}}class ld extends L{constructor(e){super(e);h(this,"urlInputView");h(this,"keystrokes");this.set("imageURLInputValue",""),this.set("isImageSelected",!1),this.set("isEnabled",!0),this.keystrokes=new j,this.urlInputView=this._createUrlInputView(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-image-insert-url"]},children:[this.urlInputView,{tag:"div",attributes:{class:["ck","ck-image-insert-url__action-row"]}}]})}render(){super.render(),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.keystrokes.destroy()}_createUrlInputView(){const e=this.locale,i=e.t,n=new P(e,z);return n.bind("label").to(this,"isImageSelected",o=>i(o?"Update image URL":"Insert image via URL")),n.bind("isEnabled").to(this),n.fieldView.inputMode="url",n.fieldView.placeholder="https://example.com/image.png",n.fieldView.bind("value").to(this,"imageURLInputValue",o=>o||""),n.fieldView.on("input",()=>{this.imageURLInputValue=n.fieldView.element.value.trim()}),n}focus(){this.urlInputView.focus()}}class ad extends w{constructor(){super(...arguments);h(this,"_imageInsertUI");h(this,"_formView")}static get pluginName(){return"ImageInsertViaUrlUI"}static get isOfficialPlugin(){return!0}static get requires(){return[Ge,Ar]}init(){this.editor.ui.componentFactory.add("insertImageViaUrl",()=>this._createToolbarButton()),this.editor.ui.componentFactory.add("menuBar:insertImageViaUrl",()=>this._createMenuBarButton("standalone"))}afterInit(){this._imageInsertUI=this.editor.plugins.get("ImageInsertUI"),this._imageInsertUI.registerIntegration({name:"url",observable:()=>this.editor.commands.get("insertImage"),buttonViewCreator:()=>this._createToolbarButton(),formViewCreator:()=>this._createDropdownButton(),menuBarButtonViewCreator:e=>this._createMenuBarButton(e?"insertOnly":"insertNested")})}_createInsertUrlButton(e){const i=new e(this.editor.locale);return i.icon=_.imageUrl,i.on("execute",()=>{this._showModal()}),i}_createToolbarButton(){const e=this.editor.locale.t,i=this._createInsertUrlButton(I);return i.tooltip=!0,i.bind("label").to(this._imageInsertUI,"isImageSelected",n=>e(n?"Update image URL":"Insert image via URL")),i}_createDropdownButton(){const e=this.editor.locale.t,i=this._createInsertUrlButton(I);return i.withText=!0,i.bind("label").to(this._imageInsertUI,"isImageSelected",n=>e(n?"Update image URL":"Insert via URL")),i}_createMenuBarButton(e){const i=this.editor.locale.t,n=this._createInsertUrlButton(D);switch(n.withText=!0,e){case"standalone":n.label=i("Image via URL");break;case"insertOnly":n.label=i("Image");break;case"insertNested":n.label=i("Via URL");break}return n}_createInsertUrlView(){const e=this.editor,i=e.locale,n=e.commands.get("replaceImageSource"),o=e.commands.get("insertImage"),r=new ld(i);return r.bind("isImageSelected").to(this._imageInsertUI),r.bind("isEnabled").toMany([o,n],"isEnabled",(...l)=>l.some(a=>a)),r}_showModal(){const e=this.editor,n=e.locale.t,o=e.plugins.get("Dialog");this._formView||(this._formView=this._createInsertUrlView(),this._formView.on("submit",()=>this._handleSave()));const r=e.commands.get("replaceImageSource");this._formView.imageURLInputValue=r.value||"",o.show({id:"insertImageViaUrl",title:this._imageInsertUI.isImageSelected?n("Update image URL"):n("Insert image via URL"),isModal:!0,content:this._formView,actionButtons:[{label:n("Cancel"),withText:!0,onExecute:()=>o.hide()},{label:n("Accept"),class:"ck-button-action",withText:!0,onExecute:()=>this._handleSave()}]})}_handleSave(){this.editor.commands.get("replaceImageSource").isEnabled?this.editor.execute("replaceImageSource",{source:this._formView.imageURLInputValue}):this.editor.execute("insertImage",{source:this._formView.imageURLInputValue}),this.editor.plugins.get("Dialog").hide()}}class rs extends w{static get pluginName(){return"ImageInsertViaUrl"}static get isOfficialPlugin(){return!0}static get requires(){return[ad,Ge]}}class cd extends w{static get pluginName(){return"ImageInsert"}static get isOfficialPlugin(){return!0}static get requires(){return[ss,rs,Ge]}}class ud extends y{refresh(){const t=this.editor,i=t.plugins.get("ImageUtils").getClosestSelectedImageElement(t.model.document.selection);this.isEnabled=!!i,!i||!i.hasAttribute("resizedWidth")?this.value=null:this.value={width:i.getAttribute("resizedWidth"),height:null}}execute(t){const e=this.editor,i=e.model,n=e.plugins.get("ImageUtils"),o=n.getClosestSelectedImageElement(i.document.selection);this.value={width:t.width,height:null},o&&i.change(r=>{r.setAttribute("resizedWidth",t.width,o),r.removeAttribute("resizedHeight",o),n.setImageNaturalSizeAttributes(o)})}}class ls extends w{static get requires(){return[B]}static get pluginName(){return"ImageResizeEditing"}static get isOfficialPlugin(){return!0}constructor(t){super(t),t.config.define("image",{resizeUnit:"%",resizeOptions:[{name:"resizeImage:original",value:null,icon:"original"},{name:"resizeImage:custom",value:"custom",icon:"custom"},{name:"resizeImage:25",value:"25",icon:"small"},{name:"resizeImage:50",value:"50",icon:"medium"},{name:"resizeImage:75",value:"75",icon:"large"}]})}init(){const t=this.editor,e=new ud(t);this._registerConverters("imageBlock"),this._registerConverters("imageInline"),t.commands.add("resizeImage",e),t.commands.add("imageResize",e)}afterInit(){this._registerSchema()}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:["resizedWidth","resizedHeight"]}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:["resizedWidth","resizedHeight"]})}_registerConverters(t){const e=this.editor,i=e.plugins.get("ImageUtils");e.conversion.for("downcast").add(n=>n.on(`attribute:resizedWidth:${t}`,(o,r,l)=>{if(!l.consumable.consume(r.item,o.name))return;const a=l.writer,c=l.mapper.toViewElement(r.item);r.attributeNewValue!==null?(a.setStyle("width",r.attributeNewValue,c),a.addClass("image_resized",c)):(a.removeStyle("width",c),a.removeClass("image_resized",c))})),e.conversion.for("dataDowncast").attributeToAttribute({model:{name:t,key:"resizedHeight"},view:n=>({key:"style",value:{height:n}})}),e.conversion.for("editingDowncast").add(n=>n.on(`attribute:resizedHeight:${t}`,(o,r,l)=>{if(!l.consumable.consume(r.item,o.name))return;const a=l.writer,c=l.mapper.toViewElement(r.item),u=t==="imageInline"?i.findViewImgElement(c):c;r.attributeNewValue!==null?a.setStyle("height",r.attributeNewValue,u):a.removeStyle("height",u)})),e.conversion.for("upcast").attributeToAttribute({view:{name:t==="imageBlock"?"figure":"img",styles:{width:/.+/}},model:{key:"resizedWidth",value:n=>wt(n)?null:n.getStyle("width")}}),e.conversion.for("upcast").attributeToAttribute({view:{name:t==="imageBlock"?"figure":"img",styles:{height:/.+/}},model:{key:"resizedHeight",value:n=>wt(n)?null:n.getStyle("height")}})}}const Mt={small:_.objectSizeSmall,medium:_.objectSizeMedium,large:_.objectSizeLarge,custom:_.objectSizeCustom,original:_.objectSizeFull};class dd extends w{constructor(e){super(e);h(this,"_resizeUnit");this._resizeUnit=e.config.get("image.resizeUnit")}static get requires(){return[ls]}static get pluginName(){return"ImageResizeButtons"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,i=e.config.get("image.resizeOptions"),n=e.commands.get("resizeImage");this.bind("isEnabled").to(n);for(const o of i)this._registerImageResizeButton(o);this._registerImageResizeDropdown(i)}_registerImageResizeButton(e){const i=this.editor,{name:n,value:o,icon:r}=e;i.ui.componentFactory.add(n,l=>{const a=new I(l),c=i.commands.get("resizeImage"),u=this._getOptionLabelValue(e,!0);if(!Mt[r])throw new R("imageresizebuttons-missing-icon",i,e);if(a.set({label:u,icon:Mt[r],tooltip:u,isToggleable:!0}),a.bind("isEnabled").to(this),i.plugins.has("ImageCustomResizeUI")&&Ue(e)){const d=i.plugins.get("ImageCustomResizeUI");this.listenTo(a,"execute",()=>{d._showForm(this._resizeUnit)})}else{const d=o?o+this._resizeUnit:null;a.bind("isOn").to(c,"value",Jt(d)),this.listenTo(a,"execute",()=>{i.execute("resizeImage",{width:d})})}return a})}_registerImageResizeDropdown(e){const i=this.editor,n=i.t,o=e.find(l=>!l.value),r=l=>{const a=i.commands.get("resizeImage"),c=q(l,xr),u=c.buttonView,d=n("Resize image");return u.set({tooltip:d,commandValue:o.value,icon:Mt.medium,isToggleable:!0,label:this._getOptionLabelValue(o),withText:!0,class:"ck-resize-image-button",ariaLabel:d,ariaLabelledBy:void 0}),u.bind("label").to(a,"value",m=>m&&m.width?m.width:this._getOptionLabelValue(o)),c.bind("isEnabled").to(this),Be(c,()=>this._getResizeDropdownListItemDefinitions(e,a),{ariaLabel:n("Image resize list"),role:"menu"}),this.listenTo(c,"execute",m=>{"onClick"in m.source?m.source.onClick():(i.execute(m.source.commandName,{width:m.source.commandValue}),i.editing.view.focus())}),c};i.ui.componentFactory.add("resizeImage",r),i.ui.componentFactory.add("imageResize",r)}_getOptionLabelValue(e,i=!1){const n=this.editor.t;return e.label?e.label:i?Ue(e)?n("Custom image size"):e.value?n("Resize image to %0",e.value+this._resizeUnit):n("Resize image to the original size"):Ue(e)?n("Custom"):e.value?e.value+this._resizeUnit:n("Original")}_getResizeDropdownListItemDefinitions(e,i){const{editor:n}=this,o=new ge,r=e.map(l=>Ue(l)?{...l,valueWithUnits:"custom"}:l.value?{...l,valueWithUnits:`${l.value}${this._resizeUnit}`}:{...l,valueWithUnits:null});for(const l of r){let a=null;if(n.plugins.has("ImageCustomResizeUI")&&Ue(l)){const c=n.plugins.get("ImageCustomResizeUI");a={type:"button",model:new Ve({label:this._getOptionLabelValue(l),role:"menuitemradio",withText:!0,icon:null,onClick:()=>{c._showForm(this._resizeUnit)}})};const u=ba(r,"valueWithUnits");a.model.bind("isOn").to(i,"value",md(u))}else a={type:"button",model:new Ve({commandName:"resizeImage",commandValue:l.valueWithUnits,label:this._getOptionLabelValue(l),role:"menuitemradio",withText:!0,icon:null})},a.model.bind("isOn").to(i,"value",Jt(l.valueWithUnits));a.model.bind("isEnabled").to(i,"isEnabled"),o.add(a)}return o}}function Ue(s){return s.value==="custom"}function Jt(s){return t=>{const e=t;return s===null&&e===s?!0:e!==null&&e.width===s}}function md(s){return t=>!s.some(e=>Jt(e)(t))}const gd="figure.image.ck-widget > img,figure.image.ck-widget > picture > img,figure.image.ck-widget > a > img,figure.image.ck-widget > a > picture > img,span.image-inline.ck-widget > img,span.image-inline.ck-widget > picture > img",Ht="image_resized";class hd extends w{static get requires(){return[Vt,B]}static get pluginName(){return"ImageResizeHandles"}static get isOfficialPlugin(){return!0}init(){const t=this.editor.commands.get("resizeImage");this.bind("isEnabled").to(t),this._setupResizerCreator()}_setupResizerCreator(){const t=this.editor,e=t.editing.view,i=t.plugins.get("ImageUtils");e.addObserver(Bi),this.listenTo(e.document,"imageLoaded",(n,o)=>{if(!o.target.matches(gd))return;const r=t.editing.view.domConverter,l=r.domToView(o.target),a=i.getImageWidgetFromImageView(l);let c=this.editor.plugins.get(Vt).getResizerByViewElement(a);if(c){c.redraw();return}const u=t.editing.mapper,d=u.toModelElement(a);c=t.plugins.get(Vt).attachTo({unit:t.config.get("image.resizeUnit"),modelElement:d,viewElement:a,editor:t,getHandleHost(m){return m.querySelector("img")},getResizeHost(){return r.mapViewToDom(u.toViewElement(d))},isCentered(){return d.getAttribute("imageStyle")=="alignCenter"},onCommit(m){e.change(g=>{g.removeClass(Ht,a)}),t.execute("resizeImage",{width:m})}}),c.on("updateSize",()=>{a.hasClass(Ht)||e.change(g=>{g.addClass(Ht,a)});const m=d.name==="imageInline"?l:a;m.getStyle("height")&&e.change(g=>{g.removeStyle("height",m)})}),c.bind("isEnabled").to(this)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function as(s){if(!s)return null;const[,t,e]=s.trim().match(/([.,\d]+)(%|px)$/)||[],i=Number.parseFloat(t);return Number.isNaN(i)?null:{value:i,unit:e}}function cs(s,t,e){return e==="px"?{value:t.value,unit:"px"}:{value:t.value/s*100,unit:"%"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function us(s){const{editing:t}=s,i=s.plugins.get("ImageUtils").getClosestSelectedImageElement(s.model.document.selection);if(!i)return null;const n=t.mapper.toViewElement(i),o=t.view.domConverter.mapViewToDom(n);return{model:i,view:n,dom:o}}function fd(s,t){const e=us(s);if(!e)return null;const i=as(e.model.getAttribute("resizedWidth")||null);if(!i)return null;if(i.unit===t)return i;const n=uo(e.dom),o={unit:"px",value:new X(e.dom).width};return cs(n,o,t)}class pd extends L{constructor(e,i,n){super(e);h(this,"focusTracker");h(this,"keystrokes");h(this,"unit");h(this,"labeledInput");h(this,"saveButtonView");h(this,"cancelButtonView");h(this,"_focusables");h(this,"_focusCycler");h(this,"_validators");const o=this.locale.t;this.focusTracker=new G,this.keystrokes=new j,this.unit=i,this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(o("Save"),_.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(o("Cancel"),_.cancel,"ck-button-cancel","cancel"),this._focusables=new ie,this._validators=n,this._focusCycler=new ne({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-image-custom-resize-form","ck-responsive-form"],tabindex:"-1"},children:[this.labeledInput,this.saveButtonView,this.cancelButtonView]})}render(){super.render(),this.keystrokes.listenTo(this.element),Le({view:this}),[this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(e,i,n,o){const r=new I(this.locale);return r.set({label:e,icon:i,tooltip:!0}),r.extendTemplate({attributes:{class:n}}),o&&r.delegate("execute").to(this,o),r}_createLabeledInputView(){const e=this.locale.t,i=new P(this.locale,Rr);return i.label=e("Resize image (in %0)",this.unit),i.fieldView.set({step:.1}),i}isValid(){this.resetFormStatus();for(const e of this._validators){const i=e(this);if(i)return this.labeledInput.errorText=i,!1}return!0}resetFormStatus(){this.labeledInput.errorText=null}get rawSize(){const{element:e}=this.labeledInput.fieldView;return e?e.value:null}get parsedSize(){const{rawSize:e}=this;if(e===null)return null;const i=Number.parseFloat(e);return Number.isNaN(i)?null:i}get sizeWithUnits(){const{parsedSize:e,unit:i}=this;return e===null?null:`${e}${i}`}}function bd(s,t){const e=us(s);if(!e)return null;const i=uo(e.dom),n=as(window.getComputedStyle(e.dom).minWidth)||{value:1,unit:"px"},o=Math.max(.1,cs(i,n,t).value);return{unit:t,lower:o,upper:t==="px"?i:100}}class wd extends w{constructor(){super(...arguments);h(this,"_balloon");h(this,"_form")}static get requires(){return[te]}static get pluginName(){return"ImageCustomResizeUI"}static get isOfficialPlugin(){return!0}destroy(){super.destroy(),this._form&&this._form.destroy()}_createForm(e){const i=this.editor;this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new(wi(pd))(i.locale,e,Cd(i)),this._form.render(),this.listenTo(this._form,"submit",()=>{this._form.isValid()&&(i.execute("resizeImage",{width:this._form.sizeWithUnits}),this._hideForm(!0))}),this.listenTo(this._form.labeledInput,"change:errorText",()=>{i.ui.update()}),this.listenTo(this._form,"cancel",()=>{this._hideForm(!0)}),this._form.keystrokes.set("Esc",(n,o)=>{this._hideForm(!0),o()}),qe({emitter:this._form,activator:()=>this._isVisible,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(e){if(this._isVisible)return;this._form||this._createForm(e);const i=this.editor,n=this._form.labeledInput;this._form.disableCssTransitions(),this._form.resetFormStatus(),this._isInBalloon||this._balloon.add({view:this._form,position:Vi(i)});const o=fd(i,e),r=o?o.value.toFixed(1):"",l=bd(i,e);n.fieldView.value=n.fieldView.element.value=r,l&&Object.assign(n.fieldView,{min:l.lower.toFixed(1),max:Math.ceil(l.upper).toFixed(1)}),this._form.labeledInput.fieldView.select(),this._form.enableCssTransitions()}_hideForm(e=!1){this._isInBalloon&&(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),e&&this.editor.editing.view.focus())}get _isVisible(){return!!this._balloon&&this._balloon.visibleView===this._form}get _isInBalloon(){return!!this._balloon&&this._balloon.hasView(this._form)}}function Cd(s){const t=s.t;return[e=>{if(e.rawSize.trim()==="")return t("The value must not be empty.");if(e.parsedSize===null)return t("The value should be a plain number.")}]}class vd extends w{static get requires(){return[ls,hd,wd,dd]}static get pluginName(){return"ImageResize"}static get isOfficialPlugin(){return!0}}class _d extends y{constructor(e,i){super(e);h(this,"_defaultStyles");h(this,"_styles");this._defaultStyles={imageBlock:!1,imageInline:!1},this._styles=new Map(i.map(n=>{if(n.isDefault)for(const o of n.modelElements)this._defaultStyles[o]=n.name;return[n.name,n]}))}refresh(){const n=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!n,this.isEnabled?n.hasAttribute("imageStyle")?this.value=n.getAttribute("imageStyle"):this.value=this._defaultStyles[n.name]:this.value=!1}execute(e={}){const i=this.editor,n=i.model,o=i.plugins.get("ImageUtils");n.change(r=>{const l=e.value,{setImageSizes:a=!0}=e;let c=o.getClosestSelectedImageElement(n.document.selection);l&&this.shouldConvertImageType(l,c)&&(this.editor.execute(o.isBlockImage(c)?"imageTypeInline":"imageTypeBlock",{setImageSizes:a}),c=o.getClosestSelectedImageElement(n.document.selection)),!l||this._styles.get(l).isDefault?r.removeAttribute("imageStyle",c):r.setAttribute("imageStyle",l,c),a&&o.setImageNaturalSizeAttributes(c)})}shouldConvertImageType(e,i){return!this._styles.get(e).modelElements.includes(i.name)}}const nt={get inline(){return{name:"inline",title:"In line",icon:_.objectInline,modelElements:["imageInline"],isDefault:!0}},get alignLeft(){return{name:"alignLeft",title:"Left aligned image",icon:_.objectLeft,modelElements:["imageBlock","imageInline"],className:"image-style-align-left"}},get alignBlockLeft(){return{name:"alignBlockLeft",title:"Left aligned image",icon:_.objectBlockLeft,modelElements:["imageBlock"],className:"image-style-block-align-left"}},get alignCenter(){return{name:"alignCenter",title:"Centered image",icon:_.objectCenter,modelElements:["imageBlock"],className:"image-style-align-center"}},get alignRight(){return{name:"alignRight",title:"Right aligned image",icon:_.objectRight,modelElements:["imageBlock","imageInline"],className:"image-style-align-right"}},get alignBlockRight(){return{name:"alignBlockRight",title:"Right aligned image",icon:_.objectBlockRight,modelElements:["imageBlock"],className:"image-style-block-align-right"}},get block(){return{name:"block",title:"Centered image",icon:_.objectCenter,modelElements:["imageBlock"],isDefault:!0}},get side(){return{name:"side",title:"Side image",icon:_.objectRight,modelElements:["imageBlock"],className:"image-style-side"}}},ds={full:_.objectFullWidth,left:_.objectBlockLeft,right:_.objectBlockRight,center:_.objectCenter,inlineLeft:_.objectLeft,inlineRight:_.objectRight,inline:_.objectInline},ms=[{name:"imageStyle:wrapText",title:"Wrap text",defaultItem:"imageStyle:alignLeft",items:["imageStyle:alignLeft","imageStyle:alignRight"]},{name:"imageStyle:breakText",title:"Break text",defaultItem:"imageStyle:block",items:["imageStyle:alignBlockLeft","imageStyle:block","imageStyle:alignBlockRight"]}];function kd(s){return(s.configuredStyles.options||[]).map(i=>Ad(i)).filter(i=>Td(i,s))}function yd(s,t){return s&&t?{options:["inline","alignLeft","alignRight","alignCenter","alignBlockLeft","alignBlockRight","block","side"]}:s?{options:["block","side"]}:t?{options:["inline","alignLeft","alignRight"]}:{}}function Id(s){return s.has("ImageBlockEditing")&&s.has("ImageInlineEditing")?[...ms]:[]}function Ad(s){return typeof s=="string"?nt[s]?s={...nt[s]}:s={name:s}:s=Ed(nt[s.name],s),typeof s.icon=="string"&&(s.icon=ds[s.icon]||s.icon),s}function Td(s,{isBlockPluginLoaded:t,isInlinePluginLoaded:e}){const{modelElements:i,name:n}=s;if(!i||!i.length||!n)return gs({style:s}),!1;{const o=[t?"imageBlock":null,e?"imageInline":null];if(!i.some(r=>o.includes(r)))return N("image-style-missing-dependency",{style:s,missingPlugins:i.map(r=>r==="imageBlock"?"ImageBlockEditing":"ImageInlineEditing")}),!1}return!0}function Ed(s,t){const e={...t};for(const i in s)Object.prototype.hasOwnProperty.call(t,i)||(e[i]=s[i]);return e}function gs(s){N("image-style-configuration-definition-invalid",s)}var Xt={normalizeStyles:kd,getDefaultStylesConfiguration:yd,getDefaultDropdownDefinitions:Id,warnInvalidStyle:gs,DEFAULT_OPTIONS:nt,DEFAULT_ICONS:ds,DEFAULT_DROPDOWN_DEFINITIONS:ms};function Sd(s){return(t,e,i)=>{if(!i.consumable.consume(e.item,t.name))return;const n=bn(e.attributeNewValue,s),o=bn(e.attributeOldValue,s),r=i.mapper.toViewElement(e.item),l=i.writer;o&&l.removeClass(o.className,r),n&&l.addClass(n.className,r)}}function xd(s){const t={imageInline:s.filter(e=>!e.isDefault&&e.modelElements.includes("imageInline")),imageBlock:s.filter(e=>!e.isDefault&&e.modelElements.includes("imageBlock"))};return(e,i,n)=>{if(!i.modelRange)return;const o=i.viewItem,r=U(i.modelRange.getItems());if(r&&n.schema.checkAttribute(r,"imageStyle"))for(const l of t[r.name])n.consumable.consume(o,{classes:l.className})&&n.writer.setAttribute("imageStyle",l.name,r)}}function bn(s,t){for(const e of t)if(e.name===s)return e}class hs extends w{constructor(){super(...arguments);h(this,"normalizedStyles")}static get pluginName(){return"ImageStyleEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[B]}init(){const{normalizeStyles:e,getDefaultStylesConfiguration:i}=Xt,n=this.editor,o=n.plugins.has("ImageBlockEditing"),r=n.plugins.has("ImageInlineEditing");n.config.define("image.styles",i(o,r)),this.normalizedStyles=e({configuredStyles:n.config.get("image.styles"),isBlockPluginLoaded:o,isInlinePluginLoaded:r}),this._setupConversion(o,r),this._setupPostFixer(),n.commands.add("imageStyle",new _d(n,this.normalizedStyles))}_setupConversion(e,i){const n=this.editor,o=n.model.schema,r=Sd(this.normalizedStyles),l=xd(this.normalizedStyles);n.editing.downcastDispatcher.on("attribute:imageStyle",r),n.data.downcastDispatcher.on("attribute:imageStyle",r),e&&(o.extend("imageBlock",{allowAttributes:"imageStyle"}),n.data.upcastDispatcher.on("element:figure",l,{priority:"low"})),i&&(o.extend("imageInline",{allowAttributes:"imageStyle"}),n.data.upcastDispatcher.on("element:img",l,{priority:"low"}))}_setupPostFixer(){const e=this.editor,i=e.model.document,n=e.plugins.get(B),o=new Map(this.normalizedStyles.map(r=>[r.name,r]));i.registerPostFixer(r=>{let l=!1;for(const a of i.differ.getChanges())if(a.type=="insert"||a.type=="attribute"&&a.attributeKey=="imageStyle"){let c=a.type=="insert"?a.position.nodeAfter:a.range.start.nodeAfter;if(c&&c.is("element","paragraph")&&c.childCount>0&&(c=c.getChild(0)),!n.isImage(c))continue;const u=c.getAttribute("imageStyle");if(!u)continue;const d=o.get(u);(!d||!d.modelElements.includes(c.name))&&(r.removeAttribute("imageStyle",c),l=!0)}return l})}}class Rd extends w{static get requires(){return[hs]}static get pluginName(){return"ImageStyleUI"}static get isOfficialPlugin(){return!0}get localizedDefaultStylesTitles(){const t=this.editor.t;return{"Wrap text":t("Wrap text"),"Break text":t("Break text"),"In line":t("In line"),"Full size image":t("Full size image"),"Side image":t("Side image"),"Left aligned image":t("Left aligned image"),"Centered image":t("Centered image"),"Right aligned image":t("Right aligned image")}}init(){const t=this.editor.plugins,e=this.editor.config.get("image.toolbar")||[],i=t.get("ImageStyleEditing"),n=wn(i.normalizedStyles,this.localizedDefaultStylesTitles);for(const r of n)this._createButton(r);const o=wn([...e.filter(yi),...Xt.getDefaultDropdownDefinitions(t)],this.localizedDefaultStylesTitles);for(const r of o)this._createDropdown(r,n)}_createDropdown(t,e){const i=this.editor.ui.componentFactory;i.add(t.name,n=>{let o;const{defaultItem:r,items:l,title:a}=t,c=l.filter(g=>e.find(({name:f})=>Cn(f)===g)).map(g=>{const f=i.create(g);return g===r&&(o=f),f});l.length!==c.length&&Xt.warnInvalidStyle({dropdown:t});const u=q(n,Tt),d=u.buttonView,m=d.arrowView;return Tr(u,c,{enableActiveItemFocusOnDropdownOpen:!0}),d.set({label:vn(a,o.label),class:null,tooltip:!0}),m.unbind("label"),m.set({label:a}),d.bind("icon").toMany(c,"isOn",(...g)=>{const f=g.findIndex(Fe);return f<0?o.icon:c[f].icon}),d.bind("label").toMany(c,"isOn",(...g)=>{const f=g.findIndex(Fe);return vn(a,f<0?o.label:c[f].label)}),d.bind("isOn").toMany(c,"isOn",(...g)=>g.some(Fe)),d.bind("class").toMany(c,"isOn",(...g)=>g.some(Fe)?"ck-splitbutton_flatten":void 0),d.on("execute",()=>{c.some(({isOn:g})=>g)?u.isOpen=!u.isOpen:o.fire("execute")}),u.bind("isEnabled").toMany(c,"isEnabled",(...g)=>g.some(Fe)),this.listenTo(u,"execute",()=>{this.editor.editing.view.focus()}),u})}_createButton(t){const e=t.name;this.editor.ui.componentFactory.add(Cn(e),i=>{const n=this.editor.commands.get("imageStyle"),o=new I(i);return o.set({label:t.title,icon:t.icon,tooltip:!0,isToggleable:!0}),o.bind("isEnabled").to(n,"isEnabled"),o.bind("isOn").to(n,"value",r=>r===e),o.on("execute",this._executeCommand.bind(this,e)),o})}_executeCommand(t){this.editor.execute("imageStyle",{value:t}),this.editor.editing.view.focus()}}function wn(s,t){for(const e of s)t[e.title]&&(e.title=t[e.title]);return s}function Cn(s){return`imageStyle:${s}`}function vn(s,t){return(s?s+": ":"")+t}class Vd extends w{static get requires(){return[hs,Rd]}static get pluginName(){return"ImageStyle"}static get isOfficialPlugin(){return!0}}class Pd extends w{static get requires(){return[ut,B]}static get pluginName(){return"ImageToolbar"}static get isOfficialPlugin(){return!0}afterInit(){const t=this.editor,e=t.t,i=t.plugins.get(ut),n=t.plugins.get("ImageUtils");i.register("image",{ariaLabel:e("Image toolbar"),items:Bd(t.config.get("image.toolbar")||[]),getRelatedElement:o=>n.getClosestSelectedImageWidget(o)})}}function Bd(s){return s.map(t=>yi(t)?t.name:t)}class Ld extends w{static get requires(){return[Li,B]}static get pluginName(){return"PictureEditing"}static get isOfficialPlugin(){return!0}afterInit(){const t=this.editor;t.plugins.has("ImageBlockEditing")&&t.model.schema.extend("imageBlock",{allowAttributes:["sources"]}),t.plugins.has("ImageInlineEditing")&&t.model.schema.extend("imageInline",{allowAttributes:["sources"]}),this._setupConversion(),this._setupImageUploadEditingIntegration()}_setupConversion(){const t=this.editor,e=t.conversion,i=t.plugins.get("ImageUtils");e.for("upcast").add(Pu(i)),e.for("downcast").add(Bu(i))}_setupImageUploadEditingIntegration(){const t=this.editor;if(!t.plugins.has("ImageUploadEditing"))return;const e=t.plugins.get("ImageUploadEditing");this.listenTo(e,"uploadComplete",(i,{imageElement:n,data:o})=>{const r=o.sources;r&&t.model.change(l=>{l.setAttributes({sources:r},n)})})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Od{constructor(){h(this,"_definitions",new Set)}get length(){return this._definitions.size}add(t){Array.isArray(t)?t.forEach(e=>this._definitions.add(e)):this._definitions.add(t)}getDispatcher(){return t=>{t.on("attribute:linkHref",(e,i,n)=>{if(!n.consumable.test(i.item,"attribute:linkHref")||!(i.item.is("selection")||n.schema.isInline(i.item)))return;const o=n.writer,r=o.document.selection;for(const l of this._definitions){const a=o.createAttributeElement("a",l.attributes,{priority:5});l.classes&&o.addClass(l.classes,a);for(const c in l.styles)o.setStyle(c,l.styles[c],a);o.setCustomProperty("link",!0,a),l.callback(i.attributeNewValue)?i.item.is("selection")?o.wrap(r.getFirstRange(),a):o.wrap(n.mapper.toViewRange(i.range),a):o.unwrap(n.mapper.toViewRange(i.range),a)}},{priority:"high"})}}getDispatcherForLinkedImage(){return t=>{t.on("attribute:linkHref:imageBlock",(e,i,{writer:n,mapper:o})=>{const r=o.toViewElement(i.item),l=Array.from(r.getChildren()).find(a=>a.is("element","a"));if(l)for(const a of this._definitions){const c=_i(a.attributes);if(a.callback(i.attributeNewValue)){for(const[u,d]of c)u==="class"?n.addClass(d,l):n.setAttribute(u,d,l);a.classes&&n.addClass(a.classes,l);for(const u in a.styles)n.setStyle(u,a.styles[u],l)}else{for(const[u,d]of c)u==="class"?n.removeClass(d,l):n.removeAttribute(u,l);a.classes&&n.removeClass(a.classes,l);for(const u in a.styles)n.removeStyle(u,l)}}})}}}const Fd=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,Ud="^(?:(?:<protocols>):|[^a-z]|[a-z+.-]+(?:[^a-z+.:-]|$))",Dd=/^[\S]+@((?![-_])(?:[-\w\u00a1-\uffff]{0,63}[^-_]\.))+(?:[a-z\u00a1-\uffff]{2,})$/i,Nd=/^((\w+:(\/{2,})?)|(\W))/i,Md=["https?","ftps?","mailto"],De="Ctrl+K";function Hd(s){return s.is("attributeElement")&&!!s.getCustomProperty("link")}function _n(s,{writer:t}){const e=t.createAttributeElement("a",{href:s},{priority:5});return t.setCustomProperty("link",!0,e),e}function fs(s,t=Md){const e=String(s),i=t.join("|"),n=new RegExp(`${Ud.replace("<protocols>",i)}`,"i");return zd(e,n)?e:"#"}function zd(s,t){return!!s.replace(Fd,"").match(t)}function Wd(s,t){const e={"Open in a new tab":s("Open in a new tab"),Downloadable:s("Downloadable")};return t.forEach(i=>("label"in i&&e[i.label]&&(i.label=e[i.label]),i)),t}function $d(s){const t=[];if(s)for(const[e,i]of Object.entries(s)){const n=Object.assign({},i,{id:`link${So(e)}`});t.push(n)}return t}function Yt(s,t){return s?t.checkAttribute(s.name,"linkHref"):!1}function jd(s){return Dd.test(s)}function Oi(s,t){const e=jd(s)?"mailto:":t,i=!!e&&!ps(s);return s&&i?e+s:s}function ps(s){return Nd.test(s)}function kn(s){window.open(s,"_blank","noopener")}class qd extends y{constructor(){super(...arguments);h(this,"manualDecorators",new ge);h(this,"automaticDecorators",new Od)}restoreManualDecoratorStates(){for(const e of this.manualDecorators)e.value=this._getDecoratorStateFromModel(e.id)}refresh(){const e=this.editor.model,i=e.document.selection,n=i.getSelectedElement()||U(i.getSelectedBlocks());Yt(n,e.schema)?(this.value=n.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttribute(n,"linkHref")):(this.value=i.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttributeInSelection(i,"linkHref"));for(const o of this.manualDecorators)o.value=this._getDecoratorStateFromModel(o.id)}execute(e,i={}){const n=this.editor.model,o=n.document.selection,r=[],l=[];for(const a in i)i[a]?r.push(a):l.push(a);n.change(a=>{if(o.isCollapsed){const c=o.getFirstPosition();if(o.hasAttribute("linkHref")){const u=yn(o);let d=vi(c,"linkHref",o.getAttribute("linkHref"),n);o.getAttribute("linkHref")===u&&(d=this._updateLinkContent(n,a,d,e)),a.setAttribute("linkHref",e,d),r.forEach(m=>{a.setAttribute(m,!0,d)}),l.forEach(m=>{a.removeAttribute(m,d)}),a.setSelection(a.createPositionAfter(d.end.nodeBefore))}else if(e!==""){const u=_i(o.getAttributes());u.set("linkHref",e),r.forEach(m=>{u.set(m,!0)});const{end:d}=n.insertContent(a.createText(e,u),c);a.setSelection(d)}["linkHref",...r,...l].forEach(u=>{a.removeSelectionAttribute(u)})}else{const c=n.schema.getValidRanges(o.getRanges(),"linkHref"),u=[];for(const m of o.getSelectedBlocks())n.schema.checkAttribute(m,"linkHref")&&u.push(a.createRangeOn(m));const d=u.slice();for(const m of c)this._isRangeToUpdate(m,u)&&d.push(m);for(const m of d){let g=m;if(d.length===1){const f=yn(o);o.getAttribute("linkHref")===f&&(g=this._updateLinkContent(n,a,m,e),a.setSelection(a.createSelection(g)))}a.setAttribute("linkHref",e,g),r.forEach(f=>{a.setAttribute(f,!0,g)}),l.forEach(f=>{a.removeAttribute(f,g)})}}})}_getDecoratorStateFromModel(e){const i=this.editor.model,n=i.document.selection,o=n.getSelectedElement();return Yt(o,i.schema)?o.getAttribute(e):n.getAttribute(e)}_isRangeToUpdate(e,i){for(const n of i)if(n.containsRange(e))return!1;return!0}_updateLinkContent(e,i,n,o){const r=i.createText(o,{linkHref:o});return e.insertContent(r,n)}}function yn(s){if(s.isCollapsed){const t=s.getFirstPosition();return t.textNode&&t.textNode.data}else{const t=Array.from(s.getFirstRange().getItems());if(t.length>1)return null;const e=t[0];return e.is("$text")||e.is("$textProxy")?e.data:null}}class Gd extends y{refresh(){const t=this.editor.model,e=t.document.selection,i=e.getSelectedElement();Yt(i,t.schema)?this.isEnabled=t.schema.checkAttribute(i,"linkHref"):this.isEnabled=t.schema.checkAttributeInSelection(e,"linkHref")}execute(){const t=this.editor,e=this.editor.model,i=e.document.selection,n=t.commands.get("link");e.change(o=>{const r=i.isCollapsed?[vi(i.getFirstPosition(),"linkHref",i.getAttribute("linkHref"),e)]:e.schema.getValidRanges(i.getRanges(),"linkHref");for(const l of r)if(o.removeAttribute("linkHref",l),n)for(const a of n.manualDecorators)o.removeAttribute(a.id,l)})}}class Kd extends It(){constructor({id:e,label:i,attributes:n,classes:o,styles:r,defaultValue:l}){super();h(this,"id");h(this,"defaultValue");h(this,"label");h(this,"attributes");h(this,"classes");h(this,"styles");this.id=e,this.set("value",void 0),this.defaultValue=l,this.label=i,this.attributes=n,this.classes=o,this.styles=r}_createPattern(){return{attributes:this.attributes,classes:this.classes,styles:this.styles}}}const Zd="ck-link_selected",In="automatic",Jd="manual",Xd=/^(https?:)?\/\//;class St extends w{static get pluginName(){return"LinkEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[lt,Br,he]}constructor(t){super(t),t.config.define("link",{allowCreatingEmptyLinks:!1,addTargetToExternalLinks:!1})}init(){const t=this.editor,e=this.editor.config.get("link.allowedProtocols");t.model.schema.extend("$text",{allowAttributes:"linkHref"}),t.conversion.for("dataDowncast").attributeToElement({model:"linkHref",view:_n}),t.conversion.for("editingDowncast").attributeToElement({model:"linkHref",view:(o,r)=>_n(fs(o,e),r)}),t.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{href:!0}},model:{key:"linkHref",value:o=>o.getAttribute("href")}}),t.commands.add("link",new qd(t)),t.commands.add("unlink",new Gd(t));const i=Wd(t.t,$d(t.config.get("link.decorators")));this._enableAutomaticDecorators(i.filter(o=>o.mode===In)),this._enableManualDecorators(i.filter(o=>o.mode===Jd)),t.plugins.get(lt).registerAttribute("linkHref"),eo(t,"linkHref","a",Zd),this._enableLinkOpen(),this._enableSelectionAttributesFixer(),this._enableClipboardIntegration()}_enableAutomaticDecorators(t){const e=this.editor,n=e.commands.get("link").automaticDecorators;e.config.get("link.addTargetToExternalLinks")&&n.add({id:"linkIsExternal",mode:In,callback:o=>!!o&&Xd.test(o),attributes:{target:"_blank",rel:"noopener noreferrer"}}),n.add(t),n.length&&e.conversion.for("downcast").add(n.getDispatcher())}_enableManualDecorators(t){if(!t.length)return;const e=this.editor,n=e.commands.get("link").manualDecorators;t.forEach(o=>{e.model.schema.extend("$text",{allowAttributes:o.id});const r=new Kd(o);n.add(r),e.conversion.for("downcast").attributeToElement({model:r.id,view:(l,{writer:a,schema:c},{item:u})=>{if((u.is("selection")||c.isInline(u))&&l){const d=a.createAttributeElement("a",r.attributes,{priority:5});r.classes&&a.addClass(r.classes,d);for(const m in r.styles)a.setStyle(m,r.styles[m],d);return a.setCustomProperty("link",!0,d),d}}}),e.conversion.for("upcast").elementToAttribute({view:{name:"a",...r._createPattern()},model:{key:r.id}})})}_enableLinkOpen(){const t=this.editor,i=t.editing.view.document;this.listenTo(i,"click",(n,o)=>{if(!(co.isMac?o.domEvent.metaKey:o.domEvent.ctrlKey))return;let l=o.domTarget;if(l.tagName.toLowerCase()!="a"&&(l=l.closest("a")),!l)return;const a=l.getAttribute("href");a&&(n.stop(),o.preventDefault(),kn(a))},{context:"$capture"}),this.listenTo(i,"keydown",(n,o)=>{const l=t.commands.get("link").value;l&&o.keyCode===Lr.enter&&o.altKey&&(n.stop(),kn(l))})}_enableSelectionAttributesFixer(){const e=this.editor.model,i=e.document.selection;this.listenTo(i,"change:attribute",(n,{attributeKeys:o})=>{!o.includes("linkHref")||i.hasAttribute("linkHref")||e.change(r=>{Yd(r,Qd(e.schema))})})}_enableClipboardIntegration(){const t=this.editor,e=t.model,i=this.editor.config.get("link.defaultProtocol");i&&this.listenTo(t.plugins.get("ClipboardPipeline"),"contentInsertion",(n,o)=>{e.change(r=>{const l=r.createRangeIn(o.content);for(const a of l.getItems())if(a.hasAttribute("linkHref")){const c=Oi(a.getAttribute("linkHref"),i);r.setAttribute("linkHref",c,a)}})})}}function Yd(s,t){s.removeSelectionAttribute("linkHref");for(const e of t)s.removeSelectionAttribute(e)}function Qd(s){return s.getDefinition("$text").allowAttributes.filter(e=>e.startsWith("link"))}class em extends L{constructor(e,i,n){super(e);h(this,"focusTracker",new G);h(this,"keystrokes",new j);h(this,"urlInputView");h(this,"saveButtonView");h(this,"cancelButtonView");h(this,"_manualDecoratorSwitches");h(this,"children");h(this,"_validators");h(this,"_focusables",new ie);h(this,"_focusCycler");const o=e.t;this._validators=n,this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(o("Save"),_.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(o("Cancel"),_.cancel,"ck-button-cancel","cancel"),this._manualDecoratorSwitches=this._createManualDecoratorSwitches(i),this.children=this._createFormChildren(i.manualDecorators),this._focusCycler=new ne({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});const r=["ck","ck-link-form","ck-responsive-form"];i.manualDecorators.length&&r.push("ck-link-form_layout-vertical","ck-vertical-form"),this.setTemplate({tag:"form",attributes:{class:r,tabindex:"-1"},children:this.children})}getDecoratorSwitchesState(){return Array.from(this._manualDecoratorSwitches).reduce((e,i)=>(e[i.name]=i.isOn,e),{})}render(){super.render(),Le({view:this}),[this.urlInputView,...this._manualDecoratorSwitches,this.saveButtonView,this.cancelButtonView].forEach(i=>{this._focusables.add(i),this.focusTracker.add(i.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}isValid(){this.resetFormStatus();for(const e of this._validators){const i=e(this);if(i)return this.urlInputView.errorText=i,!1}return!0}resetFormStatus(){this.urlInputView.errorText=null}_createUrlInput(){const e=this.locale.t,i=new P(this.locale,z);return i.fieldView.inputMode="url",i.label=e("Link URL"),i}_createButton(e,i,n,o){const r=new I(this.locale);return r.set({label:e,icon:i,tooltip:!0}),r.extendTemplate({attributes:{class:n}}),o&&r.delegate("execute").to(this,o),r}_createManualDecoratorSwitches(e){const i=this.createCollection();for(const n of e.manualDecorators){const o=new mo(this.locale);o.set({name:n.id,label:n.label,withText:!0}),o.bind("isOn").toMany([n,e],"value",(r,l)=>l===void 0&&r===void 0?!!n.defaultValue:!!r),o.on("execute",()=>{n.set("value",!o.isOn)}),i.add(o)}return i}_createFormChildren(e){const i=this.createCollection();if(i.add(this.urlInputView),e.length){const n=new L;n.setTemplate({tag:"ul",children:this._manualDecoratorSwitches.map(o=>({tag:"li",children:[o],attributes:{class:["ck","ck-list__item"]}})),attributes:{class:["ck","ck-reset","ck-list"]}}),i.add(n)}return i.add(this.saveButtonView),i.add(this.cancelButtonView),i}get url(){const{element:e}=this.urlInputView.fieldView;return e?e.value.trim():null}}var tm='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184zm4.919 10.562-1.414 1.414a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.061-1.06l1.414 1.414 1.414-1.415a.75.75 0 0 1 1.061 1.061l-1.414 1.414 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414z"/></svg>';class im extends L{constructor(e,i={}){super(e);h(this,"focusTracker",new G);h(this,"keystrokes",new j);h(this,"previewButtonView");h(this,"unlinkButtonView");h(this,"editButtonView");h(this,"_focusables",new ie);h(this,"_focusCycler");h(this,"_linkConfig");const n=e.t;this.previewButtonView=this._createPreviewButton(),this.unlinkButtonView=this._createButton(n("Unlink"),tm,"unlink"),this.editButtonView=this._createButton(n("Edit link"),_.pencil,"edit"),this.set("href",void 0),this._linkConfig=i,this._focusCycler=new ne({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-link-actions","ck-responsive-form"],tabindex:"-1"},children:[this.previewButtonView,this.editButtonView,this.unlinkButtonView]})}render(){super.render(),[this.previewButtonView,this.editButtonView,this.unlinkButtonView].forEach(i=>{this._focusables.add(i),this.focusTracker.add(i.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createButton(e,i,n){const o=new I(this.locale);return o.set({label:e,icon:i,tooltip:!0}),o.delegate("execute").to(this,n),o}_createPreviewButton(){const e=new I(this.locale),i=this.bindTemplate,n=this.t;return e.set({withText:!0,tooltip:n("Open link in new tab")}),e.extendTemplate({attributes:{class:["ck","ck-link-actions__preview"],href:i.to("href",o=>o&&fs(o,this._linkConfig.allowedProtocols)),target:"_blank",rel:"noopener noreferrer"}}),e.bind("label").to(this,"href",o=>o||n("This link has no URL")),e.bind("isEnabled").to(this,"href",o=>!!o),e.template.tag="a",e.template.eventListeners={},e}}var bs='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184z"/></svg>';const H="link-ui";class ws extends w{constructor(){super(...arguments);h(this,"actionsView",null);h(this,"formView",null);h(this,"_balloon")}static get requires(){return[te]}static get pluginName(){return"LinkUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,i=this.editor.t;e.editing.view.addObserver(Or),this._balloon=e.plugins.get(te),this._createToolbarLinkButton(),this._enableBalloonActivators(),e.conversion.for("editingDowncast").markerToHighlight({model:H,view:{classes:["ck-fake-link-selection"]}}),e.conversion.for("editingDowncast").markerToElement({model:H,view:(n,{writer:o})=>{if(!n.markerRange.isCollapsed)return null;const r=o.createUIElement("span");return o.addClass(["ck-fake-link-selection","ck-fake-link-selection_collapsed"],r),r}}),e.accessibility.addKeystrokeInfos({keystrokes:[{label:i("Create link"),keystroke:De},{label:i("Move out of a link"),keystroke:[["arrowleft","arrowleft"],["arrowright","arrowright"]]}]})}destroy(){super.destroy(),this.formView&&this.formView.destroy(),this.actionsView&&this.actionsView.destroy()}_createViews(){this.actionsView=this._createActionsView(),this.formView=this._createFormView(),this._enableUserBalloonInteractions()}_createActionsView(){const e=this.editor,i=new im(e.locale,e.config.get("link")),n=e.commands.get("link"),o=e.commands.get("unlink");return i.bind("href").to(n,"value"),i.editButtonView.bind("isEnabled").to(n),i.unlinkButtonView.bind("isEnabled").to(o),this.listenTo(i,"edit",()=>{this._addFormView()}),this.listenTo(i,"unlink",()=>{e.execute("unlink"),this._hideUI()}),i.keystrokes.set("Esc",(r,l)=>{this._hideUI(),l()}),i.keystrokes.set(De,(r,l)=>{this._addFormView(),l()}),i}_createFormView(){const e=this.editor,i=e.commands.get("link"),n=e.config.get("link.defaultProtocol"),o=new(wi(em))(e.locale,i,nm(e));return o.urlInputView.fieldView.bind("value").to(i,"value"),o.urlInputView.bind("isEnabled").to(i,"isEnabled"),o.saveButtonView.bind("isEnabled").to(i,"isEnabled"),this.listenTo(o,"submit",()=>{if(o.isValid()){const{value:r}=o.urlInputView.fieldView.element,l=Oi(r,n);e.execute("link",l,o.getDecoratorSwitchesState()),this._closeFormView()}}),this.listenTo(o.urlInputView,"change:errorText",()=>{e.ui.update()}),this.listenTo(o,"cancel",()=>{this._closeFormView()}),o.keystrokes.set("Esc",(r,l)=>{this._closeFormView(),l()}),o}_createToolbarLinkButton(){const e=this.editor;e.ui.componentFactory.add("link",()=>{const i=this._createButton(I);return i.set({tooltip:!0}),i}),e.ui.componentFactory.add("menuBar:link",()=>{const i=this._createButton(D);return i.set({role:"menuitemcheckbox"}),i})}_createButton(e){const i=this.editor,n=i.locale,o=i.commands.get("link"),r=new e(i.locale),l=n.t;return r.set({label:l("Link"),icon:bs,keystroke:De,isToggleable:!0}),r.bind("isEnabled").to(o,"isEnabled"),r.bind("isOn").to(o,"value",a=>!!a),this.listenTo(r,"execute",()=>this._showUI(!0)),r}_enableBalloonActivators(){const e=this.editor,i=e.editing.view.document;this.listenTo(i,"click",()=>{this._getSelectedLinkElement()&&this._showUI()}),e.keystrokes.set(De,(n,o)=>{o(),e.commands.get("link").isEnabled&&this._showUI(!0)})}_enableUserBalloonInteractions(){this.editor.keystrokes.set("Tab",(e,i)=>{this._areActionsVisible&&!this.actionsView.focusTracker.isFocused&&(this.actionsView.focus(),i())},{priority:"high"}),this.editor.keystrokes.set("Esc",(e,i)=>{this._isUIVisible&&(this._hideUI(),i())}),qe({emitter:this.formView,activator:()=>this._isUIInPanel,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideUI()})}_addActionsView(){this.actionsView||this._createViews(),!this._areActionsInPanel&&this._balloon.add({view:this.actionsView,position:this._getBalloonPositionData()})}_addFormView(){if(this.formView||this._createViews(),this._isFormInPanel)return;const i=this.editor.commands.get("link");this.formView.disableCssTransitions(),this.formView.resetFormStatus(),this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this.formView.urlInputView.fieldView.value=i.value||"",this._balloon.visibleView===this.formView&&this.formView.urlInputView.fieldView.select(),this.formView.enableCssTransitions()}_closeFormView(){const e=this.editor.commands.get("link");e.restoreManualDecoratorStates(),e.value!==void 0?this._removeFormView():this._hideUI()}_removeFormView(){this._isFormInPanel&&(this.formView.saveButtonView.focus(),this.formView.urlInputView.fieldView.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus(),this._hideFakeVisualSelection())}_showUI(e=!1){this.formView||this._createViews(),this._getSelectedLinkElement()?(this._areActionsVisible?this._addFormView():this._addActionsView(),e&&this._balloon.showStack("main")):(this._showFakeVisualSelection(),this._addActionsView(),e&&this._balloon.showStack("main"),this._addFormView()),this._startUpdatingUI()}_hideUI(){if(!this._isUIInPanel)return;const e=this.editor;this.stopListening(e.ui,"update"),this.stopListening(this._balloon,"change:visibleView"),e.editing.view.focus(),this._removeFormView(),this._balloon.remove(this.actionsView),this._hideFakeVisualSelection()}_startUpdatingUI(){const e=this.editor,i=e.editing.view.document;let n=this._getSelectedLinkElement(),o=l();const r=()=>{const a=this._getSelectedLinkElement(),c=l();n&&!a||!n&&c!==o?this._hideUI():this._isUIVisible&&this._balloon.updatePosition(this._getBalloonPositionData()),n=a,o=c};function l(){return i.selection.focus.getAncestors().reverse().find(a=>a.is("element"))}this.listenTo(e.ui,"update",r),this.listenTo(this._balloon,"change:visibleView",r)}get _isFormInPanel(){return!!this.formView&&this._balloon.hasView(this.formView)}get _areActionsInPanel(){return!!this.actionsView&&this._balloon.hasView(this.actionsView)}get _areActionsVisible(){return!!this.actionsView&&this._balloon.visibleView===this.actionsView}get _isUIInPanel(){return this._isFormInPanel||this._areActionsInPanel}get _isUIVisible(){const e=this._balloon.visibleView;return!!this.formView&&e==this.formView||this._areActionsVisible}_getBalloonPositionData(){const e=this.editor.editing.view,i=this.editor.model,n=e.document;let o;if(i.markers.has(H)){const r=Array.from(this.editor.editing.mapper.markerNameToElements(H)),l=e.createRange(e.createPositionBefore(r[0]),e.createPositionAfter(r[r.length-1]));o=e.domConverter.viewRangeToDom(l)}else o=()=>{const r=this._getSelectedLinkElement();return r?e.domConverter.mapViewToDom(r):e.domConverter.viewRangeToDom(n.selection.getFirstRange())};return{target:o}}_getSelectedLinkElement(){const e=this.editor.editing.view,i=e.document.selection,n=i.getSelectedElement();if(i.isCollapsed||n&&bi(n))return zt(i.getFirstPosition());{const o=i.getFirstRange().getTrimmed(),r=zt(o.start),l=zt(o.end);return!r||r!=l?null:e.createRangeIn(r).getTrimmed().isEqual(o)?r:null}}_showFakeVisualSelection(){const e=this.editor.model;e.change(i=>{const n=e.document.selection.getFirstRange();if(e.markers.has(H))i.updateMarker(H,{range:n});else if(n.start.isAtEnd){const o=n.start.getLastMatchingPosition(({item:r})=>!e.schema.isContent(r),{boundaries:n});i.addMarker(H,{usingOperation:!1,affectsData:!1,range:i.createRange(o,n.end)})}else i.addMarker(H,{usingOperation:!1,affectsData:!1,range:n})})}_hideFakeVisualSelection(){const e=this.editor.model;e.markers.has(H)&&e.change(i=>{i.removeMarker(H)})}}function zt(s){return s.getAncestors().find(t=>Hd(t))||null}function nm(s){const t=s.t,e=s.config.get("link.allowCreatingEmptyLinks");return[i=>{if(!e&&!i.url.length)return t("Link URL must not be empty.")}]}const om=4,Cs=new RegExp("(^|\\s)(((?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(((?!www\\.)|(www\\.))(?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.)+(?:[a-z\\u00a1-\\uffff]{2,63})))(?::\\d{2,5})?(?:[/?#]\\S*)?)|((www.|(\\S+@))((?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.))+(?:[a-z\\u00a1-\\uffff]{2,63})))$","i"),sm=2;class vs extends w{static get requires(){return[di,St]}static get pluginName(){return"AutoLink"}static get isOfficialPlugin(){return!0}init(){const e=this.editor.model.document.selection;e.on("change:range",()=>{this.isEnabled=!e.anchor.parent.is("element","codeBlock")}),this._enableTypingHandling()}afterInit(){this._enableEnterHandling(),this._enableShiftEnterHandling(),this._enablePasteLinking()}_expandLinkRange(t,e){return e.textNode&&e.textNode.hasAttribute("linkHref")?vi(e,"linkHref",e.textNode.getAttribute("linkHref"),t):null}_selectEntireLinks(t,e){const n=this.editor.model,o=n.document.selection,r=o.getFirstPosition(),l=o.getLastPosition();let a=e.getJoined(this._expandLinkRange(n,r)||e);a&&(a=a.getJoined(this._expandLinkRange(n,l)||e)),a&&(a.start.isBefore(r)||a.end.isAfter(l))&&t.setSelection(a)}_enablePasteLinking(){const t=this.editor,e=t.model,i=e.document.selection,n=t.plugins.get("ClipboardPipeline"),o=t.commands.get("link");n.on("inputTransformation",(r,l)=>{if(!this.isEnabled||!o.isEnabled||i.isCollapsed||l.method!=="paste"||i.rangeCount>1)return;const a=i.getFirstRange(),c=l.dataTransfer.getData("text/plain");if(!c)return;const u=c.match(Cs);u&&u[2]===c&&(e.change(d=>{this._selectEntireLinks(d,a),o.execute(c)}),r.stop())},{priority:"high"})}_enableTypingHandling(){const t=this.editor,e=new Vr(t.model,i=>{if(!rm(i))return;const n=An(i.substr(0,i.length-1));if(n)return{url:n}});e.on("matched:data",(i,n)=>{const{batch:o,range:r,url:l}=n;if(!o.isTyping)return;const a=r.end.getShiftedBy(-1),c=a.getShiftedBy(-l.length),u=t.model.createRange(c,a);this._applyAutoLink(l,u)}),e.bind("isEnabled").to(this)}_enableEnterHandling(){const t=this.editor,e=t.model,i=t.commands.get("enter");i&&i.on("execute",()=>{const n=e.document.selection.getFirstPosition();if(!n.parent.previousSibling)return;const o=e.createRangeIn(n.parent.previousSibling);this._checkAndApplyAutoLinkOnRange(o)})}_enableShiftEnterHandling(){const t=this.editor,e=t.model,i=t.commands.get("shiftEnter");i&&i.on("execute",()=>{const n=e.document.selection.getFirstPosition(),o=e.createRange(e.createPositionAt(n.parent,0),n.getShiftedBy(-1));this._checkAndApplyAutoLinkOnRange(o)})}_checkAndApplyAutoLinkOnRange(t){const e=this.editor.model,{text:i,range:n}=Pr(t,e),o=An(i);if(o){const r=e.createRange(n.end.getShiftedBy(-o.length),n.end);this._applyAutoLink(o,r)}}_applyAutoLink(t,e){const i=this.editor.model,n=this.editor.config.get("link.defaultProtocol"),o=Oi(t,n);!this.isEnabled||!lm(e,i)||!ps(o)||am(e)||this._persistAutoLink(o,e)}_persistAutoLink(t,e){const i=this.editor.model,n=this.editor.plugins.get("Delete");i.enqueueChange(o=>{o.setAttribute("linkHref",t,e),i.enqueueChange(()=>{n.requestUndoOnBackspace()})})}}function rm(s){return s.length>om&&s[s.length-1]===" "&&s[s.length-2]!==" "}function An(s){const t=Cs.exec(s);return t?t[sm]:null}function lm(s,t){return t.schema.checkAttributeInSelection(t.createSelection(s),"linkHref")}function am(s){const t=s.start.nodeAfter;return!!t&&t.hasAttribute("linkHref")}class cm extends w{static get requires(){return[St,ws,vs]}static get pluginName(){return"Link"}static get isOfficialPlugin(){return!0}}class um extends w{static get requires(){return["ImageEditing","ImageUtils",St]}static get pluginName(){return"LinkImageEditing"}static get isOfficialPlugin(){return!0}afterInit(){const t=this.editor,e=t.model.schema;t.plugins.has("ImageBlockEditing")&&e.extend("imageBlock",{allowAttributes:["linkHref"]}),t.conversion.for("upcast").add(dm(t)),t.conversion.for("downcast").add(mm(t)),this._enableAutomaticDecorators(),this._enableManualDecorators()}_enableAutomaticDecorators(){const t=this.editor,i=t.commands.get("link").automaticDecorators;i.length&&t.conversion.for("downcast").add(i.getDispatcherForLinkedImage())}_enableManualDecorators(){const t=this.editor,e=t.commands.get("link");for(const i of e.manualDecorators)t.plugins.has("ImageBlockEditing")&&t.model.schema.extend("imageBlock",{allowAttributes:i.id}),t.plugins.has("ImageInlineEditing")&&t.model.schema.extend("imageInline",{allowAttributes:i.id}),t.conversion.for("downcast").add(gm(i)),t.conversion.for("upcast").add(hm(t,i))}}function dm(s){const t=s.plugins.has("ImageInlineEditing"),e=s.plugins.get("ImageUtils");return i=>{i.on("element:a",(n,o,r)=>{const l=o.viewItem,a=e.findViewImgElement(l);if(!a)return;const c=a.findAncestor(g=>e.isBlockImageView(g));if(t&&!c)return;const u={attributes:["href"]};if(!r.consumable.consume(l,u))return;const d=l.getAttribute("href");if(!d)return;let m=o.modelCursor.parent;if(!m.is("element","imageBlock")){const g=r.convertItem(a,o.modelCursor);o.modelRange=g.modelRange,o.modelCursor=g.modelCursor,m=o.modelCursor.nodeBefore}m&&m.is("element","imageBlock")&&r.writer.setAttribute("linkHref",d,m)},{priority:"high"})}}function mm(s){const t=s.plugins.get("ImageUtils");return e=>{e.on("attribute:linkHref:imageBlock",(i,n,o)=>{if(!o.consumable.consume(n.item,i.name))return;const r=o.mapper.toViewElement(n.item),l=o.writer,a=Array.from(r.getChildren()).find(d=>d.is("element","a")),c=t.findViewImgElement(r),u=c.parent.is("element","picture")?c.parent:c;if(a)n.attributeNewValue?l.setAttribute("href",n.attributeNewValue,a):(l.move(l.createRangeOn(u),l.createPositionAt(r,0)),l.remove(a));else{const d=l.createContainerElement("a",{href:n.attributeNewValue});l.insert(l.createPositionAt(r,0),d),l.move(l.createRangeOn(u),l.createPositionAt(d,0))}},{priority:"high"})}}function gm(s){return t=>{t.on(`attribute:${s.id}:imageBlock`,(e,i,n)=>{const o=n.mapper.toViewElement(i.item),r=Array.from(o.getChildren()).find(l=>l.is("element","a"));if(r){for(const[l,a]of _i(s.attributes))n.writer.setAttribute(l,a,r);s.classes&&n.writer.addClass(s.classes,r);for(const l in s.styles)n.writer.setStyle(l,s.styles[l],r)}})}}function hm(s,t){const e=s.plugins.has("ImageInlineEditing"),i=s.plugins.get("ImageUtils");return n=>{n.on("element:a",(o,r,l)=>{const a=r.viewItem,c=i.findViewImgElement(a);if(!c)return;const u=c.findAncestor(f=>i.isBlockImageView(f));if(e&&!u)return;const m=new Q(t._createPattern()).match(a);if(!m||!l.consumable.consume(a,m.match))return;const g=r.modelCursor.nodeBefore||r.modelCursor.parent;l.writer.setAttribute(t.id,!0,g)},{priority:"high"})}}class fm extends w{static get requires(){return[St,ws,"ImageBlockEditing"]}static get pluginName(){return"LinkImageUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.editing.view.document;this.listenTo(e,"click",(i,n)=>{this._isSelectedLinkedImage(t.model.document.selection)&&(n.preventDefault(),i.stop())},{priority:"high"}),this._createToolbarLinkImageButton()}_createToolbarLinkImageButton(){const t=this.editor,e=t.t;t.ui.componentFactory.add("linkImage",i=>{const n=new I(i),o=t.plugins.get("LinkUI"),r=t.commands.get("link");return n.set({isEnabled:!0,label:e("Link image"),icon:bs,keystroke:De,tooltip:!0,isToggleable:!0}),n.bind("isEnabled").to(r,"isEnabled"),n.bind("isOn").to(r,"value",l=>!!l),this.listenTo(n,"execute",()=>{this._isSelectedLinkedImage(t.model.document.selection)?o._addActionsView():o._showUI(!0)}),n})}_isSelectedLinkedImage(t){const e=t.getSelectedElement();return this.editor.plugins.get("ImageUtils").isImage(e)&&e.hasAttribute("linkHref")}}class pm extends w{static get requires(){return[um,fm]}static get pluginName(){return"LinkImage"}static get isOfficialPlugin(){return!0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function bm(s){const t=parseFloat(s);return s.endsWith("pt")?Ee(t*96/72):s.endsWith("pc")?Ee(t*12*96/72):s.endsWith("in")?Ee(t*96):s.endsWith("cm")?Ee(t*96/2.54):s.endsWith("mm")?Ee(t/10*96/2.54):s}function Tn(s){return s!==void 0&&s.endsWith("px")}function Ee(s){return s.toFixed(2).replace(/\.?0+$/,"")+"px"}function wm(s,t,e){if(!s.childCount)return;const i=new $(s.document),n=vm(s,i);if(!n.length)return;const o={},r=[];for(const l of n)if(l.indent!==void 0){_m(l)||(r.length=0);const a=`${l.id}:${l.indent}`,c=Math.min(l.indent-1,r.length);if(c<r.length&&r[c].id!==l.id&&(r.length=c),c<r.length-1)r.length=c+1;else{const d=km(l,t);if(c>r.length-1||r[c].listElement.name!=d.type){c==0&&d.type=="ol"&&l.id!==void 0&&o[a]&&(d.startIndex=o[a]);const m=Tm(d,i,e);if(Tn(l.marginLeft)&&(c==0||Tn(r[c-1].marginLeft))){let g=l.marginLeft;c>0&&(g=Ee(parseFloat(g)-parseFloat(r[c-1].marginLeft))),i.setStyle("padding-left",g,m)}if(r.length==0){const g=l.element.parent,f=g.getChildIndex(l.element)+1;i.insertChild(f,m,g)}else{const g=r[c-1].listItemElements;i.appendChild(m,g[g.length-1])}r[c]={...l,listElement:m,listItemElements:[]},c==0&&l.id!==void 0&&(o[a]=d.startIndex||1)}}const u=l.element.name=="li"?l.element:i.createElement("li");i.appendChild(u,r[c].listElement),r[c].listItemElements.push(u),c==0&&l.id!==void 0&&o[a]++,l.element!=u&&i.appendChild(l.element,u),Sm(l.element,i),i.removeStyle("text-indent",l.element),i.removeStyle("margin-left",l.element)}else{const a=r.find(c=>c.marginLeft==l.marginLeft);if(a){const c=a.listItemElements;i.appendChild(l.element,c[c.length-1]),i.removeStyle("margin-left",l.element)}else r.length=0}}function Cm(s,t){for(const e of t.createRangeIn(s)){const i=e.item;if(i.is("element","li")){const n=i.getChild(0);n&&n.is("element","p")&&t.unwrapElement(n)}}}function vm(s,t){const e=t.createRangeIn(s),i=[],n=new Set;for(const o of e.getItems()){if(!o.is("element")||!o.name.match(/^(p|h\d+|li|div)$/))continue;let r=xm(o);if(r!==void 0&&parseFloat(r)==0&&!Array.from(o.getClassNames()).find(l=>l.startsWith("MsoList"))&&(r=void 0),o.hasStyle("mso-list")||r!==void 0&&n.has(r)){const l=Em(o);i.push({element:o,id:l.id,order:l.order,indent:l.indent,marginLeft:r}),r!==void 0&&n.add(r)}else n.clear()}return i}function _m(s){const t=s.element.previousSibling;return En(t||s.element.parent)}function En(s){return s.is("element","ol")||s.is("element","ul")}function km(s,t){const e=new RegExp(`@list l${s.id}:level${s.indent}\\s*({[^}]*)`,"gi"),i=/mso-level-number-format:([^;]{0,100});/gi,n=/mso-level-start-at:\s{0,100}([0-9]{0,10})\s{0,100};/gi,o=new RegExp(`@list\\s+l${s.id}:level\\d\\s*{[^{]*mso-level-text:"%\\d\\\\.`,"gi"),r=new RegExp(`@list l${s.id}:level\\d\\s*{[^{]*mso-level-number-format:`,"gi"),l=o.exec(t),a=r.exec(t),c=l&&!a,u=e.exec(t);let d="decimal",m="ol",g=null;if(u&&u[1]){const f=i.exec(u[1]);if(f&&f[1]&&(d=f[1].trim(),m=d!=="bullet"&&d!=="image"?"ol":"ul"),d==="bullet"){const p=ym(s.element);p&&(d=p)}else{const p=n.exec(u[1]);p&&p[1]&&(g=parseInt(p[1]))}c&&(m="ol")}return{type:m,startIndex:g,style:Am(d),isLegalStyleList:c}}function ym(s){if(s.name=="li"&&s.parent.name=="ul"&&s.parent.hasAttribute("type"))return s.parent.getAttribute("type");const t=Im(s);if(!t)return null;const e=t._data;return e==="o"?"circle":e==="·"?"disc":e==="§"?"square":null}function Im(s){if(s.getChild(0).is("$text"))return null;for(const t of s.getChildren()){if(!t.is("element","span"))continue;const e=t.getChild(0);if(e)return e.is("$text")?e:e.getChild(0)}/* istanbul ignore next -- @preserve */return null}function Am(s){if(s.startsWith("arabic-leading-zero"))return"decimal-leading-zero";switch(s){case"alpha-upper":return"upper-alpha";case"alpha-lower":return"lower-alpha";case"roman-upper":return"upper-roman";case"roman-lower":return"lower-roman";case"circle":case"disc":case"square":return s;default:return null}}function Tm(s,t,e){const i=t.createElement(s.type);return s.style&&t.setStyle("list-style-type",s.style,i),s.startIndex&&s.startIndex>1&&t.setAttribute("start",s.startIndex,i),s.isLegalStyleList&&e&&t.addClass("legal-list",i),i}function Em(s){const t=s.getStyle("mso-list");if(t===void 0)return{};const e=t.match(/(^|\s{1,100})l(\d+)/i),i=t.match(/\s{0,100}lfo(\d+)/i),n=t.match(/\s{0,100}level(\d+)/i);return e&&i&&n?{id:e[2],order:i[1],indent:parseInt(n[1])}:{indent:1}}function Sm(s,t){const e=new Q({name:"span",styles:{"mso-list":"Ignore"}}),i=t.createRangeIn(s);for(const n of i)n.type==="elementStart"&&e.match(n.item)&&t.remove(n.item)}function xm(s){const t=s.getStyle("margin-left");return t===void 0||t.endsWith("px")?t:bm(t)}function Rm(s,t){if(!s.childCount)return;const e=new $(s.document),i=Pm(s,e);Bm(i,s,e),Om(i,s,e),Lm(s,e);const n=Fm(s,e);n.length&&Dm(n,Um(t),e)}function Vm(s){return btoa(s.match(/\w{2}/g).map(t=>String.fromCharCode(parseInt(t,16))).join(""))}function Pm(s,t){const e=t.createRangeIn(s),i=new Q({name:/v:(.+)/}),n=[];for(const o of e){if(o.type!="elementStart")continue;const r=o.item,l=r.previousSibling,a=l&&l.is("element")?l.name:null,c=["Chart"],u=i.match(r),d=r.getAttribute("o:gfxdata"),m=a==="v:shapetype",g=d&&c.some(f=>r.getAttribute("id").includes(f));u&&d&&!m&&!g&&n.push(o.item.getAttribute("id"))}return n}function Bm(s,t,e){const i=e.createRangeIn(t),n=new Q({name:"img"}),o=[];for(const r of i)if(r.item.is("element")&&n.match(r.item)){const l=r.item,a=l.getAttribute("v:shapes")?l.getAttribute("v:shapes").split(" "):[];a.length&&a.every(c=>s.indexOf(c)>-1)?o.push(l):l.getAttribute("src")||o.push(l)}for(const r of o)e.remove(r)}function Lm(s,t){const e=t.createRangeIn(s),i=new Q({name:/v:(.+)/}),n=[];for(const o of e)o.type=="elementStart"&&i.match(o.item)&&n.push(o.item);for(const o of n)t.remove(o)}function Om(s,t,e){const i=e.createRangeIn(t),n=[];for(const l of i)if(l.type=="elementStart"&&l.item.is("element","v:shape")){const a=l.item.getAttribute("id");if(s.includes(a))continue;o(l.item.parent.getChildren(),a)||n.push(l.item)}for(const l of n){const a={src:r(l)};l.hasAttribute("alt")&&(a.alt=l.getAttribute("alt"));const c=e.createElement("img",a);e.insertChild(l.index+1,c,l.parent)}function o(l,a){for(const c of l){/* istanbul ignore else -- @preserve */if(c.is("element")&&(c.name=="img"&&c.getAttribute("v:shapes")==a||o(c.getChildren(),a)))return!0}return!1}function r(l){for(const a of l.getChildren()){/* istanbul ignore else -- @preserve */if(a.is("element")&&a.getAttribute("src"))return a.getAttribute("src")}}}function Fm(s,t){const e=t.createRangeIn(s),i=new Q({name:"img"}),n=[];for(const o of e)o.item.is("element")&&i.match(o.item)&&o.item.getAttribute("src").startsWith("file://")&&n.push(o.item);return n}function Um(s){if(!s)return[];const t=/{\\pict[\s\S]+?\\bliptag-?\d+(\\blipupi-?\d+)?({\\\*\\blipuid\s?[\da-fA-F]+)?[\s}]*?/,e=new RegExp("(?:("+t.source+"))([\\da-fA-F\\s]+)\\}","g"),i=s.match(e),n=[];if(i)for(const o of i){let r=!1;o.includes("\\pngblip")?r="image/png":o.includes("\\jpegblip")&&(r="image/jpeg"),r&&n.push({hex:o.replace(t,"").replace(/[^\da-fA-F]/g,""),type:r})}return n}function Dm(s,t,e){if(s.length===t.length)for(let i=0;i<s.length;i++){const n=`data:${t[i].type};base64,${Vm(t[i].hex)}`;e.setAttribute("src",n,s[i])}}function Nm(s){const t=[],e=new $(s.document);for(const{item:i}of e.createRangeIn(s))if(i.is("element")){for(const n of i.getClassNames())/\bmso/gi.exec(n)&&e.removeClass(n,i);for(const n of i.getStyleNames())/\bmso/gi.exec(n)&&e.removeStyle(n,i);(i.is("element","w:sdt")||i.is("element","w:sdtpr")&&i.isEmpty||i.is("element","o:p")&&i.isEmpty)&&t.push(i)}for(const i of t){const n=i.parent,o=n.getChildIndex(i);e.insertChild(o,i.getChildren(),n),e.remove(i)}}const Mm=/<meta\s*name="?generator"?\s*content="?microsoft\s*word\s*\d+"?\/?>/i,Hm=/xmlns:o="urn:schemas-microsoft-com/i;class zm{constructor(t,e=!1){h(this,"document");h(this,"hasMultiLevelListPlugin");this.document=t,this.hasMultiLevelListPlugin=e}isActive(t){return Mm.test(t)||Hm.test(t)}execute(t){const{body:e,stylesString:i}=t._parsedData;wm(e,i,this.hasMultiLevelListPlugin),Rm(e,t.dataTransfer.getData("text/rtf")),Nm(e),t.content=e}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Wm(s,t){for(const e of s.getChildren())if(e.is("element","b")&&e.getStyle("font-weight")==="normal"){const i=s.getChildIndex(e);t.remove(e),t.insertChild(i,e.getChildren(),s)}}function $m(s,t){const e=new go(t.document.stylesProcessor),i=new ho(e,{renderingMode:"data"}),n=i.blockElements,o=i.inlineObjectElements,r=[];for(const l of t.createRangeIn(s)){const a=l.item;if(a.is("element","br")){const c=Sn(a,"forward",t,{blockElements:n,inlineObjectElements:o}),u=Sn(a,"backward",t,{blockElements:n,inlineObjectElements:o}),d=xn(c,n);(xn(u,n)||d)&&r.push(a)}}for(const l of r)l.hasClass("Apple-interchange-newline")?t.remove(l):t.replace(l,t.createElement("p"))}function Sn(s,t,e,{blockElements:i,inlineObjectElements:n}){let o=e.createPositionAt(s,t=="forward"?"after":"before");return o=o.getLastMatchingPosition(({item:r})=>r.is("element")&&!i.includes(r.name)&&!n.includes(r.name),{direction:t}),t=="forward"?o.nodeAfter:o.nodeBefore}function xn(s,t){return!!s&&s.is("element")&&t.includes(s.name)}const jm=/id=("|')docs-internal-guid-[-0-9a-f]+("|')/i;class qm{constructor(t){h(this,"document");this.document=t}isActive(t){return jm.test(t)}execute(t){const e=new $(this.document),{body:i}=t._parsedData;Wm(i,e),Cm(i,e),$m(i,e),t.content=i}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Gm(s,t){for(const e of s.getChildren())e.is("element","table")&&e.hasAttribute("xmlns")&&t.removeAttribute("xmlns",e)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Km(s,t){for(const e of s.getChildren())if(e.is("element","google-sheets-html-origin")){const i=s.getChildIndex(e);t.remove(e),t.insertChild(i,e.getChildren(),s)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Zm(s,t){for(const e of s.getChildren())e.is("element","table")&&e.getStyle("width")==="0px"&&t.removeStyle("width",e)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Jm(s,t){for(const e of Array.from(s.getChildren()))e.is("element","style")&&t.remove(e)}const Xm=/<google-sheets-html-origin/i;class Ym{constructor(t){h(this,"document");this.document=t}isActive(t){return Xm.test(t)}execute(t){const e=new $(this.document),{body:i}=t._parsedData;Km(i,e),Gm(i,e),Zm(i,e),Jm(i,e),t.content=i}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Qm(s){return Rn(Rn(s)).replace(/(<span\s+style=['"]mso-spacerun:yes['"]>[^\S\r\n]*?)[\r\n]+([^\S\r\n]*<\/span>)/g,"$1$2").replace(/<span\s+style=['"]mso-spacerun:yes['"]><\/span>/g,"").replace(/(<span\s+style=['"]letter-spacing:[^'"]+?['"]>)[\r\n]+(<\/span>)/g,"$1 $2").replace(/ <\//g," </").replace(/ <o:p><\/o:p>/g," <o:p></o:p>").replace(/<o:p>(&nbsp;|\u00A0)<\/o:p>/g,"").replace(/>([^\S\r\n]*[\r\n]\s*)</g,"><")}function eg(s){s.querySelectorAll("span[style*=spacerun]").forEach(t=>{const e=t,i=e.innerText.length||0;e.innerText=Array(i+1).join("  ").substr(0,i)})}function Rn(s){return s.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(t,e)=>e.length===1?" ":Array(e.length+1).join("  ").substr(0,e.length))}function tg(s,t){const e=new DOMParser;s=s.replace(/<!--\[if gte vml 1]>/g,""),s=s.replace(/<o:SmartTagType(?:\s+[^\s>=]+(?:="[^"]*")?)*\s*\/?>/gi,"");const i=Qm(og(s)),n=e.parseFromString(i,"text/html");eg(n);const o=n.body.innerHTML,r=ig(n,t),l=ng(n);return{body:r,bodyString:o,styles:l.styles,stylesString:l.stylesString}}function ig(s,t){const e=new go(t),i=new ho(e,{renderingMode:"data"}),n=s.createDocumentFragment(),o=s.body.childNodes;for(;o.length>0;)n.appendChild(o[0]);return i.domToView(n,{skipComments:!0})}function ng(s){const t=[],e=[],i=Array.from(s.getElementsByTagName("style"));for(const n of i)n.sheet&&n.sheet.cssRules&&n.sheet.cssRules.length&&(t.push(n.sheet),e.push(n.innerHTML));return{styles:t,stylesString:e.join(" ")}}function og(s){const t="</body>",e="</html>",i=s.indexOf(t);if(i<0)return s;const n=s.indexOf(e,i+t.length);return s.substring(0,i+t.length)+(n>=0?s.substring(n):"")}class sg extends w{static get pluginName(){return"PasteFromOffice"}static get isOfficialPlugin(){return!0}static get requires(){return[he]}init(){const t=this.editor,e=t.plugins.get("ClipboardPipeline"),i=t.editing.view.document,n=[],o=this.editor.plugins.has("MultiLevelList");n.push(new zm(i,o)),n.push(new qm(i)),n.push(new Ym(i)),e.on("inputTransformation",(r,l)=>{if(l._isTransformedWithPasteFromOffice||t.model.document.selection.getFirstPosition().parent.is("element","codeBlock"))return;const c=l.dataTransfer.getData("text/html"),u=n.find(d=>d.isActive(c));u&&(l._parsedData||(l._parsedData=tg(c,i.stylesProcessor)),u.execute(l),l._isTransformedWithPasteFromOffice=!0)},{priority:"high"})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rg extends y{constructor(t){super(t),this.affectsData=!1,this.value=!1}execute(){const t="ck-show-blocks",e=this.editor.editing.view;e.change(i=>{for(const n of e.document.roots)n.hasClass(t)?(i.removeClass(t,n),this.value=!1):(i.addClass(t,n),this.value=!0)})}}class lg extends w{static get pluginName(){return"ShowBlocksEditing"}static get isOfficialPlugin(){return!0}init(){const{editor:t}=this;t.commands.add("showBlocks",new rg(t))}}var ag='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m6.395 9.196 2.545-.007V6.498a.598.598 0 0 1 .598-.598h.299a.598.598 0 0 1 .598.598v6.877a.598.598 0 0 1-.598.598h-.299a.598.598 0 0 1-.598-.598v-2.691l-2.545.007v2.691a.598.598 0 0 1-.598.598h-.299a.598.598 0 0 1-.598-.598V6.505a.598.598 0 0 1 .598-.598h.299a.598.598 0 0 1 .598.598v2.691Z"/><path d="M15.094 13.417V6.462a.562.562 0 0 0-.562-.562h-.782a1 1 0 0 0-.39.08l-1.017.43a.562.562 0 0 0-.343.517v.197c0 .4.406.67.775.519l.819-.337v6.111c0 .31.251.562.561.562h.377c.31 0 .562-.251.562-.562Z"/><path d="M0 15.417v1.5h1.5v-1.5H0Z"/><path d="M18.5 15.417v1.5H20v-1.5h-1.5Z"/><path d="M18.5 12.333v1.5H20v-1.5h-1.5Z"/><path d="M18.5 9.25v1.5H20v-1.5h-1.5Z"/><path d="M18.5 6.167v1.5H20v-1.5h-1.5Z"/><path d="M0 18.5v.5a1 1 0 0 0 1 1h.5v-1.5H0Z"/><path d="M3.083 18.5V20h1.5v-1.5h-1.5Z"/><path d="M6.167 18.5V20h1.5v-1.5h-1.5Z"/><path d="M9.25 18.5V20h1.5v-1.5h-1.5Z"/><path d="M12.333 18.5V20h1.5v-1.5h-1.5Z"/><path d="M15.417 18.5V20h1.5v-1.5h-1.5Z"/><path d="M18.5 18.5V20h.5a1 1 0 0 0 1-1v-.5h-1.5Z"/><path clip-rule="evenodd" d="M0 1a1 1 0 0 1 1-1h18a1 1 0 0 1 1 1v3.583h-1.5V1.5h-17v12.333H0V1Z"/></svg>';class cg extends w{static get pluginName(){return"ShowBlocksUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor;t.ui.componentFactory.add("showBlocks",()=>{const e=this._createButton(I);return e.set({tooltip:!0,icon:ag}),e}),t.ui.componentFactory.add("menuBar:showBlocks",()=>this._createButton(D))}_createButton(t){const e=this.editor,i=e.locale,n=e.commands.get("showBlocks"),o=new t(i),r=i.t;return o.set({label:r("Show blocks"),isToggleable:!0,role:"menuitemcheckbox"}),o.bind("isEnabled").to(n),o.bind("isOn").to(n,"value",n,"isEnabled",(l,a)=>l&&a),this.listenTo(o,"execute",()=>{e.execute("showBlocks"),e.editing.view.focus()}),o}}class ug extends w{static get pluginName(){return"ShowBlocks"}static get isOfficialPlugin(){return!0}static get requires(){return[lg,cg]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function dg(s){const t=[{name:"address",isVoid:!1},{name:"article",isVoid:!1},{name:"aside",isVoid:!1},{name:"blockquote",isVoid:!1},{name:"details",isVoid:!1},{name:"dialog",isVoid:!1},{name:"dd",isVoid:!1},{name:"div",isVoid:!1},{name:"dl",isVoid:!1},{name:"dt",isVoid:!1},{name:"fieldset",isVoid:!1},{name:"figcaption",isVoid:!1},{name:"figure",isVoid:!1},{name:"footer",isVoid:!1},{name:"form",isVoid:!1},{name:"h1",isVoid:!1},{name:"h2",isVoid:!1},{name:"h3",isVoid:!1},{name:"h4",isVoid:!1},{name:"h5",isVoid:!1},{name:"h6",isVoid:!1},{name:"header",isVoid:!1},{name:"hgroup",isVoid:!1},{name:"hr",isVoid:!0},{name:"li",isVoid:!1},{name:"main",isVoid:!1},{name:"nav",isVoid:!1},{name:"ol",isVoid:!1},{name:"p",isVoid:!1},{name:"section",isVoid:!1},{name:"table",isVoid:!1},{name:"tbody",isVoid:!1},{name:"td",isVoid:!1},{name:"th",isVoid:!1},{name:"thead",isVoid:!1},{name:"tr",isVoid:!1},{name:"ul",isVoid:!1}],e=t.map(r=>r.name).join("|"),i=s.replace(new RegExp(`</?(${e})( .*?)?>`,"g"),`
$&
`).replace(/<br[^>]*>/g,`$&
`).split(`
`);let n=0,o=!1;return i.filter(r=>r.length).map(r=>(o=hg(r,o),mg(r,t)?Wt(r,n++):gg(r,t)?Wt(r,--n):o==="middle"||o==="last"?r:Wt(r,n))).join(`
`)}function mg(s,t){return t.some(e=>!(e.isVoid||!new RegExp(`<${e.name}( .*?)?>`).test(s)))}function gg(s,t){return t.some(e=>new RegExp(`</${e.name}>`).test(s))}function Wt(s,t,e="    "){return`${e.repeat(Math.max(0,t))}${s}`}function hg(s,t){return new RegExp("<pre( .*?)?>").test(s)?"first":new RegExp("</pre>").test(s)?"last":t==="first"||t==="middle"?"middle":!1}var fg='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.5 0 5 4.5v15.003h-16V0h11zM3 1.5v3.25l-1.497 1-.003 8 1.5 1v3.254L7.685 18l-.001 1.504H17.5V8.002L16 9.428l-.004-4.22-4.222-3.692L3 1.5z"/><path d="M4.06 6.64a.75.75 0 0 1 .958 1.15l-.085.07L2.29 9.75l2.646 1.89c.302.216.4.62.232.951l-.058.095a.75.75 0 0 1-.951.232l-.095-.058-3.5-2.5V9.14l3.496-2.5zm4.194 6.22a.75.75 0 0 1-.958-1.149l.085-.07 2.643-1.89-2.646-1.89a.75.75 0 0 1-.232-.952l.058-.095a.75.75 0 0 1 .95-.232l.096.058 3.5 2.5v1.22l-3.496 2.5zm7.644-.836 2.122 2.122-5.825 5.809-2.125-.005.003-2.116zm2.539-1.847 1.414 1.414a.5.5 0 0 1 0 .707l-1.06 1.06-2.122-2.12 1.061-1.061a.5.5 0 0 1 .707 0z"/></svg>';const Ye="SourceEditingMode";class pg extends w{constructor(e){super(e);h(this,"_elementReplacer");h(this,"_replacedRoots");h(this,"_dataFromRoots");this.set("isSourceEditingMode",!1),this._elementReplacer=new no,this._replacedRoots=new Map,this._dataFromRoots=new Map,e.config.define("sourceEditing.allowCollaborationFeatures",!1)}static get pluginName(){return"SourceEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[Re]}init(){this._checkCompatibility();const e=this.editor,i=e.locale.t;e.ui.componentFactory.add("sourceEditing",()=>{const n=this._createButton(I);return n.set({label:i("Source"),icon:fg,tooltip:!0,class:"ck-source-editing-button"}),n}),e.ui.componentFactory.add("menuBar:sourceEditing",()=>{const n=this._createButton(D);return n.set({label:i("Show source"),role:"menuitemcheckbox"}),n}),this._isAllowedToHandleSourceEditingMode()&&(this.on("change:isSourceEditingMode",(n,o,r)=>{r?(this._hideVisibleDialog(),this._showSourceEditing(),this._disableCommands()):(this._hideSourceEditing(),this._enableCommands())}),this.on("change:isEnabled",(n,o,r)=>this._handleReadOnlyMode(!r)),this.listenTo(e,"change:isReadOnly",(n,o,r)=>this._handleReadOnlyMode(r))),e.data.on("get",()=>{this.isSourceEditingMode&&this.updateEditorData()},{priority:"high"})}updateEditorData(){const e=this.editor,i={};for(const[n,o]of this._replacedRoots){const r=this._dataFromRoots.get(n),l=o.dataset.value;r!==l&&(i[n]=l,this._dataFromRoots.set(n,l))}Object.keys(i).length&&e.data.set(i,{batchType:{isUndoable:!0},suppressErrorInCollaboration:!0})}_checkCompatibility(){const e=this.editor,i=e.config.get("sourceEditing.allowCollaborationFeatures");if(!i&&e.plugins.has("RealTimeCollaborativeEditing"))throw new R("source-editing-incompatible-with-real-time-collaboration",null);!i&&["CommentsEditing","TrackChangesEditing","RevisionHistory"].some(o=>e.plugins.has(o))&&console.warn("You initialized the editor with the source editing feature and at least one of the collaboration features. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the collaboration features."),e.plugins.has("RestrictedEditingModeEditing")&&console.warn("You initialized the editor with the source editing feature and restricted editing feature. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the restricted editing feature.")}_showSourceEditing(){const e=this.editor,i=e.editing.view,n=e.model;n.change(o=>{o.setSelection(null),o.removeSelectionAttribute(n.document.selection.getAttributeKeys())});for(const[o,r]of i.domRoots){const l=bg(e.data.get({rootName:o})),a=le(r.ownerDocument,"textarea",{rows:"1","aria-label":"Source code editing area"}),c=le(r.ownerDocument,"div",{class:"ck-source-editing-area","data-value":l},[a]);a.value=l,a.setSelectionRange(0,0),a.addEventListener("input",()=>{c.dataset.value=a.value,e.ui.update()}),i.change(u=>{const d=i.document.getRoot(o);u.addClass("ck-hidden",d)}),e.ui.setEditableElement("sourceEditing:"+o,a),this._replacedRoots.set(o,c),this._elementReplacer.replace(r,c),this._dataFromRoots.set(o,l)}this._focusSourceEditing()}_hideSourceEditing(){const i=this.editor.editing.view;this.updateEditorData(),i.change(n=>{for(const[o]of this._replacedRoots)n.removeClass("ck-hidden",i.document.getRoot(o))}),this._elementReplacer.restore(),this._replacedRoots.clear(),this._dataFromRoots.clear(),i.focus()}_focusSourceEditing(){const e=this.editor,[i]=this._replacedRoots.values(),n=i.querySelector("textarea");e.editing.view.document.isFocused=!1,n.focus()}_disableCommands(){const e=this.editor;for(const i of e.commands.commands())i.forceDisabled(Ye);e.plugins.has("CommentsArchiveUI")&&e.plugins.get("CommentsArchiveUI").forceDisabled(Ye)}_enableCommands(){const e=this.editor;for(const i of e.commands.commands())i.clearForceDisabled(Ye);e.plugins.has("CommentsArchiveUI")&&e.plugins.get("CommentsArchiveUI").clearForceDisabled(Ye)}_handleReadOnlyMode(e){if(this.isSourceEditingMode)for(const[,i]of this._replacedRoots)i.querySelector("textarea").readOnly=e}_isAllowedToHandleSourceEditingMode(){const i=this.editor.ui.view.editable;return i&&!i.hasExternalElement}_hideVisibleDialog(){if(this.editor.plugins.has("Dialog")){const e=this.editor.plugins.get("Dialog");e.isOpen&&e.hide()}}_createButton(e){const i=this.editor,n=new e(i.locale);return n.set({withText:!0,isToggleable:!0}),n.bind("isOn").to(this,"isSourceEditingMode"),n.bind("isEnabled").to(this,"isEnabled",i,"isReadOnly",i.plugins.get(Re),"hasAny",(o,r,l)=>!(!o||r||l)),this.listenTo(n,"execute",()=>{this.isSourceEditingMode=!this.isSourceEditingMode}),n}}function bg(s){return wg(s)?dg(s):s}function wg(s){return s.startsWith("<")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Fi(s,t){const{modelAttribute:e,styleName:i,viewElement:n,defaultValue:o,reduceBoxSides:r=!1,shouldUpcast:l=()=>!0}=t;s.for("upcast").attributeToAttribute({view:{name:n,styles:{[i]:/[\s\S]+/}},model:{key:e,value:a=>{if(!l(a))return;const c=a.getNormalizedStyle(i),u=r?st(c):c;if(o!==u)return u}}})}function Qt(s,t,e,i){s.for("upcast").add(n=>n.on("element:"+t,(o,r,l)=>{if(!r.modelRange)return;const a=["border-top-width","border-top-color","border-top-style","border-bottom-width","border-bottom-color","border-bottom-style","border-right-width","border-right-color","border-right-style","border-left-width","border-left-color","border-left-style"].filter(g=>r.viewItem.hasStyle(g));if(!a.length)return;const c={styles:a};if(!l.consumable.test(r.viewItem,c))return;const u=[...r.modelRange.getItems({shallow:!0})].pop();l.consumable.consume(r.viewItem,c);const d={style:r.viewItem.getNormalizedStyle("border-style"),color:r.viewItem.getNormalizedStyle("border-color"),width:r.viewItem.getNormalizedStyle("border-width")},m={style:st(d.style),color:st(d.color),width:st(d.width)};m.style!==i.style&&l.writer.setAttribute(e.style,m.style,u),m.color!==i.color&&l.writer.setAttribute(e.color,m.color,u),m.width!==i.width&&l.writer.setAttribute(e.width,m.width,u)}))}function Ne(s,t){const{modelElement:e,modelAttribute:i,styleName:n}=t;s.for("downcast").attributeToAttribute({model:{name:e,key:i},view:o=>({key:"style",value:{[n]:o}})})}function ot(s,t){const{modelAttribute:e,styleName:i}=t;s.for("downcast").add(n=>n.on(`attribute:${e}:table`,(o,r,l)=>{const{item:a,attributeNewValue:c}=r,{mapper:u,writer:d}=l;if(!l.consumable.consume(r.item,o.name))return;const m=[...u.toViewElement(a).getChildren()].find(g=>g.is("element","table"));c?d.setStyle(i,c,m):d.removeStyle(i,m)}))}function st(s){if(!s)return;const t=["top","right","bottom","left"];if(!t.every(o=>s[o]))return s;const i=s.top;return t.every(o=>s[o]===i)?i:s}function E(s,t,e,i,n=1){t!=null&&n!==void 0&&n!==null&&t>n?i.setAttribute(s,t,e):i.removeAttribute(s,e)}function fe(s,t,e={}){const i=s.createElement("tableCell",e);return s.insertElement("paragraph",i),s.insert(i,t),i}function ei(s,t){const e=t.parent.parent,i=parseInt(e.getAttribute("headingColumns")||"0"),{column:n}=s.getCellLocation(t);return!!i&&n<i}function rt(s,t,e){const{modelAttribute:i}=e;s.extend("tableCell",{allowAttributes:[i]}),Fi(t,{viewElement:/^(td|th)$/,...e}),Ne(t,{modelElement:"tableCell",...e})}function ue(s){const t=s.getSelectedElement();return t&&t.is("element","table")?t:s.getFirstPosition().findAncestor("table")}function Cg(){return s=>{s.on("element:figure",(t,e,i)=>{if(!i.consumable.test(e.viewItem,{name:!0,classes:"table"}))return;const n=kg(e.viewItem);if(!n||!i.consumable.test(n,{name:!0}))return;i.consumable.consume(e.viewItem,{name:!0,classes:"table"});const o=i.convertItem(n,e.modelCursor),r=U(o.modelRange.getItems());if(!r){i.consumable.revert(e.viewItem,{name:!0,classes:"table"});return}i.convertChildren(e.viewItem,i.writer.createPositionAt(r,"end")),i.updateConversionResult(r,e)})}}function vg(){return s=>{s.on("element:table",(t,e,i)=>{const n=e.viewItem;if(!i.consumable.test(n,{name:!0}))return;const{rows:o,headingRows:r,headingColumns:l}=yg(n),a={};l&&(a.headingColumns=l),r&&(a.headingRows=r);const c=i.writer.createElement("table",a);if(i.safeInsert(c,e.modelCursor)){if(i.consumable.consume(n,{name:!0}),o.forEach(u=>i.convertItem(u,i.writer.createPositionAt(c,"end"))),i.convertChildren(n,i.writer.createPositionAt(c,"end")),c.isEmpty){const u=i.writer.createElement("tableRow");i.writer.insert(u,i.writer.createPositionAt(c,"end")),fe(i.writer,i.writer.createPositionAt(u,"end"))}i.updateConversionResult(c,e)}})}}function _g(){return s=>{s.on("element:tr",(t,e)=>{e.viewItem.isEmpty&&e.modelCursor.index==0&&t.stop()},{priority:"high"})}}function Vn(s){return t=>{t.on(`element:${s}`,(e,i,{writer:n})=>{if(!i.modelRange)return;const o=i.modelRange.start.nodeAfter,r=n.createPositionAt(o,0);if(i.viewItem.isEmpty){n.insertElement("paragraph",r);return}const l=Array.from(o.getChildren());if(l.every(a=>a.is("element","$marker"))){const a=n.createElement("paragraph");n.insert(a,n.createPositionAt(o,0));for(const c of l)n.move(n.createRangeOn(c),n.createPositionAt(a,"end"))}},{priority:"low"})}}function kg(s){for(const t of s.getChildren())if(t.is("element","table"))return t}function yg(s){let t=0,e;const i=[],n=[];let o;for(const r of Array.from(s.getChildren())){if(r.name!=="tbody"&&r.name!=="thead"&&r.name!=="tfoot")continue;r.name==="thead"&&!o&&(o=r);const l=Array.from(r.getChildren()).filter(a=>a.is("element","tr"));for(const a of l)if(o&&r===o||r.name==="tbody"&&Array.from(a.getChildren()).length&&Array.from(a.getChildren()).every(c=>c.is("element","th")))t++,i.push(a);else{n.push(a);const c=Ig(a);(!e||c<e)&&(e=c)}}return{headingRows:t,headingColumns:e||0,rows:[...i,...n]}}function Ig(s){let t=0,e=0;const i=Array.from(s.getChildren()).filter(n=>n.name==="th"||n.name==="td");for(;e<i.length&&i[e].name==="th";){const n=i[e],o=parseInt(n.getAttribute("colspan")||"1");t=t+o,e++}return t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class A{constructor(t,e={}){h(this,"_table");h(this,"_startRow");h(this,"_endRow");h(this,"_startColumn");h(this,"_endColumn");h(this,"_includeAllSlots");h(this,"_skipRows");h(this,"_row");h(this,"_rowIndex");h(this,"_column");h(this,"_cellIndex");h(this,"_spannedCells");h(this,"_nextCellAtColumn");h(this,"_jumpedToStartRow",!1);this._table=t,this._startRow=e.row!==void 0?e.row:e.startRow||0,this._endRow=e.row!==void 0?e.row:e.endRow,this._startColumn=e.column!==void 0?e.column:e.startColumn||0,this._endColumn=e.column!==void 0?e.column:e.endColumn,this._includeAllSlots=!!e.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){this._canJumpToStartRow()&&this._jumpToNonSpannedRowClosestToStartRow();const t=this._table.getChild(this._rowIndex);if(!t||this._isOverEndRow())return{done:!0,value:void 0};if(!t.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let e=null;const i=this._getSpanned();if(i)this._includeAllSlots&&!this._shouldSkipSlot()&&(e=this._formatOutValue(i.cell,i.row,i.column));else{const n=t.getChild(this._cellIndex);if(!n)return this._advanceToNextRow();const o=parseInt(n.getAttribute("colspan")||"1"),r=parseInt(n.getAttribute("rowspan")||"1");(o>1||r>1)&&this._recordSpans(n,r,o),this._shouldSkipSlot()||(e=this._formatOutValue(n)),this._nextCellAtColumn=this._column+o}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,e||this.next()}skipRow(t){this._skipRows.add(t)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return this._endRow!==void 0&&this._row>this._endRow}_isOverEndColumn(){return this._endColumn!==void 0&&this._column>this._endColumn}_formatOutValue(t,e=this._row,i=this._column){return{done:!1,value:new Ag(this,t,e,i)}}_shouldSkipSlot(){const t=this._skipRows.has(this._row),e=this._row<this._startRow,i=this._column<this._startColumn,n=this._endColumn!==void 0&&this._column>this._endColumn;return t||e||i||n}_getSpanned(){const t=this._spannedCells.get(this._row);return t&&t.get(this._column)||null}_recordSpans(t,e,i){const n={cell:t,row:this._row,column:this._column};for(let o=this._row;o<this._row+e;o++)for(let r=this._column;r<this._column+i;r++)(o!=this._row||r!=this._column)&&this._markSpannedCell(o,r,n)}_markSpannedCell(t,e,i){this._spannedCells.has(t)||this._spannedCells.set(t,new Map),this._spannedCells.get(t).set(e,i)}_canJumpToStartRow(){return!!this._startRow&&this._startRow>0&&!this._jumpedToStartRow}_jumpToNonSpannedRowClosestToStartRow(){const t=this._getRowLength(0);for(let e=this._startRow;!this._jumpedToStartRow;e--)t===this._getRowLength(e)&&(this._row=e,this._rowIndex=e,this._jumpedToStartRow=!0)}_getRowLength(t){return[...this._table.getChild(t).getChildren()].reduce((i,n)=>i+parseInt(n.getAttribute("colspan")||"1"),0)}}class Ag{constructor(t,e,i,n){h(this,"cell");h(this,"row");h(this,"column");h(this,"cellAnchorRow");h(this,"cellAnchorColumn");h(this,"_cellIndex");h(this,"_rowIndex");h(this,"_table");this.cell=e,this.row=t._row,this.column=t._column,this.cellAnchorRow=i,this.cellAnchorColumn=n,this._cellIndex=t._cellIndex,this._rowIndex=t._rowIndex,this._table=t._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||"1")}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||"1")}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}function Pn(s,t){return(e,{writer:i})=>{const n=e.getAttribute("headingRows")||0,o=i.createContainerElement("table",null,[]),r=i.createContainerElement("figure",{class:"table"},o);n>0&&i.insert(i.createPositionAt(o,"end"),i.createContainerElement("thead",null,i.createSlot(l=>l.is("element","tableRow")&&l.index<n))),n<s.getRows(e)&&i.insert(i.createPositionAt(o,"end"),i.createContainerElement("tbody",null,i.createSlot(l=>l.is("element","tableRow")&&l.index>=n)));for(const{positionOffset:l,filter:a}of t.additionalSlots)i.insert(i.createPositionAt(o,l),i.createSlot(a));return i.insert(i.createPositionAt(o,"after"),i.createSlot(l=>l.is("element","tableRow")?!1:!t.additionalSlots.some(({filter:a})=>a(l)))),t.asWidget?Eg(r,i):r}}function Tg(){return(s,{writer:t})=>s.isEmpty?t.createEmptyElement("tr"):t.createContainerElement("tr")}function Bn(s={}){return(t,{writer:e})=>{const i=t.parent,n=i.parent,o=n.getChildIndex(i),r=new A(n,{row:o}),l=n.getAttribute("headingRows")||0,a=n.getAttribute("headingColumns")||0;let c=null;for(const u of r)if(u.cell==t){const m=u.row<l||u.column<a?"th":"td";c=s.asWidget?Ci(e.createEditableElement(m),e):e.createContainerElement(m);break}return c}}function Ln(s={}){return(t,{writer:e})=>{if(!t.parent.is("element","tableCell")||!_s(t))return null;if(s.asWidget)return e.createContainerElement("span",{class:"ck-table-bogus-paragraph"});{const i=e.createContainerElement("p");return e.setCustomProperty("dataPipeline:transparentRendering",!0,i),i}}}function _s(s){return s.parent.childCount==1&&!Sg(s)}function Eg(s,t){return t.setCustomProperty("table",!0,s),je(s,t,{hasSelectionHandle:!0})}function Sg(s){return!s.getAttributeKeys().next().done}class xg extends y{refresh(){const t=this.editor.model,e=t.document.selection,i=t.schema;this.isEnabled=Rg(e,i)}execute(t={}){const e=this.editor,i=e.model,n=e.plugins.get("TableUtils"),o=e.config.get("table.defaultHeadings.rows"),r=e.config.get("table.defaultHeadings.columns");t.headingRows===void 0&&o&&(t.headingRows=o),t.headingColumns===void 0&&r&&(t.headingColumns=r),i.change(l=>{const a=n.createTable(l,t);i.insertObject(a,null,null,{findOptimalPosition:"auto"}),l.setSelection(l.createPositionAt(a.getNodeByPath([0,0,0]),0))})}}function Rg(s,t){const e=s.getFirstPosition().parent,i=e===e.root?e:e.parent;return t.checkChild(i,"table")}class On extends y{constructor(e,i={}){super(e);h(this,"order");this.order=i.order||"below"}refresh(){const e=this.editor.model.document.selection,n=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=n}execute(){const e=this.editor,i=e.model.document.selection,n=e.plugins.get("TableUtils"),o=this.order==="above",r=n.getSelectionAffectedTableCells(i),l=n.getRowIndexes(r),a=o?l.first:l.last,c=r[0].findAncestor("table");n.insertRows(c,{at:o?a:a+1,copyStructureFromAbove:!o})}}class Fn extends y{constructor(e,i={}){super(e);h(this,"order");this.order=i.order||"right"}refresh(){const e=this.editor.model.document.selection,n=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=n}execute(){const e=this.editor,i=e.model.document.selection,n=e.plugins.get("TableUtils"),o=this.order==="left",r=n.getSelectionAffectedTableCells(i),l=n.getColumnIndexes(r),a=o?l.first:l.last,c=r[0].findAncestor("table");n.insertColumns(c,{columns:1,at:o?a:a+1})}}class Un extends y{constructor(e,i={}){super(e);h(this,"direction");this.direction=i.direction||"horizontally"}refresh(){const i=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=i.length===1}execute(){const e=this.editor.plugins.get("TableUtils"),i=e.getSelectionAffectedTableCells(this.editor.model.document.selection)[0];this.direction==="horizontally"?e.splitCellHorizontally(i,2):e.splitCellVertically(i,2)}}function ks(s,t,e){const{startRow:i,startColumn:n,endRow:o,endColumn:r}=t,l=e.createElement("table"),a=o-i+1;for(let u=0;u<a;u++)e.insertElement("tableRow",l,"end");const c=[...new A(s,{startRow:i,endRow:o,startColumn:n,endColumn:r,includeAllSlots:!0})];for(const{row:u,column:d,cell:m,isAnchor:g,cellAnchorRow:f,cellAnchorColumn:p}of c){const b=u-i,C=l.getChild(b);if(!g)(f<i||p<n)&&fe(e,e.createPositionAt(C,"end"));else{const v=e.cloneElement(m);e.append(v,C),Es(v,u,d,o,r,e)}}return Vg(l,s,i,n,e),l}function ys(s,t,e=0){const i=[],n=new A(s,{startRow:e,endRow:t-1});for(const o of n){const{row:r,cellHeight:l}=o,a=r+l-1;r<t&&t<=a&&i.push(o)}return i}function Is(s,t,e){const i=s.parent,n=i.parent,o=i.index,r=parseInt(s.getAttribute("rowspan")),l=t-o,a={},c=r-l;c>1&&(a.rowspan=c);const u=parseInt(s.getAttribute("colspan")||"1");u>1&&(a.colspan=u);const d=o,m=d+l,g=[...new A(n,{startRow:d,endRow:m,includeAllSlots:!0})];let f=null,p;for(const b of g){const{row:C,column:v,cell:k}=b;k===s&&p===void 0&&(p=v),p!==void 0&&p===v&&C===m&&(f=fe(e,b.getPositionBefore(),a))}return E("rowspan",l,s,e),f}function As(s,t){const e=[],i=new A(s);for(const n of i){const{column:o,cellWidth:r}=n,l=o+r-1;o<t&&t<=l&&e.push(n)}return e}function Ts(s,t,e,i){const n=parseInt(s.getAttribute("colspan")),o=e-t,r={},l=n-o;l>1&&(r.colspan=l);const a=parseInt(s.getAttribute("rowspan")||"1");a>1&&(r.rowspan=a);const c=fe(i,i.createPositionAfter(s),r);return E("colspan",o,s,i),c}function Es(s,t,e,i,n,o){const r=parseInt(s.getAttribute("colspan")||"1"),l=parseInt(s.getAttribute("rowspan")||"1");if(e+r-1>n){const u=n-e+1;E("colspan",u,s,o,1)}if(t+l-1>i){const u=i-t+1;E("rowspan",u,s,o,1)}}function Vg(s,t,e,i,n){const o=parseInt(t.getAttribute("headingRows")||"0");if(o>0){const l=o-e;E("headingRows",l,s,n,0)}const r=parseInt(t.getAttribute("headingColumns")||"0");if(r>0){const l=r-i;E("headingColumns",l,s,n,0)}}function ti(s,t){const e=t.getColumns(s),i=new Array(e).fill(0);for(const{column:o}of new A(s))i[o]++;const n=i.reduce((o,r,l)=>r?o:[...o,l],[]);if(n.length>0){const o=n[n.length-1];return t.removeColumns(s,{at:o}),!0}return!1}function ii(s,t){const e=[],i=t.getRows(s);for(let n=0;n<i;n++)s.getChild(n).isEmpty&&e.push(n);if(e.length>0){const n=e[e.length-1];return t.removeRows(s,{at:n}),!0}return!1}function Ui(s,t){ti(s,t)||ii(s,t)}function Ss(s,t){const e=Array.from(new A(s,{startColumn:t.firstColumn,endColumn:t.lastColumn,row:t.lastRow}));if(e.every(({cellHeight:o})=>o===1))return t.lastRow;const n=e[0].cellHeight-1;return t.lastRow+n}function xs(s,t){const e=Array.from(new A(s,{startRow:t.firstRow,endRow:t.lastRow,column:t.lastColumn}));if(e.every(({cellWidth:o})=>o===1))return t.lastColumn;const n=e[0].cellWidth-1;return t.lastColumn+n}class Qe extends y{constructor(e,i){super(e);h(this,"direction");h(this,"isHorizontal");this.direction=i.direction,this.isHorizontal=this.direction=="right"||this.direction=="left"}refresh(){const e=this._getMergeableCell();this.value=e,this.isEnabled=!!e}execute(){const e=this.editor.model,i=e.document,o=this.editor.plugins.get("TableUtils").getTableCellsContainingSelection(i.selection)[0],r=this.value,l=this.direction;e.change(a=>{const c=l=="right"||l=="down",u=c?o:r,d=c?r:o,m=d.parent;Lg(d,u,a);const g=this.isHorizontal?"colspan":"rowspan",f=parseInt(o.getAttribute(g)||"1"),p=parseInt(r.getAttribute(g)||"1");a.setAttribute(g,f+p,u),a.setSelection(a.createRangeIn(u));const b=this.editor.plugins.get("TableUtils"),C=m.findAncestor("table");Ui(C,b)})}_getMergeableCell(){const i=this.editor.model.document,n=this.editor.plugins.get("TableUtils"),o=n.getTableCellsContainingSelection(i.selection)[0];if(!o)return;const r=this.isHorizontal?Pg(o,this.direction,n):Bg(o,this.direction,n);if(!r)return;const l=this.isHorizontal?"rowspan":"colspan",a=parseInt(o.getAttribute(l)||"1");if(parseInt(r.getAttribute(l)||"1")===a)return r}}function Pg(s,t,e){const n=s.parent.parent,o=t=="right"?s.nextSibling:s.previousSibling,r=(n.getAttribute("headingColumns")||0)>0;if(!o)return;const l=t=="right"?s:o,a=t=="right"?o:s,{column:c}=e.getCellLocation(l),{column:u}=e.getCellLocation(a),d=parseInt(l.getAttribute("colspan")||"1"),m=ei(e,l),g=ei(e,a);return r&&m!=g?void 0:c+d===u?o:void 0}function Bg(s,t,e){const i=s.parent,n=i.parent,o=n.getChildIndex(i);if(t=="down"&&o===e.getRows(n)-1||t=="up"&&o===0)return null;const r=parseInt(s.getAttribute("rowspan")||"1"),l=n.getAttribute("headingRows")||0,a=t=="down"&&o+r===l,c=t=="up"&&o===l;if(l&&(a||c))return null;const u=parseInt(s.getAttribute("rowspan")||"1"),d=t=="down"?o+u:o,m=[...new A(n,{endRow:d})],f=m.find(b=>b.cell===s).column,p=m.find(({row:b,cellHeight:C,column:v})=>v!==f?!1:t=="down"?b===d:d===b+C);return p&&p.cell?p.cell:null}function Lg(s,t,e){Dn(s)||(Dn(t)&&e.remove(e.createRangeIn(t)),e.move(e.createRangeIn(s),e.createPositionAt(t,"end"))),e.remove(s)}function Dn(s){const t=s.getChild(0);return s.childCount==1&&t.is("element","paragraph")&&t.isEmpty}class Og extends y{refresh(){const t=this.editor.plugins.get("TableUtils"),e=t.getSelectionAffectedTableCells(this.editor.model.document.selection),i=e[0];if(i){const n=i.findAncestor("table"),r=t.getRows(n)-1,l=t.getRowIndexes(e),a=l.first===0&&l.last===r;this.isEnabled=!a}else this.isEnabled=!1}execute(){const t=this.editor.model,e=this.editor.plugins.get("TableUtils"),i=e.getSelectionAffectedTableCells(t.document.selection),n=e.getRowIndexes(i),o=i[0],r=o.findAncestor("table"),l=e.getCellLocation(o).column;t.change(a=>{const c=n.last-n.first+1;e.removeRows(r,{at:n.first,rows:c});const u=Fg(r,n.first,l,e.getRows(r));a.setSelection(a.createPositionAt(u,0))})}}function Fg(s,t,e,i){const n=s.getChild(Math.min(t,i-1));let o=n.getChild(0),r=0;for(const l of n.getChildren()){if(r>e)return o;o=l,r+=parseInt(l.getAttribute("colspan")||"1")}return o}class Ug extends y{refresh(){const t=this.editor.plugins.get("TableUtils"),e=t.getSelectionAffectedTableCells(this.editor.model.document.selection),i=e[0];if(i){const n=i.findAncestor("table"),o=t.getColumns(n),{first:r,last:l}=t.getColumnIndexes(e);this.isEnabled=l-r<o-1}else this.isEnabled=!1}execute(){const t=this.editor.plugins.get("TableUtils"),[e,i]=Ng(this.editor.model.document.selection,t),n=e.parent.parent,o=[...new A(n)],r={first:o.find(a=>a.cell===e).column,last:o.find(a=>a.cell===i).column},l=Dg(o,e,i,r);this.editor.model.change(a=>{const c=r.last-r.first+1;t.removeColumns(n,{at:r.first,columns:c}),a.setSelection(a.createPositionAt(l,0))})}}function Dg(s,t,e,i){return parseInt(e.getAttribute("colspan")||"1")>1?e:t.previousSibling||e.nextSibling?e.nextSibling||t.previousSibling:i.first?s.reverse().find(({column:o})=>o<i.first).cell:s.reverse().find(({column:o})=>o>i.last).cell}function Ng(s,t){const e=t.getSelectionAffectedTableCells(s),i=e[0],n=e.pop(),o=[i,n];return i.isBefore(n)?o:o.reverse()}class Mg extends y{refresh(){const t=this.editor.plugins.get("TableUtils"),e=this.editor.model,i=t.getSelectionAffectedTableCells(e.document.selection),n=i.length>0;this.isEnabled=n,this.value=n&&i.every(o=>this._isInHeading(o,o.parent.parent))}execute(t={}){if(t.forceValue===this.value)return;const e=this.editor.plugins.get("TableUtils"),i=this.editor.model,n=e.getSelectionAffectedTableCells(i.document.selection),o=n[0].findAncestor("table"),{first:r,last:l}=e.getRowIndexes(n),a=this.value?r:l+1,c=o.getAttribute("headingRows")||0;i.change(u=>{if(a){const d=a>c?c:0,m=ys(o,a,d);for(const{cell:g}of m)Is(g,a,u)}E("headingRows",a,o,u,0)})}_isInHeading(t,e){const i=parseInt(e.getAttribute("headingRows")||"0");return!!i&&t.parent.index<i}}class Hg extends y{refresh(){const t=this.editor.model,e=this.editor.plugins.get("TableUtils"),i=e.getSelectionAffectedTableCells(t.document.selection),n=i.length>0;this.isEnabled=n,this.value=n&&i.every(o=>ei(e,o))}execute(t={}){if(t.forceValue===this.value)return;const e=this.editor.plugins.get("TableUtils"),i=this.editor.model,n=e.getSelectionAffectedTableCells(i.document.selection),o=n[0].findAncestor("table"),{first:r,last:l}=e.getColumnIndexes(n),a=this.value?r:l+1;i.change(c=>{if(a){const u=As(o,a);for(const{cell:d,column:m}of u)Ts(d,m,a,c)}E("headingColumns",a,o,c,0)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const zg=5,ni=40,Wg=2;function $g(s){const t=new Set;for(const e of s.document.differ.getChanges()){let i=null;switch(e.type){case"insert":i=["table","tableRow","tableCell"].includes(e.name)?e.position:null;break;case"remove":i=["tableRow","tableCell"].includes(e.name)?e.position:null;break;case"attribute":e.range.start.nodeAfter&&(i=["table","tableRow","tableCell"].includes(e.range.start.nodeAfter.name)?e.range.start:null);break}if(!i)continue;const n=i.nodeAfter&&i.nodeAfter.is("element","table")?i.nodeAfter:i.findAncestor("table");for(const o of s.createRangeOn(n).getItems())o.is("element","table")&&Ke(o)&&t.add(o)}return t}function jg(s,t){return ni*100/Rs(s,t)}function Rs(s,t){const e=Nn(s,"tbody",t)||Nn(s,"thead",t),i=t.editing.view.domConverter.mapViewToDom(e);return oi(i)}function Nn(s,t,e){return[...[...e.editing.mapper.toViewElement(s).getChildren()].find(o=>o.is("element","table")).getChildren()].find(o=>o.is("element",t))}function oi(s){const t=ee.window.getComputedStyle(s);return t.boxSizing==="border-box"?parseFloat(t.width)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderLeftWidth)-parseFloat(t.borderRightWidth):parseFloat(t.width)}function qg(s,t){const e=t.getCellLocation(s).column,i=s.getAttribute("colspan")||1;return{leftEdge:e,rightEdge:e+i-1}}function O(s){const t=Math.pow(10,Wg),e=typeof s=="number"?s:parseFloat(s);return Math.round(e*t)/t}function Gg(s,t,e){return s<=t?O(t):s>=e?O(e):O(s)}function Kg(s,t){return Array(s).fill(t)}function We(s){return s.map(t=>typeof t=="number"?t:parseFloat(t)).filter(t=>!Number.isNaN(t)).reduce((t,e)=>t+e,0)}function Di(s){const t=s.map(n=>n==="auto"?n:parseFloat(n.replace("%","")));let e=Zg(t);const i=We(e);return i!==100&&(e=e.map(n=>O(n*100/i)).map((n,o,r)=>{if(!(o===r.length-1))return n;const a=We(r);return O(n+100-a)})),e.map(n=>n+"%")}function Zg(s){const t=s.filter(n=>n==="auto").length;if(t===0)return s.map(n=>O(n));const e=We(s),i=Math.max((100-e)/t,zg);return s.map(n=>n==="auto"?i:n).map(n=>O(n))}function Jg(s){const t=ee.window.getComputedStyle(s);return t.boxSizing==="border-box"?parseInt(t.width):parseFloat(t.width)+parseFloat(t.paddingLeft)+parseFloat(t.paddingRight)+parseFloat(t.borderWidth)}function Vs(s,t,e,i){for(let n=0;n<Math.max(e.length,s.length);n++){const o=s[n],r=e[n];r?o?i.setAttribute("columnWidth",r,o):i.appendElement("tableColumn",{columnWidth:r},t):i.remove(o)}}function Ke(s){if(s.is("element","tableColumnGroup"))return s;const t=s.getChildren();return Array.from(t).find(e=>e.is("element","tableColumnGroup"))}function Ze(s){const t=Ke(s);return t?Array.from(t.getChildren()):[]}function Xg(s){return Ze(s).map(t=>t.getAttribute("columnWidth"))}function Yg(s,t){return Ze(s).reduce((i,n)=>{const o=n.getAttribute("columnWidth"),r=n.getAttribute("colSpan");if(!r)return i.push(o),i;for(let l=0;l<r;l++)i.push(o);return t.removeAttribute("colSpan",n),i},[])}class V extends w{static get pluginName(){return"TableUtils"}static get isOfficialPlugin(){return!0}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(t){const e=t.parent,i=e.parent,n=i.getChildIndex(e),o=new A(i,{row:n});for(const{cell:r,row:l,column:a}of o)if(r===t)return{row:l,column:a};/* istanbul ignore next -- @preserve */}createTable(t,e){const i=t.createElement("table"),n=e.rows||2,o=e.columns||2;return $t(t,i,0,n,o),e.headingRows&&E("headingRows",Math.min(e.headingRows,n),i,t,0),e.headingColumns&&E("headingColumns",Math.min(e.headingColumns,o),i,t,0),i}insertRows(t,e={}){const i=this.editor.model,n=e.at||0,o=e.rows||1,r=e.copyStructureFromAbove!==void 0,l=e.copyStructureFromAbove?n-1:n,a=this.getRows(t),c=this.getColumns(t);if(n>a)throw new R("tableutils-insertrows-insert-out-of-range",this,{options:e});i.change(u=>{const d=t.getAttribute("headingRows")||0;if(d>n&&E("headingRows",d+o,t,u,0),!r&&(n===0||n===a)){$t(u,t,n,o,c);return}const m=r?Math.max(n,l):n,g=new A(t,{endRow:m}),f=new Array(c).fill(1);for(const{row:p,column:b,cellHeight:C,cellWidth:v,cell:k}of g){const T=p+C-1,S=p<n&&n<=T,oe=p<=l&&l<=T;S?(u.setAttribute("rowspan",C+o,k),f[b]=-v):r&&oe&&(f[b]=v)}for(let p=0;p<o;p++){const b=u.createElement("tableRow");u.insert(b,t,n);for(let C=0;C<f.length;C++){const v=f[C],k=u.createPositionAt(b,"end");v>0&&fe(u,k,v>1?{colspan:v}:void 0),C+=Math.abs(v)-1}}})}insertColumns(t,e={}){const i=this.editor.model,n=e.at||0,o=e.columns||1;i.change(r=>{const l=t.getAttribute("headingColumns");n<l&&r.setAttribute("headingColumns",l+o,t);const a=this.getColumns(t);if(n===0||a===n){for(const u of t.getChildren())u.is("element","tableRow")&&Se(o,r,r.createPositionAt(u,n?"end":0));return}const c=new A(t,{column:n,includeAllSlots:!0});for(const u of c){const{row:d,cell:m,cellAnchorColumn:g,cellAnchorRow:f,cellWidth:p,cellHeight:b}=u;if(g<n){r.setAttribute("colspan",p+o,m);const C=f+b-1;for(let v=d;v<=C;v++)c.skipRow(v)}else Se(o,r,u.getPositionBefore())}})}removeRows(t,e){const i=this.editor.model,n=e.rows||1,o=this.getRows(t),r=e.at,l=r+n-1;if(l>o-1)throw new R("tableutils-removerows-row-index-out-of-range",this,{table:t,options:e});i.change(a=>{const c={first:r,last:l},{cellsToMove:u,cellsToTrim:d}=th(t,c);if(u.size){const m=l+1;ih(t,m,u,a)}for(let m=l;m>=r;m--)a.remove(t.getChild(m));for(const{rowspan:m,cell:g}of d)E("rowspan",m,g,a);eh(t,c,a),ti(t,this)||ii(t,this)})}removeColumns(t,e){const i=this.editor.model,n=e.at,o=e.columns||1,r=e.at+o-1;i.change(l=>{Qg(t,{first:n,last:r},l);const a=Ze(t);for(let c=r;c>=n;c--){for(const{cell:u,column:d,cellWidth:m}of[...new A(t)])d<=c&&m>1&&d+m>c?E("colspan",m-1,u,l):d===c&&l.remove(u);if(a[c]){const u=c===0?a[1]:a[c-1],d=parseFloat(a[c].getAttribute("columnWidth")),m=parseFloat(u.getAttribute("columnWidth"));l.remove(a[c]),l.setAttribute("columnWidth",d+m+"%",u)}}ii(t,this)||ti(t,this)})}splitCellVertically(t,e=2){const i=this.editor.model,o=t.parent.parent,r=parseInt(t.getAttribute("rowspan")||"1"),l=parseInt(t.getAttribute("colspan")||"1");i.change(a=>{if(l>1){const{newCellsSpan:c,updatedSpan:u}=Mn(l,e);E("colspan",u,t,a);const d={};c>1&&(d.colspan=c),r>1&&(d.rowspan=r);const m=l>e?e-1:l-1;Se(m,a,a.createPositionAfter(t),d)}if(l<e){const c=e-l,u=[...new A(o)],{column:d}=u.find(({cell:p})=>p===t),m=u.filter(({cell:p,cellWidth:b,column:C})=>{const v=p!==t&&C===d,k=C<d&&C+b>d;return v||k});for(const{cell:p,cellWidth:b}of m)a.setAttribute("colspan",b+c,p);const g={};r>1&&(g.rowspan=r),Se(c,a,a.createPositionAfter(t),g);const f=o.getAttribute("headingColumns")||0;f>d&&E("headingColumns",f+c,o,a)}})}splitCellHorizontally(t,e=2){const i=this.editor.model,n=t.parent,o=n.parent,r=o.getChildIndex(n),l=parseInt(t.getAttribute("rowspan")||"1"),a=parseInt(t.getAttribute("colspan")||"1");i.change(c=>{if(l>1){const u=[...new A(o,{startRow:r,endRow:r+l-1,includeAllSlots:!0})],{newCellsSpan:d,updatedSpan:m}=Mn(l,e);E("rowspan",m,t,c);const{column:g}=u.find(({cell:b})=>b===t),f={};d>1&&(f.rowspan=d),a>1&&(f.colspan=a);let p=0;for(const b of u){const{column:C,row:v}=b,k=v>=r+m,T=C===g;p>=d&&T&&(p=0),k&&T&&(p||Se(1,c,b.getPositionBefore(),f),p++)}}if(l<e){const u=e-l,d=[...new A(o,{startRow:0,endRow:r})];for(const{cell:f,cellHeight:p,row:b}of d)if(f!==t&&b+p>r){const C=p+u;c.setAttribute("rowspan",C,f)}const m={};a>1&&(m.colspan=a),$t(c,o,r+1,u,1,m);const g=o.getAttribute("headingRows")||0;g>r&&E("headingRows",g+u,o,c)}})}getColumns(t){return[...t.getChild(0).getChildren()].filter(i=>i.is("element","tableCell")).reduce((i,n)=>{const o=parseInt(n.getAttribute("colspan")||"1");return i+o},0)}getRows(t){return Array.from(t.getChildren()).reduce((e,i)=>i.is("element","tableRow")?e+1:e,0)}createTableWalker(t,e={}){return new A(t,e)}getSelectedTableCells(t){const e=[];for(const i of this.sortRanges(t.getRanges())){const n=i.getContainedElement();n&&n.is("element","tableCell")&&e.push(n)}return e}getTableCellsContainingSelection(t){const e=[];for(const i of t.getRanges()){const n=i.start.findAncestor("tableCell");n&&e.push(n)}return e}getSelectionAffectedTableCells(t){const e=this.getSelectedTableCells(t);return e.length?e:this.getTableCellsContainingSelection(t)}getRowIndexes(t){const e=t.map(i=>i.parent.index);return this._getFirstLastIndexesObject(e)}getColumnIndexes(t){const e=t[0].findAncestor("table"),n=[...new A(e)].filter(o=>t.includes(o.cell)).map(o=>o.column);return this._getFirstLastIndexesObject(n)}isSelectionRectangular(t){if(t.length<2||!this._areCellInTheSameTableSection(t))return!1;const e=new Set,i=new Set;let n=0;for(const r of t){const{row:l,column:a}=this.getCellLocation(r),c=parseInt(r.getAttribute("rowspan"))||1,u=parseInt(r.getAttribute("colspan"))||1;e.add(l),i.add(a),c>1&&e.add(l+c-1),u>1&&i.add(a+u-1),n+=c*u}return oh(e,i)==n}sortRanges(t){return Array.from(t).sort(nh)}_getFirstLastIndexesObject(t){const e=t.sort((o,r)=>o-r),i=e[0],n=e[e.length-1];return{first:i,last:n}}_areCellInTheSameTableSection(t){const e=t[0].findAncestor("table"),i=this.getRowIndexes(t),n=parseInt(e.getAttribute("headingRows"))||0;if(!this._areIndexesInSameSection(i,n))return!1;const o=this.getColumnIndexes(t),r=parseInt(e.getAttribute("headingColumns"))||0;return this._areIndexesInSameSection(o,r)}_areIndexesInSameSection({first:t,last:e},i){const n=t<i,o=e<i;return n===o}}function $t(s,t,e,i,n,o={}){for(let r=0;r<i;r++){const l=s.createElement("tableRow");s.insert(l,t,e),Se(n,s,s.createPositionAt(l,"end"),o)}}function Se(s,t,e,i={}){for(let n=0;n<s;n++)fe(t,e,i)}function Mn(s,t){if(s<t)return{newCellsSpan:1,updatedSpan:1};const e=Math.floor(s/t),i=s-e*t+e;return{newCellsSpan:e,updatedSpan:i}}function Qg(s,t,e){const i=s.getAttribute("headingColumns")||0;if(i&&t.first<i){const n=Math.min(i-1,t.last)-t.first+1;e.setAttribute("headingColumns",i-n,s)}}function eh(s,{first:t,last:e},i){const n=s.getAttribute("headingRows")||0;if(t<n){const o=e<n?n-(e-t+1):t;E("headingRows",o,s,i,0)}}function th(s,{first:t,last:e}){const i=new Map,n=[];for(const{row:o,column:r,cellHeight:l,cell:a}of new A(s,{endRow:e})){const c=o+l-1;if(o>=t&&o<=e&&c>e){const m=e-o+1,g=l-m;i.set(r,{cell:a,rowspan:g})}if(o<t&&c>=t){let m;c>=e?m=e-t+1:m=c-t+1,n.push({cell:a,rowspan:l-m})}}return{cellsToMove:i,cellsToTrim:n}}function ih(s,t,e,i){const o=[...new A(s,{includeAllSlots:!0,row:t})],r=s.getChild(t);let l;for(const{column:a,cell:c,isAnchor:u}of o)if(e.has(a)){const{cell:d,rowspan:m}=e.get(a),g=l?i.createPositionAfter(l):i.createPositionAt(r,0);i.move(i.createRangeOn(d),g),E("rowspan",m,d,i),l=d}else u&&(l=c)}function nh(s,t){const e=s.start,i=t.start;return e.isBefore(i)?-1:1}function oh(s,t){const e=Array.from(s.values()),i=Array.from(t.values()),n=Math.max(...e),o=Math.min(...e),r=Math.max(...i),l=Math.min(...i);return(n-o+1)*(r-l+1)}class sh extends y{refresh(){const t=this.editor.plugins.get(V),e=t.getSelectedTableCells(this.editor.model.document.selection);this.isEnabled=t.isSelectionRectangular(e)}execute(){const t=this.editor.model,e=this.editor.plugins.get(V);t.change(i=>{const n=e.getSelectedTableCells(t.document.selection),o=n.shift(),{mergeWidth:r,mergeHeight:l}=lh(o,n,e);E("colspan",r,o,i),E("rowspan",l,o,i);for(const c of n)rh(c,o,i);const a=o.findAncestor("table");Ui(a,e),i.setSelection(o,"in")})}}function rh(s,t,e){Hn(s)||(Hn(t)&&e.remove(e.createRangeIn(t)),e.move(e.createRangeIn(s),e.createPositionAt(t,"end"))),e.remove(s)}function Hn(s){const t=s.getChild(0);return s.childCount==1&&t.is("element","paragraph")&&t.isEmpty}function lh(s,t,e){let i=0,n=0;for(const c of t){const{row:u,column:d}=e.getCellLocation(c);i=zn(c,d,i,"colspan"),n=zn(c,u,n,"rowspan")}const{row:o,column:r}=e.getCellLocation(s),l=i-r,a=n-o;return{mergeWidth:l,mergeHeight:a}}function zn(s,t,e,i){const n=parseInt(s.getAttribute(i)||"1");return Math.max(e,t+n)}class ah extends y{constructor(t){super(t),this.affectsData=!1}refresh(){const e=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){const t=this.editor.model,e=this.editor.plugins.get("TableUtils"),i=e.getSelectionAffectedTableCells(t.document.selection),n=e.getRowIndexes(i),o=i[0].findAncestor("table"),r=[];for(let l=n.first;l<=n.last;l++)for(const a of o.getChild(l).getChildren())r.push(t.createRangeOn(a));t.change(l=>{l.setSelection(r)})}}class ch extends y{constructor(t){super(t),this.affectsData=!1}refresh(){const e=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){const t=this.editor.plugins.get("TableUtils"),e=this.editor.model,i=t.getSelectionAffectedTableCells(e.document.selection),n=i[0],o=i.pop(),r=n.findAncestor("table"),l=t.getCellLocation(n),a=t.getCellLocation(o),c=Math.min(l.column,a.column),u=Math.max(l.column,a.column),d=[];for(const m of new A(r,{startColumn:c,endColumn:u}))d.push(e.createRangeOn(m.cell));e.change(m=>{m.setSelection(d)})}}function uh(s){s.document.registerPostFixer(t=>dh(t,s))}function dh(s,t){const e=t.document.differ.getChanges();let i=!1;const n=new Set;for(const o of e){let r=null;o.type=="insert"&&o.name=="table"&&(r=o.position.nodeAfter),(o.type=="insert"||o.type=="remove")&&(o.name=="tableRow"||o.name=="tableCell")&&(r=o.position.findAncestor("table")),ph(o)&&(r=o.range.start.findAncestor("table")),r&&!n.has(r)&&(i=mh(r,s)||i,i=gh(r,s)||i,n.add(r))}return i}function mh(s,t){let e=!1;const i=hh(s);if(i.length){e=!0;for(const n of i)E("rowspan",n.rowspan,n.cell,t,1)}return e}function gh(s,t){let e=!1;const i=fh(s),n=[];for(const[a,c]of i.entries())!c&&s.getChild(a).is("element","tableRow")&&n.push(a);if(n.length){e=!0;for(const a of n.reverse())t.remove(s.getChild(a)),i.splice(a,1)}const o=i.filter((a,c)=>s.getChild(c).is("element","tableRow")),r=o[0];if(!o.every(a=>a===r)){const a=o.reduce((c,u)=>u>c?u:c,0);for(const[c,u]of o.entries()){const d=a-u;if(d){for(let m=0;m<d;m++)fe(t,t.createPositionAt(s.getChild(c),"end"));e=!0}}}return e}function hh(s){const t=parseInt(s.getAttribute("headingRows")||"0"),e=Array.from(s.getChildren()).reduce((n,o)=>o.is("element","tableRow")?n+1:n,0),i=[];for(const{row:n,cell:o,cellHeight:r}of new A(s)){if(r<2)continue;const a=n<t?t:e;if(n+r>a){const c=a-n;i.push({cell:o,rowspan:c})}}return i}function fh(s){const t=new Array(s.childCount).fill(0);for(const{rowIndex:e}of new A(s,{includeAllSlots:!0}))t[e]++;return t}function ph(s){if(s.type!=="attribute")return!1;const t=s.attributeKey;return t==="headingRows"||t==="colspan"||t==="rowspan"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function bh(s){s.document.registerPostFixer(t=>wh(t,s))}function wh(s,t){const e=t.document.differ.getChanges();let i=!1;for(const n of e)n.type=="insert"&&n.name=="table"&&(i=Ch(n.position.nodeAfter,s)||i),n.type=="insert"&&n.name=="tableRow"&&(i=Ps(n.position.nodeAfter,s)||i),n.type=="insert"&&n.name=="tableCell"&&(i=si(n.position.nodeAfter,s)||i),(n.type=="remove"||n.type=="insert")&&vh(n)&&(i=si(n.position.parent,s)||i);return i}function Ch(s,t){let e=!1;for(const i of s.getChildren())i.is("element","tableRow")&&(e=Ps(i,t)||e);return e}function Ps(s,t){let e=!1;for(const i of s.getChildren())e=si(i,t)||e;return e}function si(s,t){if(s.childCount==0)return t.insertElement("paragraph",s),!0;const e=Array.from(s.getChildren()).filter(i=>i.is("$text"));for(const i of e)t.wrap(t.createRangeOn(i),"paragraph");return!!e.length}function vh(s){return s.position.parent.is("element","tableCell")?s.type=="insert"&&s.name=="$text"||s.type=="remove":!1}function _h(s,t){const e=s.document.differ;for(const i of e.getChanges()){let n,o=!1;if(i.type=="attribute"){const c=i.range.start.nodeAfter;if(!c||!c.is("element","table")||i.attributeKey!="headingRows"&&i.attributeKey!="headingColumns")continue;n=c,o=i.attributeKey=="headingRows"}else(i.name=="tableRow"||i.name=="tableCell")&&(n=i.position.findAncestor("table"),o=i.name=="tableRow");if(!n)continue;const r=n.getAttribute("headingRows")||0,l=n.getAttribute("headingColumns")||0,a=new A(n);for(const c of a){const d=c.row<r||c.column<l?"th":"td",m=t.mapper.toViewElement(c.cell);m&&m.is("element")&&m.name!=d&&t.reconvertItem(o?c.cell.parent:c.cell)}}}function kh(s,t){const e=s.document.differ,i=new Set;for(const n of e.getChanges()){const o=n.type=="attribute"?n.range.start.parent:n.position.parent;o.is("element","tableCell")&&i.add(o)}for(const n of i.values()){const o=Array.from(n.getChildren()).filter(r=>yh(r,t.mapper));for(const r of o)t.reconvertItem(r)}}function yh(s,t){if(!s.is("element","paragraph"))return!1;const e=t.toViewElement(s);return e?_s(s)!==e.is("element","span"):!1}class Je extends w{constructor(e){super(e);h(this,"_additionalSlots");this._additionalSlots=[]}static get pluginName(){return"TableEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[V]}init(){const e=this.editor,i=e.model,n=i.schema,o=e.conversion,r=e.plugins.get(V);n.register("table",{inheritAllFrom:"$blockObject",allowAttributes:["headingRows","headingColumns"]}),n.register("tableRow",{allowIn:"table",isLimit:!0}),n.register("tableCell",{allowContentOf:"$container",allowIn:"tableRow",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),o.for("upcast").add(Cg()),o.for("upcast").add(vg()),o.for("editingDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:Pn(r,{asWidget:!0,additionalSlots:this._additionalSlots})}),o.for("dataDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:Pn(r,{additionalSlots:this._additionalSlots})}),o.for("upcast").elementToElement({model:"tableRow",view:"tr"}),o.for("upcast").add(_g()),o.for("downcast").elementToElement({model:"tableRow",view:Tg()}),o.for("upcast").elementToElement({model:"tableCell",view:"td"}),o.for("upcast").elementToElement({model:"tableCell",view:"th"}),o.for("upcast").add(Vn("td")),o.for("upcast").add(Vn("th")),o.for("editingDowncast").elementToElement({model:"tableCell",view:Bn({asWidget:!0})}),o.for("dataDowncast").elementToElement({model:"tableCell",view:Bn()}),o.for("editingDowncast").elementToElement({model:"paragraph",view:Ln({asWidget:!0}),converterPriority:"high"}),o.for("dataDowncast").elementToElement({model:"paragraph",view:Ln(),converterPriority:"high"}),o.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),o.for("upcast").attributeToAttribute({model:{key:"colspan",value:Wn("colspan")},view:"colspan"}),o.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),o.for("upcast").attributeToAttribute({model:{key:"rowspan",value:Wn("rowspan")},view:"rowspan"}),e.config.define("table.defaultHeadings.rows",0),e.config.define("table.defaultHeadings.columns",0),e.commands.add("insertTable",new xg(e)),e.commands.add("insertTableRowAbove",new On(e,{order:"above"})),e.commands.add("insertTableRowBelow",new On(e,{order:"below"})),e.commands.add("insertTableColumnLeft",new Fn(e,{order:"left"})),e.commands.add("insertTableColumnRight",new Fn(e,{order:"right"})),e.commands.add("removeTableRow",new Og(e)),e.commands.add("removeTableColumn",new Ug(e)),e.commands.add("splitTableCellVertically",new Un(e,{direction:"vertically"})),e.commands.add("splitTableCellHorizontally",new Un(e,{direction:"horizontally"})),e.commands.add("mergeTableCells",new sh(e)),e.commands.add("mergeTableCellRight",new Qe(e,{direction:"right"})),e.commands.add("mergeTableCellLeft",new Qe(e,{direction:"left"})),e.commands.add("mergeTableCellDown",new Qe(e,{direction:"down"})),e.commands.add("mergeTableCellUp",new Qe(e,{direction:"up"})),e.commands.add("setTableColumnHeader",new Hg(e)),e.commands.add("setTableRowHeader",new Mg(e)),e.commands.add("selectTableRow",new ah(e)),e.commands.add("selectTableColumn",new ch(e)),uh(i),bh(i),this.listenTo(i.document,"change:data",()=>{_h(i,e.editing),kh(i,e.editing)})}registerAdditionalSlot(e){this._additionalSlots.push(e)}}function Wn(s){return t=>{const e=parseInt(t.getAttribute(s));return Number.isNaN(e)||e<=0?null:e}}class $n extends L{constructor(e){super(e);h(this,"items");h(this,"keystrokes");h(this,"focusTracker");const i=this.bindTemplate;this.items=this._createGridCollection(),this.keystrokes=new j,this.focusTracker=new G,this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(n,o)=>`${o} × ${n}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":i.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck","ck-insert-table-dropdown__label"],"aria-hidden":!0},children:[{text:i.to("label")}]}],on:{mousedown:i.to(n=>{n.preventDefault()}),click:i.to(()=>{this.fire("execute")})}}),this.on("boxover",(n,o)=>{const{row:r,column:l}=o.target.dataset;this.items.get((parseInt(r,10)-1)*10+(parseInt(l,10)-1)).focus()}),this.focusTracker.on("change:focusedElement",(n,o,r)=>{if(!r)return;const{row:l,column:a}=r.dataset;this.set({rows:parseInt(l),columns:parseInt(a)})}),this.on("change:columns",()=>this._highlightGridBoxes()),this.on("change:rows",()=>this._highlightGridBoxes())}render(){super.render(),Nr({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:10,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection});for(const e of this.items)this.focusTracker.add(e.element);this.keystrokes.listenTo(this.element)}reset(){this.set({rows:1,columns:1})}focus(){this.items.get(0).focus()}focusLast(){this.items.get(0).focus()}_highlightGridBoxes(){const e=this.rows,i=this.columns;this.items.map((n,o)=>{const r=Math.floor(o/10),l=o%10,a=r<e&&l<i;n.set("isOn",a)})}_createGridButton(e,i,n,o){const r=new I(e);return r.set({label:o,class:"ck-insert-table-dropdown-grid-box"}),r.extendTemplate({attributes:{"data-row":i,"data-column":n}}),r}_createGridCollection(){const e=[];for(let i=0;i<100;i++){const n=Math.floor(i/10),o=i%10,r=`${n+1} × ${o+1}`;e.push(this._createGridButton(this.locale,n+1,o+1,r))}return this.createCollection(e)}}var Ih='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M18 7v1H2V7h16zm0 5v1H2v-1h16z" opacity=".6"/><path d="M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z"/></svg>',Ah='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v16h-1V2z" opacity=".6"/><path d="M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z"/></svg>',Th='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z" opacity=".6"/><path d="M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z"/></svg>';class Eh extends w{static get pluginName(){return"TableUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=this.editor.t,n=t.locale.contentLanguageDirection==="ltr";t.ui.componentFactory.add("insertTable",o=>{const r=t.commands.get("insertTable"),l=q(o);l.bind("isEnabled").to(r),l.buttonView.set({icon:_.table,label:e("Insert table"),tooltip:!0});let a;return l.on("change:isOpen",()=>{a||(a=new $n(o),l.panelView.children.add(a),a.delegate("execute").to(l),l.on("execute",()=>{t.execute("insertTable",{rows:a.rows,columns:a.columns}),t.editing.view.focus()}))}),l}),t.ui.componentFactory.add("menuBar:insertTable",o=>{const r=t.commands.get("insertTable"),l=new At(o),a=new $n(o);return a.delegate("execute").to(l),l.on("change:isOpen",(c,u,d)=>{d||a.reset()}),a.on("execute",()=>{t.execute("insertTable",{rows:a.rows,columns:a.columns}),t.editing.view.focus()}),l.buttonView.set({label:e("Table"),icon:_.table}),l.panelView.children.add(a),l.bind("isEnabled").to(r),l}),t.ui.componentFactory.add("tableColumn",o=>{const r=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:e("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:n?"insertTableColumnLeft":"insertTableColumnRight",label:e("Insert column left")}},{type:"button",model:{commandName:n?"insertTableColumnRight":"insertTableColumnLeft",label:e("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:e("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:e("Select column")}}];return this._prepareDropdown(e("Column"),Ih,r,o)}),t.ui.componentFactory.add("tableRow",o=>{const r=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:e("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:e("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:e("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:e("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:e("Select row")}}];return this._prepareDropdown(e("Row"),Ah,r,o)}),t.ui.componentFactory.add("mergeTableCells",o=>{const r=[{type:"button",model:{commandName:"mergeTableCellUp",label:e("Merge cell up")}},{type:"button",model:{commandName:n?"mergeTableCellRight":"mergeTableCellLeft",label:e("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:e("Merge cell down")}},{type:"button",model:{commandName:n?"mergeTableCellLeft":"mergeTableCellRight",label:e("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:e("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:e("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(e("Merge cells"),Th,r,o)})}_prepareDropdown(t,e,i,n){const o=this.editor,r=q(n),l=this._fillDropdownWithListOptions(r,i);return r.buttonView.set({label:t,icon:e,tooltip:!0}),r.bind("isEnabled").toMany(l,"isEnabled",(...a)=>a.some(c=>c)),this.listenTo(r,"execute",a=>{o.execute(a.source.commandName),a.source instanceof mo||o.editing.view.focus()}),r}_prepareMergeSplitButtonDropdown(t,e,i,n){const o=this.editor,r=q(n,Tt),l="mergeTableCells",a=o.commands.get(l),c=this._fillDropdownWithListOptions(r,i);return r.buttonView.set({label:t,icon:e,tooltip:!0,isEnabled:!0}),r.bind("isEnabled").toMany([a,...c],"isEnabled",(...u)=>u.some(d=>d)),this.listenTo(r.buttonView,"execute",()=>{o.execute(l),o.editing.view.focus()}),this.listenTo(r,"execute",u=>{o.execute(u.source.commandName),o.editing.view.focus()}),r}_fillDropdownWithListOptions(t,e){const i=this.editor,n=[],o=new ge;for(const r of e)Sh(r,i,n,o);return Be(t,o),n}}function Sh(s,t,e,i){if(s.type==="button"||s.type==="switchbutton"){const n=s.model=new Ve(s.model),{commandName:o,bindIsOn:r}=s.model,l=t.commands.get(o);e.push(l),n.set({commandName:o}),n.bind("isEnabled").to(l),r&&n.bind("isOn").to(l,"value"),n.set({withText:!0})}i.add(s)}class de extends w{static get pluginName(){return"TableSelection"}static get isOfficialPlugin(){return!0}static get requires(){return[V,V]}init(){const t=this.editor,e=t.model,i=t.editing.view;this.listenTo(e,"deleteContent",(n,o)=>this._handleDeleteContent(n,o),{priority:"high"}),this.listenTo(i.document,"insertText",(n,o)=>this._handleInsertTextEvent(n,o),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){const t=this.editor.plugins.get(V),e=this.editor.model.document.selection,i=t.getSelectedTableCells(e);return i.length==0?null:i}getSelectionAsFragment(){const t=this.editor.plugins.get(V),e=this.getSelectedTableCells();return e?this.editor.model.change(i=>{const n=i.createDocumentFragment(),{first:o,last:r}=t.getColumnIndexes(e),{first:l,last:a}=t.getRowIndexes(e),c=e[0].findAncestor("table");let u=a,d=r;if(t.isSelectionRectangular(e)){const f={firstColumn:o,lastColumn:r,firstRow:l,lastRow:a};u=Ss(c,f),d=xs(c,f)}const g=ks(c,{startRow:l,startColumn:o,endRow:u,endColumn:d},i);return i.insert(g,n,0),n}):null}setCellSelection(t,e){const i=this._getCellsToSelect(t,e);this.editor.model.change(n=>{n.setSelection(i.cells.map(o=>n.createRangeOn(o)),{backward:i.backward})})}getFocusCell(){const i=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return i&&i.is("element","tableCell")?i:null}getAnchorCell(){const t=this.editor.model.document.selection,i=U(t.getRanges()).getContainedElement();return i&&i.is("element","tableCell")?i:null}_defineSelectionConverter(){const t=this.editor,e=new Set;t.conversion.for("editingDowncast").add(n=>n.on("selection",(o,r,l)=>{const a=l.writer;i(a);const c=this.getSelectedTableCells();if(!c)return;for(const d of c){const m=l.mapper.toViewElement(d);a.addClass("ck-editor__editable_selected",m),e.add(m)}const u=l.mapper.toViewElement(c[c.length-1]);a.setSelection(u,0)},{priority:"lowest"}));function i(n){for(const o of e)n.removeClass("ck-editor__editable_selected",o);e.clear()}}_enablePluginDisabling(){const t=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){const e=this.getSelectedTableCells();if(!e)return;t.model.change(i=>{const n=i.createPositionAt(e[0],0),o=t.model.schema.getNearestSelectionRange(n);i.setSelection(o)})}})}_handleDeleteContent(t,e){const i=this.editor.plugins.get(V),n=e[0],o=e[1],r=this.editor.model,l=!o||o.direction=="backward",a=i.getSelectedTableCells(n);a.length&&(t.stop(),r.change(c=>{const u=a[l?a.length-1:0];r.change(m=>{for(const g of a)r.deleteContent(m.createSelection(g,"in"))});const d=r.schema.getNearestSelectionRange(c.createPositionAt(u,0));n.is("documentSelection")?c.setSelection(d):n.setTo(d)}))}_handleInsertTextEvent(t,e){const i=this.editor,n=this.getSelectedTableCells();if(!n)return;const o=i.editing.view,r=i.editing.mapper,l=n.map(a=>o.createRangeOn(r.toViewElement(a)));e.selection=o.createSelection(l)}_getCellsToSelect(t,e){const i=this.editor.plugins.get("TableUtils"),n=i.getCellLocation(t),o=i.getCellLocation(e),r=Math.min(n.row,o.row),l=Math.max(n.row,o.row),a=Math.min(n.column,o.column),c=Math.max(n.column,o.column),u=new Array(l-r+1).fill(null).map(()=>[]),d={startRow:r,endRow:l,startColumn:a,endColumn:c};for(const{row:f,cell:p}of new A(t.findAncestor("table"),d))u[f-r].push(p);const m=o.row<n.row,g=o.column<n.column;return m&&u.reverse(),g&&u.forEach(f=>f.reverse()),{cells:u.flat(),backward:m||g}}}class xh extends w{static get pluginName(){return"TableClipboard"}static get isOfficialPlugin(){return!0}static get requires(){return[Pt,he,de,V]}init(){const t=this.editor,e=t.editing.view.document;this.listenTo(e,"copy",(i,n)=>this._onCopyCut(i,n)),this.listenTo(e,"cut",(i,n)=>this._onCopyCut(i,n)),this.listenTo(t.model,"insertContent",(i,[n,o])=>this._onInsertContent(i,n,o),{priority:"high"}),this.decorate("_replaceTableSlotCell")}_onCopyCut(t,e){const i=this.editor.editing.view,n=this.editor.plugins.get(de),o=this.editor.plugins.get(Pt);n.getSelectedTableCells()&&(t.name=="cut"&&!this.editor.model.canEditAt(this.editor.model.document.selection)||(e.preventDefault(),t.stop(),this.editor.model.enqueueChange({isUndoable:t.name==="cut"},()=>{const r=o._copySelectedFragmentWithMarkers(t.name,this.editor.model.document.selection,()=>n.getSelectionAsFragment());i.document.fire("clipboardOutput",{dataTransfer:e.dataTransfer,content:this.editor.data.toView(r),method:t.name})})))}_onInsertContent(t,e,i){if(i&&!i.is("documentSelection"))return;const n=this.editor.model,o=this.editor.plugins.get(V),r=this.editor.plugins.get(Pt),l=this.getTableIfOnlyTableInContent(e,n);if(!l)return;const a=o.getSelectionAffectedTableCells(n.document.selection);if(!a.length){Ui(l,o);return}t.stop(),e.is("documentFragment")?r._pasteMarkersIntoTransformedElement(e.markers,c=>this._replaceSelectedCells(l,a,c)):this.editor.model.change(c=>{this._replaceSelectedCells(l,a,c)})}_replaceSelectedCells(t,e,i){const n=this.editor.plugins.get(V),o={width:n.getColumns(t),height:n.getRows(t)},r=Rh(e,o,i,n),l=r.lastRow-r.firstRow+1,a=r.lastColumn-r.firstColumn+1,c={startRow:0,startColumn:0,endRow:Math.min(l,o.height)-1,endColumn:Math.min(a,o.width)-1};t=ks(t,c,i);const u=e[0].findAncestor("table"),d=this._replaceSelectedCellsWithPasted(t,o,u,r,i);if(this.editor.plugins.get("TableSelection").isEnabled){const m=n.sortRanges(d.map(g=>i.createRangeOn(g)));i.setSelection(m)}else i.setSelection(d[0],0);return u}_replaceSelectedCellsWithPasted(t,e,i,n,o){const{width:r,height:l}=e,a=Ph(t,r,l),c=[...new A(i,{startRow:n.firstRow,endRow:n.lastRow,startColumn:n.firstColumn,endColumn:n.lastColumn,includeAllSlots:!0})],u=[];let d;for(const b of c){const{row:C,column:v}=b;v===n.firstColumn&&(d=b.getPositionBefore());const k=C-n.firstRow,T=v-n.firstColumn,S=a[k%l][T%r],oe=S?o.cloneElement(S):null,Ce=this._replaceTableSlotCell(b,oe,d,o);Ce&&(Es(Ce,C,v,n.lastRow,n.lastColumn,o),u.push(Ce),d=o.createPositionAfter(Ce))}const m=parseInt(i.getAttribute("headingRows")||"0"),g=parseInt(i.getAttribute("headingColumns")||"0"),f=n.firstRow<m&&m<=n.lastRow,p=n.firstColumn<g&&g<=n.lastColumn;if(f){const b={first:n.firstColumn,last:n.lastColumn},C=ri(i,m,b,o,n.firstRow);u.push(...C)}if(p){const b={first:n.firstRow,last:n.lastRow},C=li(i,g,b,o);u.push(...C)}return u}_replaceTableSlotCell(t,e,i,n){const{cell:o,isAnchor:r}=t;return r&&n.remove(o),e?(n.insert(e,i),e):null}getTableIfOnlyTableInContent(t,e){if(!t.is("documentFragment")&&!t.is("element"))return null;if(t.is("element","table"))return t;if(t.childCount==1&&t.getChild(0).is("element","table"))return t.getChild(0);const i=e.createRangeIn(t);for(const n of i.getItems())if(n.is("element","table")){const o=e.createRange(i.start,e.createPositionBefore(n));if(e.hasContent(o,{ignoreWhitespaces:!0}))return null;const r=e.createRange(e.createPositionAfter(n),i.end);return e.hasContent(r,{ignoreWhitespaces:!0})?null:n}return null}}function Rh(s,t,e,i){const n=s[0].findAncestor("table"),o=i.getColumnIndexes(s),r=i.getRowIndexes(s),l={firstColumn:o.first,lastColumn:o.last,firstRow:r.first,lastRow:r.last},a=s.length===1;return a&&(l.lastRow+=t.height-1,l.lastColumn+=t.width-1,Vh(n,l.lastRow+1,l.lastColumn+1,i)),a||!i.isSelectionRectangular(s)?Bh(n,l,e):(l.lastRow=Ss(n,l),l.lastColumn=xs(n,l)),l}function Vh(s,t,e,i){const n=i.getColumns(s),o=i.getRows(s);e>n&&i.insertColumns(s,{at:n,columns:e-n}),t>o&&i.insertRows(s,{at:o,rows:t-o})}function Ph(s,t,e){const i=new Array(e).fill(null).map(()=>new Array(t).fill(null));for(const{column:n,row:o,cell:r}of new A(s))i[o][n]=r;return i}function Bh(s,t,e){const{firstRow:i,lastRow:n,firstColumn:o,lastColumn:r}=t,l={first:i,last:n},a={first:o,last:r};li(s,o,l,e),li(s,r+1,l,e),ri(s,i,a,e),ri(s,n+1,a,e,i)}function ri(s,t,e,i,n=0){return t<1?void 0:ys(s,t,n).filter(({column:l,cellWidth:a})=>Bs(l,a,e)).map(({cell:l})=>Is(l,t,i))}function li(s,t,e,i){return t<1?void 0:As(s,t).filter(({row:r,cellHeight:l})=>Bs(r,l,e)).map(({cell:r,column:l})=>Ts(r,l,t,i))}function Bs(s,t,e){const i=s+t-1,{first:n,last:o}=e,r=s>=n&&s<=o,l=s<n&&i>=n;return r||l}class Lh extends w{static get pluginName(){return"TableKeyboard"}static get isOfficialPlugin(){return!0}static get requires(){return[de,V]}init(){const t=this.editor,i=t.editing.view.document,n=t.t;this.listenTo(i,"arrowKey",(...o)=>this._onArrowKey(...o),{context:"table"}),this.listenTo(i,"tab",(...o)=>this._handleTabOnSelectedTable(...o),{context:"figure"}),this.listenTo(i,"tab",(...o)=>this._handleTab(...o),{context:["th","td"]}),t.accessibility.addKeystrokeInfoGroup({id:"table",label:n("Keystrokes that can be used in a table cell"),keystrokes:[{label:n("Move the selection to the next cell"),keystroke:"Tab"},{label:n("Move the selection to the previous cell"),keystroke:"Shift+Tab"},{label:n("Insert a new table row (when in the last cell of a table)"),keystroke:"Tab"},{label:n("Navigate through the table"),keystroke:[["arrowup"],["arrowright"],["arrowdown"],["arrowleft"]]}]})}_handleTabOnSelectedTable(t,e){const i=this.editor,o=i.model.document.selection.getSelectedElement();!o||!o.is("element","table")||(e.preventDefault(),e.stopPropagation(),t.stop(),i.model.change(r=>{r.setSelection(r.createRangeIn(o.getChild(0).getChild(0)))}))}_handleTab(t,e){const i=this.editor,n=this.editor.plugins.get(V),o=this.editor.plugins.get("TableSelection"),r=i.model.document.selection,l=!e.shiftKey;let a=n.getTableCellsContainingSelection(r)[0];if(a||(a=o.getFocusCell()),!a)return;e.preventDefault(),e.stopPropagation(),t.stop();const c=a.parent,u=c.parent,d=u.getChildIndex(c),m=c.getChildIndex(a),g=m===0;if(!l&&g&&d===0){i.model.change(C=>{C.setSelection(C.createRangeOn(u))});return}const f=m===c.childCount-1,p=d===n.getRows(u)-1;if(l&&p&&f&&(i.execute("insertTableRowBelow"),d===n.getRows(u)-1)){i.model.change(C=>{C.setSelection(C.createRangeOn(u))});return}let b;if(l&&f)b=u.getChild(d+1).getChild(0);else if(!l&&g){const C=u.getChild(d-1);b=C.getChild(C.childCount-1)}else b=c.getChild(m+(l?1:-1));i.model.change(C=>{C.setSelection(C.createRangeIn(b))})}_onArrowKey(t,e){const i=this.editor,n=e.keyCode,o=Fr(n,i.locale.contentLanguageDirection);this._handleArrowKeys(o,e.shiftKey)&&(e.preventDefault(),e.stopPropagation(),t.stop())}_handleArrowKeys(t,e){const i=this.editor.plugins.get(V),n=this.editor.plugins.get("TableSelection"),o=this.editor.model,r=o.document.selection,l=["right","down"].includes(t),a=i.getSelectedTableCells(r);if(a.length){let u;return e?u=n.getFocusCell():u=l?a[a.length-1]:a[0],this._navigateFromCellInDirection(u,t,e),!0}const c=r.focus.findAncestor("tableCell");/* istanbul ignore if: paranoid check -- @preserve */if(!c)return!1;if(!r.isCollapsed)if(e){if(r.isBackward==l&&!r.containsEntireContent(c))return!1}else{const u=r.getSelectedElement();if(!u||!o.schema.isObject(u))return!1}return this._isSelectionAtCellEdge(r,c,l)?(this._navigateFromCellInDirection(c,t,e),!0):!1}_isSelectionAtCellEdge(t,e,i){const n=this.editor.model,o=this.editor.model.schema,r=i?t.getLastPosition():t.getFirstPosition();if(!o.getLimitElement(r).is("element","tableCell"))return n.createPositionAt(e,i?"end":0).isTouching(r);const l=n.createSelection(r);return n.modifySelection(l,{direction:i?"forward":"backward"}),r.isEqual(l.focus)}_navigateFromCellInDirection(t,e,i=!1){const n=this.editor.model,o=t.findAncestor("table"),r=[...new A(o,{includeAllSlots:!0})],{row:l,column:a}=r[r.length-1],c=r.find(({cell:v})=>v==t);let{row:u,column:d}=c;switch(e){case"left":d--;break;case"up":u--;break;case"right":d+=c.cellWidth;break;case"down":u+=c.cellHeight;break}const m=u<0||u>l,g=d<0&&u<=0,f=d>a&&u>=l;if(m||g||f){n.change(v=>{v.setSelection(v.createRangeOn(o))});return}d<0?(d=i?0:a,u--):d>a&&(d=i?a:0,u++);const p=r.find(v=>v.row==u&&v.column==d).cell,b=["right","down"].includes(e),C=this.editor.plugins.get("TableSelection");if(i&&C.isEnabled){const v=C.getAnchorCell()||t;C.setCellSelection(v,p)}else{const v=n.createPositionAt(p,b?0:"end");n.change(k=>{k.setSelection(v)})}}}class Ls extends Mr{constructor(){super(...arguments);h(this,"domEventType",["mousemove","mouseleave"])}onDomEvent(e){this.fire(e.type,e)}}class Oh extends w{static get pluginName(){return"TableMouse"}static get isOfficialPlugin(){return!0}static get requires(){return[de,V]}init(){this.editor.editing.view.addObserver(Ls),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){const t=this.editor,e=t.plugins.get(V);let i=!1;const n=t.plugins.get(de);this.listenTo(t.editing.view.document,"mousedown",(o,r)=>{const l=t.model.document.selection;if(!this.isEnabled||!n.isEnabled||!r.domEvent.shiftKey)return;const a=n.getAnchorCell()||e.getTableCellsContainingSelection(l)[0];if(!a)return;const c=this._getModelTableCellFromDomEvent(r);c&&jn(a,c)&&(i=!0,n.setCellSelection(a,c),r.preventDefault())}),this.listenTo(t.editing.view.document,"mouseup",()=>{i=!1}),this.listenTo(t.editing.view.document,"selectionChange",o=>{i&&o.stop()},{priority:"highest"})}_enableMouseDragSelection(){const t=this.editor;let e,i,n=!1,o=!1;const r=t.plugins.get(de);this.listenTo(t.editing.view.document,"mousedown",(l,a)=>{!this.isEnabled||!r.isEnabled||a.domEvent.shiftKey||a.domEvent.ctrlKey||a.domEvent.altKey||(e=this._getModelTableCellFromDomEvent(a))}),this.listenTo(t.editing.view.document,"mousemove",(l,a)=>{if(!a.domEvent.buttons||!e)return;const c=this._getModelTableCellFromDomEvent(a);c&&jn(e,c)&&(i=c,!n&&i!=e&&(n=!0)),n&&(o=!0,r.setCellSelection(e,i),a.preventDefault())}),this.listenTo(t.editing.view.document,"mouseup",()=>{n=!1,o=!1,e=null,i=null}),this.listenTo(t.editing.view.document,"selectionChange",l=>{o&&l.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(t){const e=t.target,i=this.editor.editing.view.createPositionAt(e,0);return this.editor.editing.mapper.toModelPosition(i).parent.findAncestor("tableCell",{includeSelf:!0})}}function jn(s,t){return s.parent.parent==t.parent.parent}class Fh extends w{static get requires(){return[Je,Eh,de,Oh,Lh,xh,$e]}static get pluginName(){return"Table"}static get isOfficialPlugin(){return!0}}function Os(s){const t=Fs(s);return t||xt(s)}function Fs(s){const t=s.getSelectedElement();return t&&Us(t)?t:null}function xt(s){const t=s.getFirstPosition();if(!t)return null;let e=t.parent;for(;e;){if(e.is("element")&&Us(e))return e;e=e.parent}return null}function Us(s){return!!s.getCustomProperty("table")&&bi(s)}class Uh extends w{static get requires(){return[ut]}static get pluginName(){return"TableToolbar"}static get isOfficialPlugin(){return!0}afterInit(){const t=this.editor,e=t.t,i=t.plugins.get(ut),n=t.config.get("table.contentToolbar"),o=t.config.get("table.tableToolbar");n&&i.register("tableContent",{ariaLabel:e("Table toolbar"),items:n,getRelatedElement:xt}),o&&i.register("table",{ariaLabel:e("Table toolbar"),items:o,getRelatedElement:Fs})}}class Dh extends L{constructor(e,i){super(e);h(this,"options");h(this,"focusTracker");h(this,"focusCycler");h(this,"_focusables");h(this,"dropdownView");h(this,"inputView");h(this,"keystrokes");h(this,"_stillTyping");this.set("value",""),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isEmpty",!0),this.options=i,this.focusTracker=new G,this._focusables=new ie,this.dropdownView=this._createDropdownView(),this.inputView=this._createInputTextView(),this.keystrokes=new j,this._stillTyping=!1,this.focusCycler=new ne({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-input-color"]},children:[this.dropdownView,this.inputView]}),this.on("change:value",(n,o,r)=>this._setInputValue(r))}render(){super.render(),[this.inputView,this.dropdownView.buttonView].forEach(e=>{this.focusTracker.add(e.element),this._focusables.add(e)}),this.keystrokes.listenTo(this.element)}focus(e){e===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createDropdownView(){const e=this.locale,i=e.t,n=this.bindTemplate,o=this._createColorSelector(e),r=q(e),l=new L;return l.setTemplate({tag:"span",attributes:{class:["ck","ck-input-color__button__preview"],style:{backgroundColor:n.to("value")}},children:[{tag:"span",attributes:{class:["ck","ck-input-color__button__preview__no-color-indicator",n.if("value","ck-hidden",a=>a!="")]}}]}),r.buttonView.extendTemplate({attributes:{class:"ck-input-color__button"}}),r.buttonView.children.add(l),r.buttonView.label=i("Color picker"),r.buttonView.tooltip=!0,r.panelPosition=e.uiLanguageDirection==="rtl"?"se":"sw",r.panelView.children.add(o),r.bind("isEnabled").to(this,"isReadOnly",a=>!a),r.on("change:isOpen",(a,c,u)=>{u&&(o.updateSelectedColors(),o.showColorGridsFragment())}),r}_createInputTextView(){const e=this.locale,i=new Wr(e);return i.extendTemplate({on:{blur:i.bindTemplate.to("blur")}}),i.value=this.value,i.bind("isReadOnly","hasError").to(this),this.bind("isFocused","isEmpty").to(i),i.on("input",()=>{const n=i.element.value,o=this.options.colorDefinitions.find(r=>n===r.label);this._stillTyping=!0,this.value=o&&o.color||n}),i.on("blur",()=>{this._stillTyping=!1,this._setInputValue(i.element.value)}),i.delegate("input").to(this),i}_createColorSelector(e){const i=e.t,n=this.options.defaultColorValue||"",o=i(n?"Restore default":"Remove color"),r=new $r(e,{colors:this.options.colorDefinitions,columns:this.options.columns,removeButtonLabel:o,colorPickerLabel:i("Color picker"),colorPickerViewConfig:this.options.colorPickerConfig===!1?!1:{...this.options.colorPickerConfig,hideInput:!0}});r.appendUI(),r.on("execute",(a,c)=>{if(c.source==="colorPickerSaveButton"){this.dropdownView.isOpen=!1;return}this.value=c.value||n,this.fire("input"),c.source!=="colorPicker"&&(this.dropdownView.isOpen=!1)});let l=this.value;return r.on("colorPicker:cancel",()=>{this.value=l,this.fire("input"),this.dropdownView.isOpen=!1}),r.colorGridsFragmentView.colorPickerButtonView.on("execute",()=>{l=this.value}),r.bind("selectedColor").to(this,"value"),r}_setInputValue(e){if(!this._stillTyping){const i=qn(e),n=this.options.colorDefinitions.find(o=>i===qn(o.color));n?this.inputView.value=n.label:this.inputView.value=e||""}}}function qn(s){return s.replace(/([(,])\s+/g,"$1").replace(/^\s+|\s+(?=[),\s]|$)/g,"").replace(/,|\s/g," ")}const Ni=s=>s==="";function Mi(s){return{none:s("None"),solid:s("Solid"),dotted:s("Dotted"),dashed:s("Dashed"),double:s("Double"),groove:s("Groove"),ridge:s("Ridge"),inset:s("Inset"),outset:s("Outset")}}function Ds(s){return s('The color is invalid. Try "#FF0000" or "rgb(255,0,0)" or "red".')}function Ns(s){return s('The value is invalid. Try "10px" or "2em" or simply "2".')}function vt(s){return s=s.trim().toLowerCase(),Ni(s)||Hr(s)}function Me(s){return s=s.trim(),Ni(s)||zs(s)||bo(s)||zr(s)}function Ms(s){return s=s.trim(),Ni(s)||zs(s)||bo(s)}function Hs(s,t){const e=new ge,i=Mi(s.t);for(const n in i){const o={type:"button",model:new Ve({_borderStyleValue:n,label:i[n],role:"menuitemradio",withText:!0})};n==="none"?o.model.bind("isOn").to(s,"borderStyle",r=>t==="none"?!r:r===n):o.model.bind("isOn").to(s,"borderStyle",r=>r===n),e.add(o)}return e}function ai(s){const{view:t,icons:e,toolbar:i,labels:n,propertyName:o,nameToValue:r,defaultValue:l}=s;for(const a in n){const c=new I(t.locale);c.set({label:n[a],icon:e[a],tooltip:n[a]});const u=r?r(a):a;c.bind("isOn").to(t,o,d=>{let m=d;return d===""&&l&&(m=l),u===m}),c.on("execute",()=>{t[o]=u}),i.items.add(c)}}const _t=[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}];function kt(s){return(t,e,i)=>{const n=new Dh(t.locale,{colorDefinitions:Nh(s.colorConfig),columns:s.columns,defaultColorValue:s.defaultColorValue,colorPickerConfig:s.colorPickerConfig});return n.inputView.set({id:e,ariaDescribedById:i}),n.bind("isReadOnly").to(t,"isEnabled",o=>!o),n.bind("hasError").to(t,"errorText",o=>!!o),n.on("input",()=>{t.errorText=null}),t.bind("isEmpty","isFocused").to(n),n}}function zs(s){const t=parseFloat(s);return!Number.isNaN(t)&&s===String(t)}function Nh(s){return s.map(t=>({color:t.model,label:t.label,options:{hasBorder:t.hasBorder}}))}class F extends L{constructor(e,i={}){super(e);h(this,"children");const n=this.bindTemplate;this.set("class",i.class||null),this.children=this.createCollection(),i.children&&i.children.forEach(o=>this.children.add(o)),this.set("_role",null),this.set("_ariaLabelledBy",null),i.labelView&&this.set({_role:"group",_ariaLabelledBy:i.labelView.id}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-form__row",n.to("class")],role:n.to("_role"),"aria-labelledby":n.to("_ariaLabelledBy")},children:this.children})}}class Mh extends L{constructor(e,i){super(e);h(this,"options");h(this,"focusTracker");h(this,"keystrokes");h(this,"children");h(this,"borderStyleDropdown");h(this,"borderWidthInput");h(this,"borderColorInput");h(this,"backgroundInput");h(this,"paddingInput");h(this,"widthInput");h(this,"heightInput");h(this,"horizontalAlignmentToolbar");h(this,"verticalAlignmentToolbar");h(this,"saveButtonView");h(this,"cancelButtonView");h(this,"_focusables");h(this,"_focusCycler");this.set({borderStyle:"",borderWidth:"",borderColor:"",padding:"",backgroundColor:"",width:"",height:"",horizontalAlignment:"",verticalAlignment:""}),this.options=i;const{borderStyleDropdown:n,borderWidthInput:o,borderColorInput:r,borderRowLabel:l}=this._createBorderFields(),{backgroundRowLabel:a,backgroundInput:c}=this._createBackgroundFields(),{widthInput:u,operatorLabel:d,heightInput:m,dimensionsLabel:g}=this._createDimensionFields(),{horizontalAlignmentToolbar:f,verticalAlignmentToolbar:p,alignmentLabel:b}=this._createAlignmentFields();this.focusTracker=new G,this.keystrokes=new j,this.children=this.createCollection(),this.borderStyleDropdown=n,this.borderWidthInput=o,this.borderColorInput=r,this.backgroundInput=c,this.paddingInput=this._createPaddingField(),this.widthInput=u,this.heightInput=m,this.horizontalAlignmentToolbar=f,this.verticalAlignmentToolbar=p;const{saveButtonView:C,cancelButtonView:v}=this._createActionButtons();this.saveButtonView=C,this.cancelButtonView=v,this._focusables=new ie,this._focusCycler=new ne({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new wo(e,{label:this.t("Cell properties")})),this.children.add(new F(e,{labelView:l,children:[l,n,r,o],class:"ck-table-form__border-row"})),this.children.add(new F(e,{labelView:a,children:[a,c],class:"ck-table-form__background-row"})),this.children.add(new F(e,{children:[new F(e,{labelView:g,children:[g,u,d,m],class:"ck-table-form__dimensions-row"}),new F(e,{children:[this.paddingInput],class:"ck-table-cell-properties-form__padding-row"})]})),this.children.add(new F(e,{labelView:b,children:[b,f,p],class:"ck-table-cell-properties-form__alignment-row"})),this.children.add(new F(e,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-cell-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),Le({view:this}),[this.borderColorInput,this.backgroundInput].forEach(e=>{this._focusCycler.chain(e.fieldView.focusCycler)}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.paddingInput,this.horizontalAlignmentToolbar,this.verticalAlignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const e=this.options.defaultTableCellProperties,i={style:e.borderStyle,width:e.borderWidth,color:e.borderColor},n=kt({colorConfig:this.options.borderColors,columns:5,defaultColorValue:i.color,colorPickerConfig:this.options.colorPickerConfig}),o=this.locale,r=this.t,l=r("Style"),a=new Y(o);a.text=r("Border");const c=Mi(r),u=new P(o,Co);u.set({label:l,class:"ck-table-form__border-style"}),u.fieldView.buttonView.set({ariaLabel:l,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:l}),u.fieldView.buttonView.bind("label").to(this,"borderStyle",g=>c[g||"none"]),u.fieldView.on("execute",g=>{this.borderStyle=g.source._borderStyleValue}),u.bind("isEmpty").to(this,"borderStyle",g=>!g),Be(u.fieldView,Hs(this,i.style),{role:"menu",ariaLabel:l});const d=new P(o,z);d.set({label:r("Width"),class:"ck-table-form__border-width"}),d.fieldView.bind("value").to(this,"borderWidth"),d.bind("isEnabled").to(this,"borderStyle",et),d.fieldView.on("input",()=>{this.borderWidth=d.fieldView.element.value});const m=new P(o,n);return m.set({label:r("Color"),class:"ck-table-form__border-color"}),m.fieldView.bind("value").to(this,"borderColor"),m.bind("isEnabled").to(this,"borderStyle",et),m.fieldView.on("input",()=>{this.borderColor=m.fieldView.value}),this.on("change:borderStyle",(g,f,p,b)=>{et(p)||(this.borderColor="",this.borderWidth=""),et(b)||(this.borderColor=i.color,this.borderWidth=i.width)}),{borderRowLabel:a,borderStyleDropdown:u,borderColorInput:m,borderWidthInput:d}}_createBackgroundFields(){const e=this.locale,i=this.t,n=new Y(e);n.text=i("Background");const o=kt({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableCellProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),r=new P(e,o);return r.set({label:i("Color"),class:"ck-table-cell-properties-form__background"}),r.fieldView.bind("value").to(this,"backgroundColor"),r.fieldView.on("input",()=>{this.backgroundColor=r.fieldView.value}),{backgroundRowLabel:n,backgroundInput:r}}_createDimensionFields(){const e=this.locale,i=this.t,n=new Y(e);n.text=i("Dimensions");const o=new P(e,z);o.set({label:i("Width"),class:"ck-table-form__dimensions-row__width"}),o.fieldView.bind("value").to(this,"width"),o.fieldView.on("input",()=>{this.width=o.fieldView.element.value});const r=new L(e);r.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const l=new P(e,z);return l.set({label:i("Height"),class:"ck-table-form__dimensions-row__height"}),l.fieldView.bind("value").to(this,"height"),l.fieldView.on("input",()=>{this.height=l.fieldView.element.value}),{dimensionsLabel:n,widthInput:o,operatorLabel:r,heightInput:l}}_createPaddingField(){const e=this.locale,i=this.t,n=new P(e,z);return n.set({label:i("Padding"),class:"ck-table-cell-properties-form__padding"}),n.fieldView.bind("value").to(this,"padding"),n.fieldView.on("input",()=>{this.padding=n.fieldView.element.value}),n}_createAlignmentFields(){const e=this.locale,i=this.t,n=new Y(e),o={left:_.alignLeft,center:_.alignCenter,right:_.alignRight,justify:_.alignJustify,top:_.alignTop,middle:_.alignMiddle,bottom:_.alignBottom};n.text=i("Table cell text alignment");const r=new at(e),l=e.contentLanguageDirection==="rtl";r.set({isCompact:!0,ariaLabel:i("Horizontal text alignment toolbar")}),ai({view:this,icons:o,toolbar:r,labels:this._horizontalAlignmentLabels,propertyName:"horizontalAlignment",nameToValue:c=>{if(l){if(c==="left")return"right";if(c==="right")return"left"}return c},defaultValue:this.options.defaultTableCellProperties.horizontalAlignment});const a=new at(e);return a.set({isCompact:!0,ariaLabel:i("Vertical text alignment toolbar")}),ai({view:this,icons:o,toolbar:a,labels:this._verticalAlignmentLabels,propertyName:"verticalAlignment",defaultValue:this.options.defaultTableCellProperties.verticalAlignment}),{horizontalAlignmentToolbar:r,verticalAlignmentToolbar:a,alignmentLabel:n}}_createActionButtons(){const e=this.locale,i=this.t,n=new I(e),o=new I(e),r=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.paddingInput];return n.set({label:i("Save"),icon:_.check,class:"ck-button-save",type:"submit",withText:!0}),n.bind("isEnabled").toMany(r,"errorText",(...l)=>l.every(a=>!a)),o.set({label:i("Cancel"),icon:_.cancel,class:"ck-button-cancel",withText:!0}),o.delegate("execute").to(this,"cancel"),{saveButtonView:n,cancelButtonView:o}}get _horizontalAlignmentLabels(){const e=this.locale,i=this.t,n=i("Align cell text to the left"),o=i("Align cell text to the center"),r=i("Align cell text to the right"),l=i("Justify cell text");return e.uiLanguageDirection==="rtl"?{right:r,center:o,left:n,justify:l}:{left:n,center:o,right:r,justify:l}}get _verticalAlignmentLabels(){const e=this.t;return{top:e("Align cell text to the top"),middle:e("Align cell text to the middle"),bottom:e("Align cell text to the bottom")}}}function et(s){return s!=="none"}const ci=[J.defaultPositions.northArrowSouth,J.defaultPositions.northArrowSouthWest,J.defaultPositions.northArrowSouthEast,J.defaultPositions.southArrowNorth,J.defaultPositions.southArrowNorthWest,J.defaultPositions.southArrowNorthEast,J.defaultPositions.viewportStickyNorth];function Ws(s,t){const e=s.plugins.get("ContextualBalloon"),i=s.editing.view.document.selection;let n;t==="cell"?xt(i)&&(n=js(s)):Os(i)&&(n=$s(s)),n&&e.updatePosition(n)}function $s(s){const t=s.model.document.selection,e=ue(t),i=s.editing.mapper.toViewElement(e);return{target:s.editing.view.domConverter.mapViewToDom(i),positions:ci}}function js(s){const t=s.editing.mapper,e=s.editing.view.domConverter,i=s.model.document.selection;if(i.rangeCount>1)return{target:()=>Hh(i.getRanges(),s),positions:ci};const n=qs(i.getFirstPosition()),o=t.toViewElement(n);return{target:e.mapViewToDom(o),positions:ci}}function qs(s){return s.nodeAfter&&s.nodeAfter.is("element","tableCell")?s.nodeAfter:s.findAncestor("tableCell")}function Hh(s,t){const e=t.editing.mapper,i=t.editing.view.domConverter,n=Array.from(s).map(o=>{const r=qs(o.start),l=e.toViewElement(r);return new X(i.mapViewToDom(l))});return X.getBoundingRect(n)}var zh='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.105 18-.17 1H2.5A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1h15A1.5 1.5 0 0 1 19 2.5v9.975l-.85-.124-.15-.302V8h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5h3.105zM2 12h5V8H2v4zm10-4H8v4h4V8zM2 2v5h5V2H2zm0 16h5v-5H2v5zM13 7h5V2h-5v5zM8 2v5h4V2H8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM13 6a1 1 0 0 1 1 1v3.172a2.047 2.047 0 0 0-.293.443l-.858 1.736-1.916.28-.151.027A1.976 1.976 0 0 0 9.315 14H7a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm-1 2H8v4h4V8z"/></svg>';function pe(s){if(!s||!yi(s))return s;const{top:t,right:e,bottom:i,left:n}=s;if(t==e&&e==i&&i==n)return t}function be(s,t){const e=parseFloat(s);return Number.isNaN(e)||String(e)!==String(s)?s:`${e}${t}`}function Gs(s,t={}){const e={borderStyle:"none",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",...s};return t.includeAlignmentProperty&&!e.alignment&&(e.alignment="center"),t.includePaddingProperty&&!e.padding&&(e.padding=""),t.includeVerticalAlignmentProperty&&!e.verticalAlignment&&(e.verticalAlignment="middle"),t.includeHorizontalAlignmentProperty&&!e.horizontalAlignment&&(e.horizontalAlignment=t.isRightToLeftContent?"right":"left"),e}function Ks(s,t){return Gs({borderStyle:"double",borderColor:"hsl(0, 0%, 70%)",borderWidth:"1px",...s},t)}function Hi(s,t){return Gs({borderStyle:"solid",borderColor:"hsl(0, 0%, 75%)",borderWidth:"1px",...s},t)}const Wh=500,Gn={borderStyle:"tableCellBorderStyle",borderColor:"tableCellBorderColor",borderWidth:"tableCellBorderWidth",height:"tableCellHeight",width:"tableCellWidth",padding:"tableCellPadding",backgroundColor:"tableCellBackgroundColor",horizontalAlignment:"tableCellHorizontalAlignment",verticalAlignment:"tableCellVerticalAlignment"};class $h extends w{constructor(e){super(e);h(this,"_defaultTableCellProperties");h(this,"_balloon");h(this,"view");h(this,"_undoStepBatch");h(this,"_isReady");e.config.define("table.tableCellProperties",{borderColors:_t,backgroundColors:_t})}static get requires(){return[te]}static get pluginName(){return"TableCellPropertiesUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,i=e.t;this._defaultTableCellProperties=Hi(e.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:e.locale.contentLanguageDirection==="rtl"}),this._balloon=e.plugins.get(te),this.view=null,this._isReady=!1,e.ui.componentFactory.add("tableCellProperties",n=>{const o=new I(n);o.set({label:i("Cell properties"),icon:zh,tooltip:!0}),this.listenTo(o,"execute",()=>this._showView());const r=Object.values(Gn).map(l=>e.commands.get(l));return o.bind("isEnabled").toMany(r,"isEnabled",(...l)=>l.some(a=>a)),o})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const e=this.editor,i=e.config.get("table.tableCellProperties"),n=dt(i.borderColors),o=mt(e.locale,n),r=dt(i.backgroundColors),l=mt(e.locale,r),a=i.colorPicker!==!1,c=new Mh(e.locale,{borderColors:o,backgroundColors:l,defaultTableCellProperties:this._defaultTableCellProperties,colorPickerConfig:a?i.colorPicker||{}:!1}),u=e.t;c.render(),this.listenTo(c,"submit",()=>{this._hideView()}),this.listenTo(c,"cancel",()=>{this._undoStepBatch.operations.length&&e.execute("undo",this._undoStepBatch),this._hideView()}),c.keystrokes.set("Esc",(g,f)=>{this._hideView(),f()}),qe({emitter:c,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const d=Ds(u),m=Ns(u);return c.on("change:borderStyle",this._getPropertyChangeCallback("tableCellBorderStyle")),c.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:c.borderColorInput,commandName:"tableCellBorderColor",errorText:d,validator:vt})),c.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:c.borderWidthInput,commandName:"tableCellBorderWidth",errorText:m,validator:Ms})),c.on("change:padding",this._getValidatedPropertyChangeCallback({viewField:c.paddingInput,commandName:"tableCellPadding",errorText:m,validator:Me})),c.on("change:width",this._getValidatedPropertyChangeCallback({viewField:c.widthInput,commandName:"tableCellWidth",errorText:m,validator:Me})),c.on("change:height",this._getValidatedPropertyChangeCallback({viewField:c.heightInput,commandName:"tableCellHeight",errorText:m,validator:Me})),c.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:c.backgroundInput,commandName:"tableCellBackgroundColor",errorText:d,validator:vt})),c.on("change:horizontalAlignment",this._getPropertyChangeCallback("tableCellHorizontalAlignment")),c.on("change:verticalAlignment",this._getPropertyChangeCallback("tableCellVerticalAlignment")),c}_fillViewFormFromCommandValues(){const e=this.editor.commands,i=e.get("tableCellBorderStyle");Object.entries(Gn).map(([n,o])=>{const r=this._defaultTableCellProperties[n]||"";return[n,e.get(o).value||r]}).forEach(([n,o])=>{(n==="borderColor"||n==="borderWidth")&&i.value==="none"||this.view.set(n,o)}),this._isReady=!0}_showView(){const e=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(e.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:js(e)}),this._undoStepBatch=e.model.createBatch(),this.view.focus()}_hideView(){const e=this.editor;this.stopListening(e.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const e=this.editor,i=e.editing.view.document;xt(i.selection)?this._isViewVisible&&Ws(e,"cell"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(e){return(i,n,o)=>{this._isReady&&this.editor.execute(e,{value:o,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(e){const{commandName:i,viewField:n,validator:o,errorText:r}=e,l=mi(()=>{n.errorText=r},Wh);return(a,c,u)=>{l.cancel(),this._isReady&&(o(u)?(this.editor.execute(i,{value:u,batch:this._undoStepBatch}),n.errorText=null):l())}}}class K extends y{constructor(e,i,n){super(e);h(this,"attributeName");h(this,"_defaultValue");this.attributeName=i,this._defaultValue=n}refresh(){const e=this.editor,n=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e.model.document.selection);this.isEnabled=!!n.length,this.value=this._getSingleValue(n)}execute(e={}){const{value:i,batch:n}=e,o=this.editor.model,l=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(o.document.selection),a=this._getValueToSet(i);o.enqueueChange(n,c=>{a?l.forEach(u=>c.setAttribute(this.attributeName,a,u)):l.forEach(u=>c.removeAttribute(this.attributeName,u))})}_getAttribute(e){if(!e)return;const i=e.getAttribute(this.attributeName);if(i!==this._defaultValue)return i}_getValueToSet(e){if(e!==this._defaultValue)return e}_getSingleValue(e){const i=this._getAttribute(e[0]);return e.every(o=>this._getAttribute(o)===i)?i:void 0}}class jh extends K{constructor(t,e){super(t,"tableCellWidth",e)}_getValueToSet(t){if(t=be(t,"px"),t!==this._defaultValue)return t}}class Zs extends w{static get pluginName(){return"TableCellWidthEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[Je]}init(){const t=this.editor,e=Hi(t.config.get("table.tableCellProperties.defaultProperties"));rt(t.model.schema,t.conversion,{modelAttribute:"tableCellWidth",styleName:"width",defaultValue:e.width}),t.commands.add("tableCellWidth",new jh(t,e.width))}}class qh extends K{constructor(t,e){super(t,"tableCellPadding",e)}_getAttribute(t){if(!t)return;const e=pe(t.getAttribute(this.attributeName));if(e!==this._defaultValue)return e}_getValueToSet(t){const e=be(t,"px");if(e!==this._defaultValue)return e}}class Gh extends K{constructor(t,e){super(t,"tableCellHeight",e)}_getValueToSet(t){const e=be(t,"px");if(e!==this._defaultValue)return e}}class Kh extends K{constructor(t,e){super(t,"tableCellBackgroundColor",e)}}class Zh extends K{constructor(t,e){super(t,"tableCellVerticalAlignment",e)}}class Jh extends K{constructor(t,e){super(t,"tableCellHorizontalAlignment",e)}}class Xh extends K{constructor(t,e){super(t,"tableCellBorderStyle",e)}_getAttribute(t){if(!t)return;const e=pe(t.getAttribute(this.attributeName));if(e!==this._defaultValue)return e}}class Yh extends K{constructor(t,e){super(t,"tableCellBorderColor",e)}_getAttribute(t){if(!t)return;const e=pe(t.getAttribute(this.attributeName));if(e!==this._defaultValue)return e}}class Qh extends K{constructor(t,e){super(t,"tableCellBorderWidth",e)}_getAttribute(t){if(!t)return;const e=pe(t.getAttribute(this.attributeName));if(e!==this._defaultValue)return e}_getValueToSet(t){const e=be(t,"px");if(e!==this._defaultValue)return e}}const Kn=/^(top|middle|bottom)$/,Zn=/^(left|center|right|justify)$/;class ef extends w{static get pluginName(){return"TableCellPropertiesEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[Je,Zs]}init(){const t=this.editor,e=t.model.schema,i=t.conversion;t.config.define("table.tableCellProperties.defaultProperties",{});const n=Hi(t.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:t.locale.contentLanguageDirection==="rtl"});t.data.addStyleProcessorRules(fo),tf(e,i,{color:n.borderColor,style:n.borderStyle,width:n.borderWidth}),t.commands.add("tableCellBorderStyle",new Xh(t,n.borderStyle)),t.commands.add("tableCellBorderColor",new Yh(t,n.borderColor)),t.commands.add("tableCellBorderWidth",new Qh(t,n.borderWidth)),rt(e,i,{modelAttribute:"tableCellHeight",styleName:"height",defaultValue:n.height}),t.commands.add("tableCellHeight",new Gh(t,n.height)),t.data.addStyleProcessorRules(Ur),rt(e,i,{modelAttribute:"tableCellPadding",styleName:"padding",reduceBoxSides:!0,defaultValue:n.padding}),t.commands.add("tableCellPadding",new qh(t,n.padding)),t.data.addStyleProcessorRules(po),rt(e,i,{modelAttribute:"tableCellBackgroundColor",styleName:"background-color",defaultValue:n.backgroundColor}),t.commands.add("tableCellBackgroundColor",new Kh(t,n.backgroundColor)),nf(e,i,n.horizontalAlignment),t.commands.add("tableCellHorizontalAlignment",new Jh(t,n.horizontalAlignment)),of(e,i,n.verticalAlignment),t.commands.add("tableCellVerticalAlignment",new Zh(t,n.verticalAlignment))}}function tf(s,t,e){const i={width:"tableCellBorderWidth",color:"tableCellBorderColor",style:"tableCellBorderStyle"};s.extend("tableCell",{allowAttributes:Object.values(i)}),Qt(t,"td",i,e),Qt(t,"th",i,e),Ne(t,{modelElement:"tableCell",modelAttribute:i.style,styleName:"border-style"}),Ne(t,{modelElement:"tableCell",modelAttribute:i.color,styleName:"border-color"}),Ne(t,{modelElement:"tableCell",modelAttribute:i.width,styleName:"border-width"})}function nf(s,t,e){s.extend("tableCell",{allowAttributes:["tableCellHorizontalAlignment"]}),t.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellHorizontalAlignment"},view:i=>({key:"style",value:{"text-align":i}})}),t.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"text-align":Zn}},model:{key:"tableCellHorizontalAlignment",value:i=>{const n=i.getStyle("text-align");return n===e?null:n}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{align:Zn}},model:{key:"tableCellHorizontalAlignment",value:i=>{const n=i.getAttribute("align");return n===e?null:n}}})}function of(s,t,e){s.extend("tableCell",{allowAttributes:["tableCellVerticalAlignment"]}),t.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellVerticalAlignment"},view:i=>({key:"style",value:{"vertical-align":i}})}),t.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"vertical-align":Kn}},model:{key:"tableCellVerticalAlignment",value:i=>{const n=i.getStyle("vertical-align");return n===e?null:n}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{valign:Kn}},model:{key:"tableCellVerticalAlignment",value:i=>{const n=i.getAttribute("valign");return n===e?null:n}}})}class sf extends w{static get pluginName(){return"TableCellProperties"}static get isOfficialPlugin(){return!0}static get requires(){return[ef,$h]}}class we extends y{constructor(e,i,n){super(e);h(this,"attributeName");h(this,"_defaultValue");this.attributeName=i,this._defaultValue=n}refresh(){const i=this.editor.model.document.selection,n=ue(i);this.isEnabled=!!n,this.value=this._getValue(n)}execute(e={}){const i=this.editor.model,n=i.document.selection,{value:o,batch:r}=e,l=ue(n),a=this._getValueToSet(o);i.enqueueChange(r,c=>{a?c.setAttribute(this.attributeName,a,l):c.removeAttribute(this.attributeName,l)})}_getValue(e){if(!e)return;const i=e.getAttribute(this.attributeName);if(i!==this._defaultValue)return i}_getValueToSet(e){if(e!==this._defaultValue)return e}}class rf extends we{constructor(t,e){super(t,"tableBackgroundColor",e)}}class lf extends we{constructor(t,e){super(t,"tableBorderColor",e)}_getValue(t){if(!t)return;const e=pe(t.getAttribute(this.attributeName));if(e!==this._defaultValue)return e}}class af extends we{constructor(t,e){super(t,"tableBorderStyle",e)}_getValue(t){if(!t)return;const e=pe(t.getAttribute(this.attributeName));if(e!==this._defaultValue)return e}}class cf extends we{constructor(t,e){super(t,"tableBorderWidth",e)}_getValue(t){if(!t)return;const e=pe(t.getAttribute(this.attributeName));if(e!==this._defaultValue)return e}_getValueToSet(t){const e=be(t,"px");if(e!==this._defaultValue)return e}}class uf extends we{constructor(t,e){super(t,"tableWidth",e)}_getValueToSet(t){if(t=be(t,"px"),t!==this._defaultValue)return t}}class df extends we{constructor(t,e){super(t,"tableHeight",e)}_getValueToSet(t){if(t=be(t,"px"),t!==this._defaultValue)return t}}class mf extends we{constructor(t,e){super(t,"tableAlignment",e)}}const gf=/^(left|center|right)$/,hf=/^(left|none|right)$/;class ff extends w{static get pluginName(){return"TablePropertiesEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[Je]}init(){const t=this.editor,e=t.model.schema,i=t.conversion;t.config.define("table.tableProperties.defaultProperties",{});const n=Ks(t.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0});t.data.addStyleProcessorRules(fo),pf(e,i,{color:n.borderColor,style:n.borderStyle,width:n.borderWidth}),t.commands.add("tableBorderColor",new lf(t,n.borderColor)),t.commands.add("tableBorderStyle",new af(t,n.borderStyle)),t.commands.add("tableBorderWidth",new cf(t,n.borderWidth)),bf(e,i,n.alignment),t.commands.add("tableAlignment",new mf(t,n.alignment)),Jn(e,i,{modelAttribute:"tableWidth",styleName:"width",defaultValue:n.width}),t.commands.add("tableWidth",new uf(t,n.width)),Jn(e,i,{modelAttribute:"tableHeight",styleName:"height",defaultValue:n.height}),t.commands.add("tableHeight",new df(t,n.height)),t.data.addStyleProcessorRules(po),wf(e,i,{modelAttribute:"tableBackgroundColor",styleName:"background-color",defaultValue:n.backgroundColor}),t.commands.add("tableBackgroundColor",new rf(t,n.backgroundColor))}}function pf(s,t,e){const i={width:"tableBorderWidth",color:"tableBorderColor",style:"tableBorderStyle"};s.extend("table",{allowAttributes:Object.values(i)}),Qt(t,"table",i,e),ot(t,{modelAttribute:i.color,styleName:"border-color"}),ot(t,{modelAttribute:i.style,styleName:"border-style"}),ot(t,{modelAttribute:i.width,styleName:"border-width"})}function bf(s,t,e){s.extend("table",{allowAttributes:["tableAlignment"]}),t.for("downcast").attributeToAttribute({model:{name:"table",key:"tableAlignment"},view:i=>({key:"style",value:{float:i==="center"?"none":i}}),converterPriority:"high"}),t.for("upcast").attributeToAttribute({view:{name:/^(table|figure)$/,styles:{float:hf}},model:{key:"tableAlignment",value:i=>{let n=i.getStyle("float");return n==="none"&&(n="center"),n===e?null:n}}}).attributeToAttribute({view:{attributes:{align:gf}},model:{name:"table",key:"tableAlignment",value:i=>{const n=i.getAttribute("align");return n===e?null:n}}})}function wf(s,t,e){const{modelAttribute:i}=e;s.extend("table",{allowAttributes:[i]}),Fi(t,{viewElement:"table",...e}),ot(t,e)}function Jn(s,t,e){const{modelAttribute:i}=e;s.extend("table",{allowAttributes:[i]}),Fi(t,{viewElement:/^(table|figure)$/,shouldUpcast:n=>!(n.name=="table"&&n.parent.name=="figure"),...e}),Ne(t,{modelElement:"table",...e})}class Cf extends L{constructor(e,i){super(e);h(this,"options");h(this,"focusTracker");h(this,"keystrokes");h(this,"children");h(this,"borderStyleDropdown");h(this,"borderWidthInput");h(this,"borderColorInput");h(this,"backgroundInput");h(this,"widthInput");h(this,"heightInput");h(this,"alignmentToolbar");h(this,"saveButtonView");h(this,"cancelButtonView");h(this,"_focusables");h(this,"_focusCycler");this.set({borderStyle:"",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",alignment:""}),this.options=i;const{borderStyleDropdown:n,borderWidthInput:o,borderColorInput:r,borderRowLabel:l}=this._createBorderFields(),{backgroundRowLabel:a,backgroundInput:c}=this._createBackgroundFields(),{widthInput:u,operatorLabel:d,heightInput:m,dimensionsLabel:g}=this._createDimensionFields(),{alignmentToolbar:f,alignmentLabel:p}=this._createAlignmentFields();this.focusTracker=new G,this.keystrokes=new j,this.children=this.createCollection(),this.borderStyleDropdown=n,this.borderWidthInput=o,this.borderColorInput=r,this.backgroundInput=c,this.widthInput=u,this.heightInput=m,this.alignmentToolbar=f;const{saveButtonView:b,cancelButtonView:C}=this._createActionButtons();this.saveButtonView=b,this.cancelButtonView=C,this._focusables=new ie,this._focusCycler=new ne({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new wo(e,{label:this.t("Table properties")})),this.children.add(new F(e,{labelView:l,children:[l,n,r,o],class:"ck-table-form__border-row"})),this.children.add(new F(e,{labelView:a,children:[a,c],class:"ck-table-form__background-row"})),this.children.add(new F(e,{children:[new F(e,{labelView:g,children:[g,u,d,m],class:"ck-table-form__dimensions-row"}),new F(e,{labelView:p,children:[p,f],class:"ck-table-properties-form__alignment-row"})]})),this.children.add(new F(e,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),Le({view:this}),[this.borderColorInput,this.backgroundInput].forEach(e=>{this._focusCycler.chain(e.fieldView.focusCycler)}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.alignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const e=this.options.defaultTableProperties,i={style:e.borderStyle,width:e.borderWidth,color:e.borderColor},n=kt({colorConfig:this.options.borderColors,columns:5,defaultColorValue:i.color,colorPickerConfig:this.options.colorPickerConfig}),o=this.locale,r=this.t,l=r("Style"),a=new Y(o);a.text=r("Border");const c=Mi(r),u=new P(o,Co);u.set({label:l,class:"ck-table-form__border-style"}),u.fieldView.buttonView.set({ariaLabel:l,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:l}),u.fieldView.buttonView.bind("label").to(this,"borderStyle",g=>c[g||"none"]),u.fieldView.on("execute",g=>{this.borderStyle=g.source._borderStyleValue}),u.bind("isEmpty").to(this,"borderStyle",g=>!g),Be(u.fieldView,Hs(this,i.style),{role:"menu",ariaLabel:l});const d=new P(o,z);d.set({label:r("Width"),class:"ck-table-form__border-width"}),d.fieldView.bind("value").to(this,"borderWidth"),d.bind("isEnabled").to(this,"borderStyle",tt),d.fieldView.on("input",()=>{this.borderWidth=d.fieldView.element.value});const m=new P(o,n);return m.set({label:r("Color"),class:"ck-table-form__border-color"}),m.fieldView.bind("value").to(this,"borderColor"),m.bind("isEnabled").to(this,"borderStyle",tt),m.fieldView.on("input",()=>{this.borderColor=m.fieldView.value}),this.on("change:borderStyle",(g,f,p,b)=>{tt(p)||(this.borderColor="",this.borderWidth=""),tt(b)||(this.borderColor=i.color,this.borderWidth=i.width)}),{borderRowLabel:a,borderStyleDropdown:u,borderColorInput:m,borderWidthInput:d}}_createBackgroundFields(){const e=this.locale,i=this.t,n=new Y(e);n.text=i("Background");const o=kt({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),r=new P(e,o);return r.set({label:i("Color"),class:"ck-table-properties-form__background"}),r.fieldView.bind("value").to(this,"backgroundColor"),r.fieldView.on("input",()=>{this.backgroundColor=r.fieldView.value}),{backgroundRowLabel:n,backgroundInput:r}}_createDimensionFields(){const e=this.locale,i=this.t,n=new Y(e);n.text=i("Dimensions");const o=new P(e,z);o.set({label:i("Width"),class:"ck-table-form__dimensions-row__width"}),o.fieldView.bind("value").to(this,"width"),o.fieldView.on("input",()=>{this.width=o.fieldView.element.value});const r=new L(e);r.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const l=new P(e,z);return l.set({label:i("Height"),class:"ck-table-form__dimensions-row__height"}),l.fieldView.bind("value").to(this,"height"),l.fieldView.on("input",()=>{this.height=l.fieldView.element.value}),{dimensionsLabel:n,widthInput:o,operatorLabel:r,heightInput:l}}_createAlignmentFields(){const e=this.locale,i=this.t,n=new Y(e);n.text=i("Alignment");const o=new at(e);return o.set({isCompact:!0,ariaLabel:i("Table alignment toolbar")}),ai({view:this,icons:{left:_.objectLeft,center:_.objectCenter,right:_.objectRight},toolbar:o,labels:this._alignmentLabels,propertyName:"alignment",defaultValue:this.options.defaultTableProperties.alignment}),{alignmentLabel:n,alignmentToolbar:o}}_createActionButtons(){const e=this.locale,i=this.t,n=new I(e),o=new I(e),r=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.widthInput,this.heightInput];return n.set({label:i("Save"),icon:_.check,class:"ck-button-save",type:"submit",withText:!0}),n.bind("isEnabled").toMany(r,"errorText",(...l)=>l.every(a=>!a)),o.set({label:i("Cancel"),icon:_.cancel,class:"ck-button-cancel",withText:!0}),o.delegate("execute").to(this,"cancel"),{saveButtonView:n,cancelButtonView:o}}get _alignmentLabels(){const e=this.locale,i=this.t,n=i("Align table to the left"),o=i("Center table"),r=i("Align table to the right");return e.uiLanguageDirection==="rtl"?{right:r,center:o,left:n}:{left:n,center:o,right:r}}}function tt(s){return s!=="none"}var vf='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 2v5h4V2h1v5h5v1h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5H7v-5H2v-1h5V8H2V7h5V2h1zm4 6H8v4h4V8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM17 1a2 2 0 0 1 2 2v9.475l-.85-.124-.857-1.736a2.048 2.048 0 0 0-.292-.44L17 3H3v14h7.808l.402.392L10.935 19H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h14z"/></svg>';const _f=500,Xn={borderStyle:"tableBorderStyle",borderColor:"tableBorderColor",borderWidth:"tableBorderWidth",backgroundColor:"tableBackgroundColor",width:"tableWidth",height:"tableHeight",alignment:"tableAlignment"};class kf extends w{constructor(e){super(e);h(this,"_defaultTableProperties");h(this,"_balloon");h(this,"view",null);h(this,"_undoStepBatch");h(this,"_isReady");e.config.define("table.tableProperties",{borderColors:_t,backgroundColors:_t})}static get requires(){return[te]}static get pluginName(){return"TablePropertiesUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,i=e.t;this._defaultTableProperties=Ks(e.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0}),this._balloon=e.plugins.get(te),e.ui.componentFactory.add("tableProperties",n=>{const o=new I(n);o.set({label:i("Table properties"),icon:vf,tooltip:!0}),this.listenTo(o,"execute",()=>this._showView());const r=Object.values(Xn).map(l=>e.commands.get(l));return o.bind("isEnabled").toMany(r,"isEnabled",(...l)=>l.some(a=>a)),o})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const e=this.editor,i=e.config.get("table.tableProperties"),n=dt(i.borderColors),o=mt(e.locale,n),r=dt(i.backgroundColors),l=mt(e.locale,r),a=i.colorPicker!==!1,c=new Cf(e.locale,{borderColors:o,backgroundColors:l,defaultTableProperties:this._defaultTableProperties,colorPickerConfig:a?i.colorPicker||{}:!1}),u=e.t;c.render(),this.listenTo(c,"submit",()=>{this._hideView()}),this.listenTo(c,"cancel",()=>{this._undoStepBatch.operations.length&&e.execute("undo",this._undoStepBatch),this._hideView()}),c.keystrokes.set("Esc",(g,f)=>{this._hideView(),f()}),qe({emitter:c,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const d=Ds(u),m=Ns(u);return c.on("change:borderStyle",this._getPropertyChangeCallback("tableBorderStyle")),c.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:c.borderColorInput,commandName:"tableBorderColor",errorText:d,validator:vt})),c.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:c.borderWidthInput,commandName:"tableBorderWidth",errorText:m,validator:Ms})),c.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:c.backgroundInput,commandName:"tableBackgroundColor",errorText:d,validator:vt})),c.on("change:width",this._getValidatedPropertyChangeCallback({viewField:c.widthInput,commandName:"tableWidth",errorText:m,validator:Me})),c.on("change:height",this._getValidatedPropertyChangeCallback({viewField:c.heightInput,commandName:"tableHeight",errorText:m,validator:Me})),c.on("change:alignment",this._getPropertyChangeCallback("tableAlignment")),c}_fillViewFormFromCommandValues(){const e=this.editor.commands,i=e.get("tableBorderStyle");Object.entries(Xn).map(([n,o])=>{const r=n,l=this._defaultTableProperties[r]||"";return[r,e.get(o).value||l]}).forEach(([n,o])=>{(n==="borderColor"||n==="borderWidth")&&i.value==="none"||this.view.set(n,o)}),this._isReady=!0}_showView(){const e=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(e.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:$s(e)}),this._undoStepBatch=e.model.createBatch(),this.view.focus()}_hideView(){const e=this.editor;this.stopListening(e.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const e=this.editor,i=e.editing.view.document;Os(i.selection)?this._isViewVisible&&Ws(e,"table"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(e){return(i,n,o)=>{this._isReady&&this.editor.execute(e,{value:o,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(e){const{commandName:i,viewField:n,validator:o,errorText:r}=e,l=mi(()=>{n.errorText=r},_f);return(a,c,u)=>{l.cancel(),this._isReady&&(o(u)?(this.editor.execute(i,{value:u,batch:this._undoStepBatch}),n.errorText=null):l())}}}class yf extends w{static get pluginName(){return"TableProperties"}static get isOfficialPlugin(){return!0}static get requires(){return[ff,kf]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function If(s){s.document.registerPostFixer(t=>Af(t,s))}function Af(s,t){const e=t.document.differ.getChanges();let i=!1;for(const n of e){if(n.type!="insert")continue;const o=n.position.parent;if(o.is("element","table")||n.name=="table"){const r=n.name=="table"?n.position.nodeAfter:o,l=Array.from(r.getChildren()).filter(c=>c.is("element","caption")),a=l.shift();if(!a)continue;for(const c of l)s.move(s.createRangeIn(c),a,"end"),s.remove(c);a.nextSibling&&(s.move(s.createRangeOn(a),r,"end"),i=!0),i=!!l.length||i}}return i}function Yn(s){return!!s&&s.is("element","table")}function ui(s){for(const t of s.getChildren())if(t.is("element","caption"))return t;return null}function Tf(s){const t=ue(s);return t?ui(t):null}function Ef(s){const t=s.parent;return s.name=="figcaption"&&t&&t.is("element","figure")&&t.hasClass("table")?{name:!0}:s.name=="caption"&&t&&t.is("element","table")?{name:!0}:null}class Sf extends y{refresh(){const t=this.editor,e=ue(t.model.document.selection);this.isEnabled=!!e,this.isEnabled?this.value=!!ui(e):this.value=!1}execute({focusCaptionOnShow:t=!1}={}){this.editor.model.change(e=>{this.value?this._hideTableCaption(e):this._showTableCaption(e,t)})}_showTableCaption(t,e){const i=this.editor.model,n=ue(i.document.selection),l=this.editor.plugins.get("TableCaptionEditing")._getSavedCaption(n)||t.createElement("caption");i.insertContent(l,n,"end"),e&&t.setSelection(l,"in")}_hideTableCaption(t){const e=this.editor.model,i=ue(e.document.selection),n=this.editor.plugins.get("TableCaptionEditing"),o=ui(i);n._saveCaption(i,o),e.deleteContent(t.createSelection(o,"on"))}}class xf extends w{constructor(e){super(e);h(this,"_savedCaptionsMap");this._savedCaptionsMap=new WeakMap}static get pluginName(){return"TableCaptionEditing"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,i=e.model.schema,n=e.editing.view,o=e.t;i.isRegistered("caption")?i.extend("caption",{allowIn:"table"}):i.register("caption",{allowIn:"table",allowContentOf:"$block",isLimit:!0}),e.commands.add("toggleTableCaption",new Sf(this.editor)),e.conversion.for("upcast").elementToElement({view:Ef,model:"caption"}),e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(r,{writer:l})=>Yn(r.parent)?l.createContainerElement("figcaption"):null}),e.conversion.for("editingDowncast").elementToElement({model:"caption",view:(r,{writer:l})=>{if(!Yn(r.parent))return null;const a=l.createEditableElement("figcaption");return l.setCustomProperty("tableCaption",!0,a),a.placeholder=o("Enter table caption"),pi({view:n,element:a,keepOnFocus:!0}),Ci(a,l)}}),If(e.model)}_getSavedCaption(e){const i=this._savedCaptionsMap.get(e);return i?ao.fromJSON(i):null}_saveCaption(e,i){this._savedCaptionsMap.set(e,i.toJSON())}}class Rf extends w{static get pluginName(){return"TableCaptionUI"}static get isOfficialPlugin(){return!0}init(){const t=this.editor,e=t.editing.view,i=t.t;t.ui.componentFactory.add("toggleTableCaption",n=>{const o=t.commands.get("toggleTableCaption"),r=new I(n);return r.set({icon:_.caption,tooltip:!0,isToggleable:!0}),r.bind("isOn","isEnabled").to(o,"value","isEnabled"),r.bind("label").to(o,"value",l=>i(l?"Toggle caption off":"Toggle caption on")),this.listenTo(r,"execute",()=>{if(t.execute("toggleTableCaption",{focusCaptionOnShow:!0}),o.value){const l=Tf(t.model.document.selection),a=t.editing.mapper.toViewElement(l);if(!a)return;e.scrollToTheSelection(),e.change(c=>{c.addClass("table__caption_highlighted",a)})}t.editing.view.focus()}),r})}}class Vf extends w{static get pluginName(){return"TableCaption"}static get isOfficialPlugin(){return!0}static get requires(){return[xf,Rf]}}class Pf extends y{refresh(){this.isEnabled=!0}execute(t={}){const{model:e,plugins:i}=this.editor;let{table:n=e.document.selection.getSelectedElement(),columnWidths:o,tableWidth:r}=t;o&&(o=Array.isArray(o)?o:o.split(",")),e.change(l=>{r?l.setAttribute("tableWidth",r,n):l.removeAttribute("tableWidth",n);const a=i.get("TableColumnResizeEditing").getColumnGroupElement(n);if(!o&&!a)return;if(!o)return l.remove(a);const c=Di(o);if(a)Array.from(a.getChildren()).forEach((u,d)=>l.setAttribute("columnWidth",c[d],u));else{const u=l.createElement("tableColumnGroup");c.forEach(d=>l.appendElement("tableColumn",{columnWidth:d},u)),l.append(u,n)}})}}function Bf(s){return t=>t.on("element:colgroup",(e,i,n)=>{const o=i.modelCursor.findAncestor("table"),r=Ke(o);if(!r)return;const l=Ze(r),a=s.getColumns(o);let c=Yg(r,n.writer);c=Array.from({length:a},(u,d)=>c[d]||"auto"),(c.length!=l.length||c.includes("auto"))&&Vs(l,r,Di(c),n.writer)},{priority:"low"})}function Lf(){return s=>s.on("insert:table",(t,e,i)=>{const n=i.writer,o=e.item,r=i.mapper.toViewElement(o),l=r.is("element","table")?r:Array.from(r.getChildren()).find(c=>c.is("element","table"));Ke(o)?n.addClass("ck-table-resized",l):n.removeClass("ck-table-resized",l)},{priority:"low"})}class Of extends w{constructor(e){super(e);h(this,"_isResizingActive");h(this,"_resizingData");h(this,"_domEmitter");h(this,"_tableUtilsPlugin");this._isResizingActive=!1,this.set("_isResizingAllowed",!0),this._resizingData=null,this._domEmitter=new(gi()),this._tableUtilsPlugin=e.plugins.get("TableUtils"),this.on("change:_isResizingAllowed",(i,n,o)=>{const r=o?"removeClass":"addClass";e.editing.view.change(l=>{for(const a of e.editing.view.document.roots)l[r]("ck-column-resize_disabled",e.editing.view.document.getRoot(a.rootName))})})}static get requires(){return[Je,V]}static get pluginName(){return"TableColumnResizeEditing"}static get isOfficialPlugin(){return!0}init(){this._extendSchema(),this._registerPostFixer(),this._registerConverters(),this._registerResizingListeners(),this._registerResizerInserter();const e=this.editor,i=e.plugins.get("TableColumnResize");e.plugins.get("TableEditing").registerAdditionalSlot({filter:r=>r.is("element","tableColumnGroup"),positionOffset:0});const o=new Pf(e);e.commands.add("resizeTableWidth",o),e.commands.add("resizeColumnWidths",o),this.bind("_isResizingAllowed").to(e,"isReadOnly",i,"isEnabled",o,"isEnabled",(r,l,a)=>!r&&l&&a)}destroy(){this._domEmitter.stopListening(),super.destroy()}getColumnGroupElement(e){return Ke(e)}getTableColumnElements(e){return Ze(e)}getTableColumnsWidths(e){return Xg(e)}_extendSchema(){this.editor.model.schema.extend("table",{allowAttributes:["tableWidth"]}),this.editor.model.schema.register("tableColumnGroup",{allowIn:"table",isLimit:!0}),this.editor.model.schema.register("tableColumn",{allowIn:"tableColumnGroup",allowAttributes:["columnWidth","colSpan"],isLimit:!0})}_registerPostFixer(){const i=this.editor.model;i.document.registerPostFixer(r=>{let l=!1;for(const a of $g(i)){const c=this.getColumnGroupElement(a),u=this.getTableColumnElements(c),d=this.getTableColumnsWidths(c);let m=Di(d);m=n(m,a,this),!ct(d,m)&&(Vs(u,c,m,r),l=!0)}return l});function n(r,l,a){const c=a._tableUtilsPlugin.getColumns(l);if(c-r.length===0)return r;const d=r.map(g=>Number(g.replace("%",""))),m=o(a.editor.model.document.differ,l);for(const g of m){const f=c-d.length;if(f===0)continue;const p=f>0,b=a._tableUtilsPlugin.getCellLocation(g).column;if(p){const C=jg(l,a.editor),v=Kg(f,C);d.splice(b,0,...v)}else{const C=d.splice(b,Math.abs(f));d[b]+=We(C)}}return d.map(g=>g+"%")}function o(r,l){const a=new Set;for(const c of r.getChanges())if(c.type=="insert"&&c.position.nodeAfter&&c.position.nodeAfter.name=="tableCell"&&c.position.nodeAfter.getAncestors().includes(l))a.add(c.position.nodeAfter);else if(c.type=="remove"){const u=c.position.nodeBefore||c.position.nodeAfter;u.name=="tableCell"&&u.getAncestors().includes(l)&&a.add(u)}return a}}_registerConverters(){const i=this.editor.conversion;i.for("upcast").attributeToAttribute({view:{name:"figure",key:"style",value:{width:/[\s\S]+/}},model:{name:"table",key:"tableWidth",value:n=>n.getStyle("width")}}),i.for("downcast").attributeToAttribute({model:{name:"table",key:"tableWidth"},view:n=>({name:"figure",key:"style",value:{width:n}})}),i.elementToElement({model:"tableColumnGroup",view:"colgroup"}),i.elementToElement({model:"tableColumn",view:"col"}),i.for("downcast").add(Lf()),i.for("upcast").add(Bf(this._tableUtilsPlugin)),i.for("upcast").attributeToAttribute({view:{name:"col",styles:{width:/.*/}},model:{key:"columnWidth",value:n=>{const o=n.getStyle("width");return!o||!o.endsWith("%")&&!o.endsWith("pt")?"auto":o}}}),i.for("upcast").attributeToAttribute({view:{name:"col",key:"span"},model:"colSpan"}),i.for("downcast").attributeToAttribute({model:{name:"tableColumn",key:"columnWidth"},view:n=>({key:"style",value:{width:n}})})}_registerResizingListeners(){const e=this.editor.editing.view;e.addObserver(Ls),e.document.on("mousedown",this._onMouseDownHandler.bind(this),{priority:"high"}),this._domEmitter.listenTo(ee.window.document,"mousemove",Dr(this._onMouseMoveHandler.bind(this),50)),this._domEmitter.listenTo(ee.window.document,"mouseup",this._onMouseUpHandler.bind(this))}_onMouseDownHandler(e,i){const n=i.target;if(!n.hasClass("ck-table-column-resizer")||!this._isResizingAllowed)return;const o=this.editor,r=o.editing.mapper.toModelElement(n.findAncestor("figure"));if(!o.model.canEditAt(r))return;i.preventDefault(),e.stop();const l=u(r,this._tableUtilsPlugin,o),a=n.findAncestor("table"),c=o.editing.view;Array.from(a.getChildren()).find(g=>g.is("element","colgroup"))||c.change(g=>{d(g,l,a)}),this._isResizingActive=!0,this._resizingData=this._getResizingData(i,l),c.change(g=>m(g,a,this._resizingData));function u(g,f,p){const b=Array(f.getColumns(g)),C=new A(g);for(const v of C){const k=p.editing.mapper.toViewElement(v.cell),T=p.editing.view.domConverter.mapViewToDom(k),S=Jg(T);(!b[v.column]||S<b[v.column])&&(b[v.column]=O(S))}return b}function d(g,f,p){const b=g.createContainerElement("colgroup");for(let C=0;C<f.length;C++){const v=g.createEmptyElement("col"),k=`${O(f[C]/We(f)*100)}%`;g.setStyle("width",k,v),g.insert(g.createPositionAt(b,"end"),v)}g.insert(g.createPositionAt(p,0),b)}function m(g,f,p){const b=p.widths.viewFigureWidth/p.widths.viewFigureParentWidth;g.addClass("ck-table-resized",f),g.addClass("ck-table-column-resizer__active",p.elements.viewResizer),g.setStyle("width",`${O(b*100)}%`,f.findAncestor("figure"))}}_onMouseMoveHandler(e,i){if(!this._isResizingActive)return;if(!this._isResizingAllowed){this._onMouseUpHandler();return}const{columnPosition:n,flags:{isRightEdge:o,isTableCentered:r,isLtrContent:l},elements:{viewFigure:a,viewLeftColumn:c,viewRightColumn:u},widths:{viewFigureParentWidth:d,tableWidth:m,leftColumnWidth:g,rightColumnWidth:f}}=this._resizingData,p=-g+ni,b=o?d-m:f-ni,C=(l?1:-1)*(o&&r?2:1),v=Gg((i.clientX-n)*C,Math.min(p,0),Math.max(b,0));v!==0&&this.editor.editing.view.change(k=>{const T=O((g+v)*100/m);if(k.setStyle("width",`${T}%`,c),o){const S=O((m+v)*100/d);k.setStyle("width",`${S}%`,a)}else{const S=O((f-v)*100/m);k.setStyle("width",`${S}%`,u)}})}_onMouseUpHandler(){if(!this._isResizingActive)return;const{viewResizer:e,modelTable:i,viewFigure:n,viewColgroup:o}=this._resizingData.elements,r=this.editor,l=r.editing.view,a=this.getColumnGroupElement(i),c=Array.from(o.getChildren()).filter(b=>b.is("view:element")),u=a?this.getTableColumnsWidths(a):null,d=c.map(b=>b.getStyle("width")),m=!ct(u,d),g=i.getAttribute("tableWidth"),f=n.getStyle("width"),p=g!==f;(m||p)&&(this._isResizingAllowed?r.execute("resizeTableWidth",{table:i,tableWidth:`${O(f)}%`,columnWidths:d}):l.change(b=>{if(u)for(const C of c)b.setStyle("width",u.shift(),C);else b.remove(o);p&&(g?b.setStyle("width",g,n):b.removeStyle("width",n)),!u&&!g&&b.removeClass("ck-table-resized",[...n.getChildren()].find(C=>C.name==="table"))})),l.change(b=>{b.removeClass("ck-table-column-resizer__active",e)}),this._isResizingActive=!1,this._resizingData=null}_getResizingData(e,i){const n=this.editor,o=e.domEvent.clientX,r=e.target,l=r.findAncestor("td")||r.findAncestor("th"),a=n.editing.mapper.toModelElement(l),c=a.findAncestor("table"),u=qg(a,this._tableUtilsPlugin).rightEdge,d=this._tableUtilsPlugin.getColumns(c)-1,m=u===d,g=!c.hasAttribute("tableAlignment"),f=n.locale.contentLanguageDirection!=="rtl",p=l.findAncestor("table"),b=p.findAncestor("figure"),C=[...p.getChildren()].find(Xs=>Xs.is("element","colgroup")),v=C.getChild(u),k=m?void 0:C.getChild(u+1),T=oi(n.editing.view.domConverter.mapViewToDom(b.parent)),S=oi(n.editing.view.domConverter.mapViewToDom(b)),oe=Rs(c,n),Ce=i[u],Js=m?void 0:i[u+1];return{columnPosition:o,flags:{isRightEdge:m,isTableCentered:g,isLtrContent:f},elements:{viewResizer:r,modelTable:c,viewFigure:b,viewColgroup:C,viewLeftColumn:v,viewRightColumn:k},widths:{viewFigureParentWidth:T,viewFigureWidth:S,tableWidth:oe,leftColumnWidth:Ce,rightColumnWidth:Js}}}_registerResizerInserter(){this.editor.conversion.for("editingDowncast").add(e=>{e.on("insert:tableCell",(i,n,o)=>{const r=n.item,l=o.mapper.toViewElement(r),a=o.writer;a.insert(a.createPositionAt(l,"end"),a.createUIElement("div",{class:"ck-table-column-resizer"}))},{priority:"lowest"})})}}class Ff extends w{static get requires(){return[Of,Zs]}static get pluginName(){return"TableColumnResize"}static get isOfficialPlugin(){return!0}}function Hf({defaultValue:s,pageData:t,setBtnDisabled:e,setFormData:i,formData:n,contentSlug:o,btnDisabled:r,index:l}){const a=Oe.useRef(null),c=Oe.useRef(null),[u,d]=Oe.useState(!1);Oe.useState(),Oe.useEffect(()=>(d(!0),()=>d(!1)),[]);const m=(f,p)=>{var b,C,v;if(o==="eventAgenda"){console.log("form data agenda",n.eventAgenda);let k=n.eventAgenda||[];console.log("eventAgenda",k),k.length>0&&k[l]?(console.log("index exist",k[l]),k[l].Description=p.getData()):(console.log("new index"),k[l]={},k[l].Description=p.getData()),console.log("eventAgenda after",k),i({...n,eventAgenda:k})}o==="servicePrograms"?i({...n,servicePrograms:{...n.servicePrograms,ContentDescription:p.getData(),ContentDetailId:(b=t==null?void 0:t.studyDetails)==null?void 0:b.ContentDetailId}}):o==="studyDetails"?i({...n,studyDetails:{...n.studyDetails,ContentDescription:p.getData(),ContentDetailId:(C=t==null?void 0:t.studyDetails)==null?void 0:C.ContentDetailId}}):o==="blogDetails"?i({...n,blogDetails:{...n.blogDetails,ContentDescription:p.getData(),ContentDetailId:(v=t==null?void 0:t.blogDetails)==null?void 0:v.ContentDetailId}}):o!=="eventAgenda"&&i(k=>({...k,[o]:{...k[o],Description:p.getData()}})),e({...r,[o]:!1})},g={toolbar:{items:["undo","redo","|","sourceEditing","showBlocks","selectAll","|","heading","|","bold","italic","code","|","link","insertImage","insertTable","codeBlock","htmlEmbed","|","bulletedList","numberedList","|","accessibilityHelp"],shouldNotGroupWhenFull:!0},plugins:[oo,ya,Au,vs,Ia,Ea,ja,Pa,rc,kc,pu,xc,wu,Oc,Uu,Wu,Nu,cd,rs,vd,Vd,Pi,Pd,ss,Fa,cm,pm,jr,qr,ft,sg,Ld,jo,ug,va,pg,Fh,Vf,sf,Ff,yf,Uh,Gr,Si],heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"Heading 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"Heading 4",class:"ck-heading_heading4"},{model:"heading5",view:"h5",title:"Heading 5",class:"ck-heading_heading5"},{model:"heading6",view:"h6",title:"Heading 6",class:"ck-heading_heading6"}]},htmlSupport:{allow:[{name:/^.*$/,styles:!0,attributes:!0,classes:!0}]},image:{toolbar:["toggleImageCaption","imageTextAlternative","|","imageStyle:inline","imageStyle:wrapText","imageStyle:breakText","|","resizeImage","|"]},initialData:o==="servicePrograms"||o==="studyDetails"||o==="blogDetails"||o==="privacy"||o==="t&c"||o==="about"?s:t&&t[o]&&t[o].Description,link:{addTargetToExternalLinks:!0,defaultProtocol:"https://",decorators:{toggleDownloadable:{mode:"manual",label:"Downloadable",attributes:{download:"file"}}}},list:{properties:{styles:!0,startIndex:!0,reversed:!0}},placeholder:"Type or paste your content here!",table:{contentToolbar:["tableColumn","tableRow","mergeTableCells","tableProperties","tableCellProperties"]},simpleUpload:{uploadUrl:"https://rareminds.in/api/blog/image-upload"}};return ve.jsx("div",{children:ve.jsx("div",{className:"main-container",children:ve.jsx("div",{className:"editor-container editor-container_classic-editor",ref:a,children:ve.jsx("div",{className:"editor-container__editor",children:ve.jsx("div",{ref:c,children:u&&ve.jsx(Kr,{editor:cc,data:o==="servicePrograms"||o==="studyDetails"||o==="blogDetails"||o==="privacy"||o==="t&c"||o==="careers"||o==="about"?s:o==="eventAgenda"?s==="undefined"?"":s:t&&t[o]&&t[o].Description,config:g,onChange:m})})})})})})}export{Hf as T};
